<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>UICollectionView | Ammar's Blog</title><meta name="description" content="UICollectionView"><meta name="keywords" content="iOS"><meta name="author" content="Ammar"><meta name="copyright" content="Ammar"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.1/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://lizhaoloveit.cn/2015/06/23/UICollectionView/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="UICollectionView"><meta name="twitter:description" content="UICollectionView"><meta name="twitter:image" content="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg"><meta property="og:type" content="article"><meta property="og:title" content="UICollectionView"><meta property="og:url" content="http://lizhaoloveit.cn/2015/06/23/UICollectionView/"><meta property="og:site_name" content="Ammar's Blog"><meta property="og:description" content="UICollectionView"><meta property="og:image" content="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="How To Install Cocoapods" href="http://lizhaoloveit.cn/2015/07/06/How-to-install-cocoapods/"><link rel="next" title="应用间跳转" href="http://lizhaoloveit.cn/2015/06/20/%E5%BA%94%E7%94%A8%E9%97%B4%E8%B7%B3%E8%BD%AC/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?162506e75ffd64287398566b2f5738c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"VRMKRAV9AT","apiKey":"bd7157400046d0f02396708a501a3480","indexName":"lizhaoloveit","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://lizhaoloveit.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天'

  
}</script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#UICollectionView-是什么？"><span class="toc-number">1.</span> <span class="toc-text">UICollectionView 是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UICollectionView-能干什么？"><span class="toc-number">2.</span> <span class="toc-text">UICollectionView 能干什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#我们如何使用-UICollectionView"><span class="toc-number">3.</span> <span class="toc-text">我们如何使用 UICollectionView</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UICollectionView-的简单使用"><span class="toc-number">3.1.</span> <span class="toc-text">UICollectionView 的简单使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#掌握-UICollectionViewFlowLayout-类的使用"><span class="toc-number">3.2.</span> <span class="toc-text">掌握 UICollectionViewFlowLayout 类的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#掌握-UICollectionViewLayout-类的使用"><span class="toc-number">3.3.</span> <span class="toc-text">掌握 UICollectionViewLayout 类的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UICollectionViewLayoutAttributes"><span class="toc-number">3.4.</span> <span class="toc-text">UICollectionViewLayoutAttributes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Demo-瀑布流"><span class="toc-number">3.5.</span> <span class="toc-text">Demo 瀑布流</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#补充"><span class="toc-number">4.</span> <span class="toc-text">补充</span></a></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://lizhaoloveit.cn/blogimages/blog/top_img.jpg)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">Ammar's Blog</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description">微信号：aicjaish</div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a><a class="site-page" href="/comment/"><i class="fa-fw fa fa-coffee"></i><span> 留言</span></a><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">UICollectionView</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2015-06-23<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-07-29</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/iOS/">iOS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/iOS/UI/">UI</a></span><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.2k</span><span class="post-meta__separator">|</span><span>阅读时长: 12 分钟</span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>学习一个东西，要先搞清楚三个问题：UICollectionView 是什么，UICollectionView 能干什么，如何使用 UICollectionView。</p>
<p>如果我们对于这三个问题都能回答的游刃有余了，基本就掌握这个东西了。</p>
<h2 id="UICollectionView-是什么？"><a href="#UICollectionView-是什么？" class="headerlink" title="UICollectionView 是什么？"></a>UICollectionView 是什么？</h2><p>首先回顾一下 Collection View 的构成，我们能看到的有三个元素：</p>
<ol>
<li>Cells</li>
<li>Supplementary Views 追加视图 （类似Header或者Footer）</li>
<li>Decoration Views 装饰视图 （用作背景展示）</li>
</ol>
<p>在其内部，我们找到了 </p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UICollectionViewLayout</span> *collectionViewLayout;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>, <span class="keyword">nullable</span>) <span class="keyword">id</span> &lt;<span class="built_in">UICollectionViewDelegate</span>&gt; delegate;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>, <span class="keyword">nullable</span>) <span class="keyword">id</span> &lt;<span class="built_in">UICollectionViewDataSource</span>&gt; dataSource;</span><br></pre></td></tr></table></figure>
<p>可见其内部有提供数据的 UICollectionViewDataSource 以及处理用户交互的UICollectionViewDelegate 支持。另一方面，对于cell的样式和组织方式，由于collectionView 比 tableView 要复杂得多，因此没有按照类似于 tableView 的style 的方式来定义，而是专门使用了一个类来对 collectionView 的布局和行为进行描述，这就是 UICollectionViewLayout。collectionView 更像是一个复杂且灵活多变的 tableView。</p>
<h2 id="UICollectionView-能干什么？"><a href="#UICollectionView-能干什么？" class="headerlink" title="UICollectionView 能干什么？"></a>UICollectionView 能干什么？</h2><p>UICollectionView 可以搭建漂亮的布局页面，比如淘宝展示商品的 app：</p>
<p>这样的页面使用 UITableView 很难实现，但是使用 UICollectionView 是很容易搭建的。你可以自定义布局，让你的控件视图更加灵活。你可以用很少的代码实现非常炫酷的布局效果。</p>
<h2 id="我们如何使用-UICollectionView"><a href="#我们如何使用-UICollectionView" class="headerlink" title="我们如何使用 UICollectionView"></a>我们如何使用 UICollectionView</h2><h3 id="UICollectionView-的简单使用"><a href="#UICollectionView-的简单使用" class="headerlink" title="UICollectionView 的简单使用"></a>UICollectionView 的简单使用</h3><p>先从最基础的开始：</p>
<p>首先，它是一个 UIView 控件，我们要想再屏幕上把它展示出来需要：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGFloat</span> collectionWH = <span class="keyword">self</span>.view.frame.size.width;</span><br><span class="line"><span class="built_in">CGRect</span> frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">150</span>, collectionWH, collectionWH);</span><br><span class="line">    </span><br><span class="line"><span class="built_in">UICollectionView</span> *collectionView = [[<span class="built_in">UICollectionView</span> alloc] initWithFrame:frame];</span><br><span class="line"></span><br><span class="line">[<span class="keyword">self</span>.view addSubview:collectionView];</span><br></pre></td></tr></table></figure>

<p>当我们运行的时候会发现程序崩了，这是由于 UICollectionView 是用来进行屏幕布局的。我不能这样简简单单的创建出来。你会发现 <code>alloc init</code> 方法中，有一个<code>initWithFrame:frame collectionViewLayout:;</code> 方法，我们必须给 collectionView 传入一个 UICollectionViewLayout 对象，这个对象也叫布局对象。</p>
<blockquote>
<p>目前来说，苹果官方给我们的能用的布局就一个：UICollectionViewFlowLayout，也叫流水布局。项目中，我们需要自定义布局满足自己项目的需要。</p>
</blockquote>
<p>当我们使用下面代码创建 collectionView 时，运行已经可以看到 collectionView 了。如果我们想看到东西的话，还需要设置 collectionView 的数据源方法，这和 UITableView 比较类似。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">UICollectionView</span> *collectionView = [[<span class="built_in">UICollectionView</span> alloc] initWithFrame:frame collectionViewLayout:[[<span class="built_in">UICollectionViewFlowLayout</span> alloc] init]];</span><br></pre></td></tr></table></figure>

<p>这里就不过多说明了，可以看代码的注释，我们运行下面代码：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()&lt;<span class="title">UICollectionViewDataSource</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> AMCellId = <span class="string">@"AMCell"</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="built_in">CGFloat</span> collectionWH = <span class="keyword">self</span>.view.frame.size.width;</span><br><span class="line">    <span class="built_in">CGRect</span> frame = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">150</span>, collectionWH, collectionWH);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UICollectionView</span> *collectionView = [[<span class="built_in">UICollectionView</span> alloc] initWithFrame:frame collectionViewLayout:[[<span class="built_in">UICollectionViewFlowLayout</span> alloc] init]];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册</span></span><br><span class="line">    [collectionView registerClass:[<span class="built_in">UICollectionViewCell</span> <span class="keyword">class</span>] forCellWithReuseIdentifier:AMCellId];</span><br><span class="line">    </span><br><span class="line">    collectionView.dataSource = <span class="keyword">self</span>;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:collectionView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#pragma mark - UICollectionViewDataSource</span></span><br><span class="line"><span class="comment">// 告诉 collectionView 一共有多少个 cell</span></span><br><span class="line">- (<span class="built_in">NSInteger</span>)collectionView:(<span class="built_in">UICollectionView</span> *)collectionView numberOfItemsInSection:(<span class="built_in">NSInteger</span>)section</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">50</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 告诉 collectionView 每个 cell 的内容</span></span><br><span class="line">- (<span class="built_in">UICollectionViewCell</span> *)collectionView:(<span class="built_in">UICollectionView</span> *)collectionView cellForItemAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">UICollectionViewCell</span> *cell = [collectionView dequeueReusableCellWithReuseIdentifier:AMCellId forIndexPath:indexPath];</span><br><span class="line">    </span><br><span class="line">    cell.backgroundColor = [<span class="built_in">UIColor</span> greenColor];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> cell;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>于是我们已经完成了一次 collectionView 的简单使用。会出现以下效果：</p>
<blockquote>
<p>PS：所谓的流水布局，flow 的意思就是当一行装满了就会流到下一行吧，其实就是按顺序排列的九宫格布局。</p>
</blockquote>
<h3 id="掌握-UICollectionViewFlowLayout-类的使用"><a href="#掌握-UICollectionViewFlowLayout-类的使用" class="headerlink" title="掌握 UICollectionViewFlowLayout 类的使用"></a>掌握 UICollectionViewFlowLayout 类的使用</h3><p>想要自定义布局，我们需要写一个类，这个类必须继承自 UICollectionViewLayout 或者 UICollectionViewFlowLayout。</p>
<p>我们先学习如何通过继承 UICollectionViewFlowLayout 类来做一些与流水效果类似的小例子，便于我们理解 UICollectionViewFlowLayout 是怎样做 collectionView 的布局的。</p>
<p>效果图如下：</p>
<p>首先，创建 AMLineLayout 文件并继承自 UICollectionViewFlowLayout。需要用自定义的布局。然后进行一些初始化操作，比如只允许水平滚动，cell 的 size 等等的初始化操作。</p>
<blockquote>
<p>注意：</p>
</blockquote>
<blockquote>
<p>初始化操作不能像其他类的初始化一样写在 -init，中 UICollectionViewLayout 专门提供了我们初始化方法，而且这个代码一定要调用 super 的方法，代码如下：</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用来做布局的初始化操作（不建议在init方法中进行布局的初始化操作）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareLayout</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> prepareLayout];</span><br><span class="line">    <span class="keyword">self</span>.scrollDirection =  <span class="built_in">UICollectionViewScrollDirectionHorizontal</span>;</span><br><span class="line">    <span class="keyword">self</span>.itemSize = <span class="built_in">CGSizeMake</span>(<span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">    <span class="comment">// 初始是需要一定的偏移量</span></span><br><span class="line">    <span class="built_in">CGFloat</span> inset = <span class="keyword">self</span>.collectionView.frame.size.width * <span class="number">0.5</span> - <span class="keyword">self</span>.itemSize.width * <span class="number">0.5</span>;</span><br><span class="line">    <span class="keyword">self</span>.sectionInset = <span class="built_in">UIEdgeInsetsMake</span>(<span class="number">0</span>, inset, <span class="number">0</span>, inset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现滑动远离中心点的 cell 缩小，靠近中心点的 cell 放大，在中心点的 cell 最大。我们需要重写父类方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当collectionView的显示范围发生改变的时候，是否需要重新刷新布局</span></span><br><span class="line"><span class="comment"> * 一旦重新刷新布局，就会重新调用下面的方法：</span></span><br><span class="line"><span class="comment"> * 1.prepareLayout</span></span><br><span class="line"><span class="comment"> * 2.layoutAttributesForElementsInRect:方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)shouldInvalidateLayoutForBoundsChange:(<span class="built_in">CGRect</span>)newBounds</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * UICollectionViewLayoutAttributes *attrs;</span></span><br><span class="line"><span class="comment"> * 1.一个cell对应一个UICollectionViewLayoutAttributes对象</span></span><br><span class="line"><span class="comment"> * 2.UICollectionViewLayoutAttributes对象决定了cell的frame</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个方法的返回值是一个数组（数组里面存放着rect范围内所有元素的布局属性）</span></span><br><span class="line"><span class="comment"> * 这个方法的返回值决定了rect范围内所有元素的排布（frame）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">NSArray</span>&lt;<span class="built_in">UICollectionViewLayoutAttributes</span> *&gt; *)layoutAttributesForElementsInRect:(<span class="built_in">CGRect</span>)rect</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 计算collectionView最中心点的x值</span></span><br><span class="line">    <span class="built_in">CGFloat</span> centerX = <span class="keyword">self</span>.collectionView.contentOffset.x + <span class="keyword">self</span>.collectionView.frame.size.width * <span class="number">0.5</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取 super 计算好的布局属性</span></span><br><span class="line">    <span class="built_in">NSArray</span> *array = [<span class="keyword">super</span> layoutAttributesForElementsInRect:rect];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历属性，在原有的属性上进行微调</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UICollectionViewLayoutAttributes</span> *attrs <span class="keyword">in</span> array) &#123;</span><br><span class="line">        <span class="comment">// 计算每个 cell 距离中心点的间距</span></span><br><span class="line">        <span class="built_in">CGFloat</span> delta = ABS(attrs.center.x - centerX);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 根据每个 cell 距离中心点的距离计算他们的 scale</span></span><br><span class="line">        <span class="built_in">CGFloat</span> scale = <span class="number">1</span> - delta / <span class="keyword">self</span>.collectionView.frame.size.width;</span><br><span class="line">        <span class="comment">// 设置缩放比例</span></span><br><span class="line">        attrs.transform = <span class="built_in">CGAffineTransformMakeScale</span>(scale, scale);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个方法的返回值，就决定了collectionView停止滚动时的偏移量</span></span><br><span class="line"><span class="comment"> * 参数 proposedContentOffset 不受外界干扰的情况下，本来应该滚动的偏移量</span></span><br><span class="line"><span class="comment"> * velocity 表示滚动的速度</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">CGPoint</span>)targetContentOffsetForProposedContentOffset:(<span class="built_in">CGPoint</span>)proposedContentOffset withScrollingVelocity:(<span class="built_in">CGPoint</span>)velocity</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 计算出滚动完成后的 collectionView 的中心的 x 值</span></span><br><span class="line">    <span class="built_in">CGFloat</span> centerX = proposedContentOffset.x + <span class="keyword">self</span>.collectionView.frame.size.width * <span class="number">0.5</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 计算 cell 的矩形框</span></span><br><span class="line">    <span class="built_in">CGRect</span> rect = <span class="built_in">CGRectMake</span>(proposedContentOffset.x, <span class="number">0</span>, <span class="keyword">self</span>.collectionView.frame.size.width, <span class="keyword">self</span>.collectionView.frame.size.height);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 获取 super 计算好的属性值</span></span><br><span class="line">    <span class="built_in">NSArray</span> *array = [<span class="keyword">super</span> layoutAttributesForElementsInRect:rect];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 用于记录最小的 delta</span></span><br><span class="line">    <span class="built_in">CGFloat</span> minDelta = MAXFLOAT;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 遍历矩形框内的 cell 的中心值</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">UICollectionViewLayoutAttributes</span> *attrs <span class="keyword">in</span> array) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ABS(minDelta) &gt; ABS(attrs.center.x - centerX)) &#123;</span><br><span class="line">            minDelta = attrs.center.x - centerX;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 让最近的 cell 显示在中间</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">CGPointMake</span>(proposedContentOffset.x + minDelta, proposedContentOffset.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，你运行程序，就可以发现每个 cell 就像之前的图片那里的样子一样运动了。想要给 cell 添加图片的话，就和我们的 AMLineLayout 类无关了。AMLineLayout 只管布局，不管内容。</p>
<p>此时创建自定义的 UICollectionViewCell 然后设置 imageView 控件添加图片控件，然后在 dataSource 数据源方法中给图片控件赋值并返回我们自定义的 cell 即可，这里就不过多叙述了。具体可见<a href="https://github.com/lizhaoLoveIT/collectionView" target="_blank" rel="noopener">线性布局</a>。</p>
<p>接下来，如果我们需求的布局不是流水布局，而是其他布局排布，要解决这样的问题，就需要我们自己来实现 UICollectionViewLayout 类中的很多方法了。它是一个抽象类，有很多抽象方法。下面就来详细看看我们应该如何使用它来自定义元素的排布。</p>
<h3 id="掌握-UICollectionViewLayout-类的使用"><a href="#掌握-UICollectionViewLayout-类的使用" class="headerlink" title="掌握 UICollectionViewLayout 类的使用"></a>掌握 UICollectionViewLayout 类的使用</h3><p>UICollectionViewLayout 的功能为向 UICollectionView 提供布局信息，不仅包括 cell 的布局信息，也包括追加视图和装饰视图的布局信息。实现一个自定义 layout 的常规做法是继承 UICollectionViewLayout 类，然后重载下列方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">+ (Class)layoutAttributesClass; <span class="comment">// override this method to provide a custom class to be used when instantiating instances of UICollectionViewLayoutAttributes</span></span><br><span class="line">+ (Class)invalidationContextClass <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">7</span>_0); <span class="comment">// override this method to provide a custom class to be used for invalidation contexts</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对于初始化只算一次的东西放在这个方法内。根据苹果 discussion 的说法，</span></span><br><span class="line"><span class="comment">// 会在初始化布局时调用一次，然后会在布局无效以后和请求布局信息时调用</span></span><br><span class="line"><span class="comment">// The collection view calls -prepareLayout again after layout is invalidated and before requerying the layout information.</span></span><br><span class="line"><span class="comment">// 这个方法必须调用 super 如果被重写。</span></span><br><span class="line">- (<span class="keyword">void</span>)prepareLayout;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UICollectionView calls these four methods to determine the layout information.</span></span><br><span class="line"><span class="comment">// UICollectionView 调用下面4个方法来确定布局信息</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个方法的返回值是一个数组（数组里面存放着rect范围内所有元素的布局属性）</span></span><br><span class="line"><span class="comment"> * 这个布局属性可以是 cell 的，或者追加视图或装饰视图的，这是根据</span></span><br><span class="line"><span class="comment"> * 创建 UICollectionViewLayoutAttributes 对象使用的方法决定的：</span></span><br><span class="line"><span class="comment"> * layoutAttributesForCellWithIndexPath:</span></span><br><span class="line"><span class="comment"> * layoutAttributesForSupplementaryViewOfKind:withIndexPath:</span></span><br><span class="line"><span class="comment"> * layoutAttributesForDecorationViewOfKind:withIndexPath:</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * 而每一个元素对应一个 UICollectionViewLayoutAttributes 对象</span></span><br><span class="line"><span class="comment"> * 这个类后面有介绍</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">NSArray</span>&lt;__kindof <span class="built_in">UICollectionViewLayoutAttributes</span> *&gt; *)layoutAttributesForElementsInRect:(<span class="built_in">CGRect</span>)rect; </span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 给定元素在数组中的位置，返回该位置的元素的布局信息： </span></span><br><span class="line"><span class="comment"> * UICollectionViewLayoutAttributes 对象，一般配合上面的方法一起使用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UICollectionViewLayoutAttributes</span> *)layoutAttributesForItemAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回对应于indexPath的位置的追加视图的布局属性，如果没有追加视图可不重载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UICollectionViewLayoutAttributes</span> *)layoutAttributesForSupplementaryViewOfKind:(<span class="built_in">NSString</span> *)elementKind atIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回对应于indexPath的位置的装饰视图的布局属性，如果没有装饰视图可不重载</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="built_in">UICollectionViewLayoutAttributes</span> *)layoutAttributesForDecorationViewOfKind:(<span class="built_in">NSString</span>*)elementKind atIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 当collectionView的显示范围发生改变的时候，是否需要重新刷新布局</span></span><br><span class="line"><span class="comment"> * 一旦重新刷新布局，就会重新调用下面的方法：</span></span><br><span class="line"><span class="comment"> * 1.prepareLayout</span></span><br><span class="line"><span class="comment"> * 2.layoutAttributesForElementsInRect:方法</span></span><br><span class="line"><span class="comment"> * 返回 No 则显示范围发生改变时不会随时调用以上方法，而是在改变后调用一次</span></span><br><span class="line"><span class="comment"> * 如果 YES 则在边界变化（一般是scroll到其他地方）时，将重新计算需要的布局信息。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)shouldInvalidateLayoutForBoundsChange:(<span class="built_in">CGRect</span>)newBounds; <span class="comment">// return YES to cause the collection view to requery the layout for geometry information</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UICollectionViewLayoutInvalidationContext</span> *)invalidationContextForBoundsChange:(<span class="built_in">CGRect</span>)newBounds <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">7</span>_0);</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)shouldInvalidateLayoutForPreferredLayoutAttributes:(<span class="built_in">UICollectionViewLayoutAttributes</span> *)preferredAttributes withOriginalAttributes:(<span class="built_in">UICollectionViewLayoutAttributes</span> *)originalAttributes <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">8</span>_0);</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UICollectionViewLayoutInvalidationContext</span> *)invalidationContextForPreferredLayoutAttributes:(<span class="built_in">UICollectionViewLayoutAttributes</span> *)preferredAttributes withOriginalAttributes:(<span class="built_in">UICollectionViewLayoutAttributes</span> *)originalAttributes <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">8</span>_0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个方法的返回值，就决定了collectionView停止滚动时的偏移量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">CGPoint</span>)targetContentOffsetForProposedContentOffset:(<span class="built_in">CGPoint</span>)proposedContentOffset withScrollingVelocity:(<span class="built_in">CGPoint</span>)velocity; <span class="comment">// return a point at which to rest after scrolling - for layouts that want snap-to-point scrolling behavior</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGPoint</span>)targetContentOffsetForProposedContentOffset:(<span class="built_in">CGPoint</span>)proposedContentOffset <span class="built_in">NS_AVAILABLE_IOS</span>(<span class="number">7</span>_0); <span class="comment">// a layout can return the content offset to be applied during transition or update animations</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 这个方法确定你布局的内容尺寸，设置了以后才可以滚动。</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line">- (<span class="built_in">CGSize</span>)collectionViewContentSize; <span class="comment">// Subclasses must override this method and use it to return the width and height of the collection view’s content. These values represent the width and height of all the content, not just the content that is currently visible. The collection view uses this information to configure its own content size to facilitate scrolling.</span></span><br></pre></td></tr></table></figure>
<p>另外需要了解的是，在初始化一个 UICollectionViewLayout 实例后，会有一系列准备方法被自动调用，以保证 layout 实例的正确。</p>
<p>首先，<code>- (void)prepareLayout</code> 将被调用，默认下该方法什么都不做，但是在自己的子类实现中，一般在该方法中设定一些必要的 layout 的结构和初始需要的参数等。</p>
<p>之后，<code>- (CGSize) collectionViewContentSize</code> 将被调用，以确定 collection 应该占据的尺寸。注意这里的尺寸不是指可视部分的尺寸，而应该是所有内容所占的尺寸。collectionView 的本质是一个 scrollView，因此需要这个尺寸来配置滚动行为。</p>
<p>接下来 <code>- (NSArray *)layoutAttributesForElementsInRect:(CGRect)rect</code> 被调用，初始的 layout 的外观将由该方法返回的 UICollectionViewLayoutAttributes 来决定。</p>
<p>最后，在需要更新 layout 时，需要给当前 layout 发送 <code>- invalidateLayout</code> 消息。该消息会立即返回，并且预约在下一个 loop 的时候刷新当前 layout ，这一点和 UIView 的 <code>setNeedsLayout</code> 方法十分类似。在 <code>- invalidateLayout</code> 后的下一个 collectionView 的刷新 loop 中，又会从prepareLayout开始，依次再调用<code>- collectionViewContentSize</code>和 <code>- layoutAttributesForElementsInRect</code> 来生成更新后的布局。</p>
<h3 id="UICollectionViewLayoutAttributes"><a href="#UICollectionViewLayoutAttributes" class="headerlink" title="UICollectionViewLayoutAttributes"></a>UICollectionViewLayoutAttributes</h3><p>UICollectionViewLayoutAttributes是一个非常重要的类，其 property 列表：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGRect</span> frame</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGPoint</span> center</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGSize</span> size</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CATransform3D</span> transform3D</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> alpha</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">NSInteger</span> zIndex</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">getter</span>=isHidden) <span class="built_in">BOOL</span> hidden</span><br></pre></td></tr></table></figure>

<p>可以看到，UICollectionViewLayoutAttributes 的实例中包含了诸如边框，中心点，大小，形状，透明度，层次关系和是否隐藏等信息。当 UICollectionView 在获取布局时将针对每一个当前 indexPath 上的元素（包括cell，追加视图和装饰视图），向其 UICollectionViewLayout 实例询问该部件的布局信息，而这个布局信息就由每个元素对应的 UICollectionViewLayoutAttributes 类的实例对象给出。</p>
<h3 id="Demo-瀑布流"><a href="#Demo-瀑布流" class="headerlink" title="Demo 瀑布流"></a>Demo 瀑布流</h3><p>自定义 UICollectionViewLayout ，然后重写下列4个方法就可以展示内容了。</p>
<p>详见代码：<a href="https://github.com/lizhaoLoveIT/collectionView" target="_blank" rel="noopener">瀑布流框架</a></p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>如果我们想要删除、插入或者移动元素，删除、插入或者移动组需要用到 UICollectionView 的方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)insertSections:(<span class="built_in">NSIndexSet</span> *)sections;</span><br><span class="line">- (<span class="keyword">void</span>)deleteSections:(<span class="built_in">NSIndexSet</span> *)sections;</span><br><span class="line">- (<span class="keyword">void</span>)reloadSections:(<span class="built_in">NSIndexSet</span> *)sections;</span><br><span class="line">- (<span class="keyword">void</span>)moveSection:(<span class="built_in">NSInteger</span>)section toSection:(<span class="built_in">NSInteger</span>)newSection;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)insertItemsAtIndexPaths:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSIndexPath</span> *&gt; *)indexPaths;</span><br><span class="line">- (<span class="keyword">void</span>)deleteItemsAtIndexPaths:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSIndexPath</span> *&gt; *)indexPaths;</span><br><span class="line">- (<span class="keyword">void</span>)reloadItemsAtIndexPaths:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSIndexPath</span> *&gt; *)indexPaths;</span><br><span class="line">- (<span class="keyword">void</span>)moveItemAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath toIndexPath:(<span class="built_in">NSIndexPath</span> *)newIndexPath;</span><br></pre></td></tr></table></figure>

<p>如果我们想更换布局，一行代码就可以实现，而且是动态实现：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setCollectionViewLayout:(<span class="built_in">UICollectionViewLayout</span> *)layout animated:(<span class="built_in">BOOL</span>)animated; <span class="comment">// transition from one layout to another</span></span><br></pre></td></tr></table></figure>

<p>如果我们想在删除、插入或者移动元素时或者之后做一些事情，则需要使用这个方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)performBatchUpdates:(<span class="keyword">void</span> (^ __<span class="keyword">nullable</span>)(<span class="keyword">void</span>))updates completion:(<span class="keyword">void</span> (^ __<span class="keyword">nullable</span>)(<span class="built_in">BOOL</span> finished))completion; <span class="comment">// allows multiple insert/delete/reload/move calls to be animated simultaneously. Nestable.</span></span><br></pre></td></tr></table></figure>













</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ammar</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://lizhaoloveit.cn/2015/06/23/UICollectionView/">http://lizhaoloveit.cn/2015/06/23/UICollectionView/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lizhaoloveit.cn">Ammar's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/iOS/">iOS    </a></div><div class="post_share"><div class="social-share" data-image="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2015/07/06/How-to-install-cocoapods/"><img class="prev_cover lozad" data-src="https://www.lizhaoloveit.cn/blogimages/blog/cover/1.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/2.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/3.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/4.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/5.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/6.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/7.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/8.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/9.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/10.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/11.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/12.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/13.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/14.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/15.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/16.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/17.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/18.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/19.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/20.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/21.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/22.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/23.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/24.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/25.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/26.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/27.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/28.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/29.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/31.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/32.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/33.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/34.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/35.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/36.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/37.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/38.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/39.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/40.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/41.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/42.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/43.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/44.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/45.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/46.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/47.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/48.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/49.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/50.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/51.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/52.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/53.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/54.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/55.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/56.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/57.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/58.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/59.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/60.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/62.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/63.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/64.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/65.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/66.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/67.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/68.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/69.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/70.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/71.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/72.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/73.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/74.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/75.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/76.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/77.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/78.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/79.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>How To Install Cocoapods</span></div></a></div><div class="next-post pull-right"><a href="/2015/06/20/%E5%BA%94%E7%94%A8%E9%97%B4%E8%B7%B3%E8%BD%AC/"><img class="next_cover lozad" data-src="https://www.lizhaoloveit.cn/blogimages/blog/cover/1.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/2.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/3.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/4.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/5.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/6.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/7.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/8.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/9.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/10.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/11.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/12.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/13.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/14.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/15.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/16.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/17.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/18.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/19.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/20.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/21.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/22.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/23.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/24.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/25.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/26.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/27.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/28.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/29.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/31.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/32.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/33.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/34.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/35.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/36.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/37.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/38.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/39.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/40.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/41.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/42.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/43.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/44.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/45.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/46.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/47.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/48.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/49.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/50.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/51.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/52.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/53.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/54.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/55.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/56.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/57.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/58.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/59.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/60.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/62.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/63.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/64.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/65.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/66.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/67.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/68.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/69.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/70.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/71.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/72.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/73.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/74.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/75.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/76.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/77.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/78.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/79.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>应用间跳转</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'http://lizhaoloveit.cn/2015/06/23/UICollectionView/';
  this.page.identifier = '2015/06/23/UICollectionView/';
  this.page.title = 'UICollectionView';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'lizhao' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2014 - 2023 By Ammar</div><div class="icp"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener"><span>浙ICP备19013619号-1</span></a></div><div class="bag"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010502006128" target="_blank" rel="noopener"><img src="/img/beian.png"><span>浙公网安备 33010502006128号</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="阅读模式"> </i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">繁</a><i class="far fa-moon nightshift" id="nightshift" title="夜间模式"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script async src="/js/search/algolia.js"></script><script src="/js/nightshift.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>