<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Servlet | Ammar's Blog</title><meta name="description" content="Servlet"><meta name="keywords" content="Servlet"><meta name="author" content="Ammar"><meta name="copyright" content="Ammar"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.1/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://lizhaoloveit.cn/2019/07/07/Servlet/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Servlet"><meta name="twitter:description" content="Servlet"><meta name="twitter:image" content="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Servlet"><meta property="og:url" content="http://lizhaoloveit.cn/2019/07/07/Servlet/"><meta property="og:site_name" content="Ammar's Blog"><meta property="og:description" content="Servlet"><meta property="og:image" content="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="UML 类图的6种连线示意" href="http://lizhaoloveit.cn/2019/07/08/UML%E7%B1%BB%E5%9B%BE%E7%9A%846%E7%A7%8D%E8%BF%9E%E7%BA%BF%E7%A4%BA%E6%84%8F/"><link rel="next" title="网络编程Socket" href="http://lizhaoloveit.cn/2019/07/07/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8BSocket/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?162506e75ffd64287398566b2f5738c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"VRMKRAV9AT","apiKey":"bd7157400046d0f02396708a501a3480","indexName":"lizhaoloveit","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://lizhaoloveit.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天'

  
}</script><meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#开发一个简单的servlet"><span class="toc-number">1.1.</span> <span class="toc-text">开发一个简单的servlet</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Servlet-原理"><span class="toc-number">2.</span> <span class="toc-text">Servlet 原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Tomcat-启动工作"><span class="toc-number">2.1.</span> <span class="toc-text">Tomcat 启动工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet-容器的启动过程"><span class="toc-number">2.1.1.</span> <span class="toc-text">Servlet 容器的启动过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用对应-Context容器-的启动过程"><span class="toc-number">2.1.2.</span> <span class="toc-text">应用对应 Context容器 的启动过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web-应用的初始化工作"><span class="toc-number">2.2.</span> <span class="toc-text">Web 应用的初始化工作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建-Servlet-实例"><span class="toc-number">2.2.1.</span> <span class="toc-text">创建 Servlet 实例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#初始化-Servlet"><span class="toc-number">2.2.2.</span> <span class="toc-text">初始化 Servlet</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Servlet-体系结构"><span class="toc-number">2.3.</span> <span class="toc-text">Servlet 体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet-的继承体系"><span class="toc-number">2.3.1.</span> <span class="toc-text">Servlet 的继承体系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ServletConfig"><span class="toc-number">2.3.2.</span> <span class="toc-text">ServletConfig</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ServletRequest-和-ServletResponse"><span class="toc-number">2.3.3.</span> <span class="toc-text">ServletRequest 和 ServletResponse</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Servlet-工作方式"><span class="toc-number">2.4.</span> <span class="toc-text">Servlet 工作方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Servlet-可以提供给我们的信息"><span class="toc-number">2.5.</span> <span class="toc-text">Servlet 可以提供给我们的信息</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Servlet-的使用"><span class="toc-number">3.</span> <span class="toc-text">Servlet 的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ServletConfig-接口的使用"><span class="toc-number">3.1.</span> <span class="toc-text">ServletConfig 接口的使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpServletRequest-接口"><span class="toc-number">3.2.</span> <span class="toc-text">HttpServletRequest 接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#请求编码问题"><span class="toc-number">3.2.1.</span> <span class="toc-text">请求编码问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpServletResponse-常用方法"><span class="toc-number">3.3.</span> <span class="toc-text">HttpServletResponse 常用方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-xml-配置细节"><span class="toc-number">3.4.</span> <span class="toc-text">web.xml 配置细节</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-xml-约束头"><span class="toc-number">3.4.1.</span> <span class="toc-text">web.xml 约束头</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet注解-web-xml配置"><span class="toc-number">3.4.2.</span> <span class="toc-text">Servlet注解(web.xml配置)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JSP"><span class="toc-number">4.</span> <span class="toc-text">JSP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#JSP-原理："><span class="toc-number">4.1.</span> <span class="toc-text">JSP 原理：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSP-语法："><span class="toc-number">4.2.</span> <span class="toc-text">JSP 语法：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSP-的三大指令"><span class="toc-number">4.3.</span> <span class="toc-text">JSP 的三大指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#page"><span class="toc-number">4.3.1.</span> <span class="toc-text">page</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#include"><span class="toc-number">4.3.2.</span> <span class="toc-text">include</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#taglib"><span class="toc-number">4.3.3.</span> <span class="toc-text">taglib</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#创建JavaWeb项目结构"><span class="toc-number">5.</span> <span class="toc-text">创建JavaWeb项目结构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#跳转和信息共享"><span class="toc-number">6.</span> <span class="toc-text">跳转和信息共享</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Web组件之间的跳转方式"><span class="toc-number">6.1.</span> <span class="toc-text">Web组件之间的跳转方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#请求转发-forward"><span class="toc-number">6.1.1.</span> <span class="toc-text">请求转发 forward</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#URL-重定向"><span class="toc-number">6.1.2.</span> <span class="toc-text">URL 重定向</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#有无-x2F-的区别"><span class="toc-number">6.1.3.</span> <span class="toc-text">有无&#x2F;的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Servlet-的三大作用域对象"><span class="toc-number">6.2.</span> <span class="toc-text">Servlet 的三大作用域对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#作用-用来共享数据"><span class="toc-number">6.3.</span> <span class="toc-text">作用:用来共享数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何取值："><span class="toc-number">6.4.</span> <span class="toc-text">如何取值：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数据如何共享"><span class="toc-number">6.5.</span> <span class="toc-text">数据如何共享:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ServletContext"><span class="toc-number">6.6.</span> <span class="toc-text">ServletContext</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#分页实现和设计"><span class="toc-number">7.</span> <span class="toc-text">分页实现和设计</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#过滤器"><span class="toc-number">8.</span> <span class="toc-text">过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#开发流程"><span class="toc-number">8.1.</span> <span class="toc-text">开发流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求编码过滤"><span class="toc-number">8.2.</span> <span class="toc-text">请求编码过滤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web-xml"><span class="toc-number">8.2.1.</span> <span class="toc-text">web.xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CharacterEncodingFilter"><span class="toc-number">8.2.2.</span> <span class="toc-text">CharacterEncodingFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CheckLoginFilte"><span class="toc-number">8.2.3.</span> <span class="toc-text">CheckLoginFilte</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dispatcher元素"><span class="toc-number">8.3.</span> <span class="toc-text">dispatcher元素</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://lizhaoloveit.cn/blogimages/blog/top_img.jpg)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">Ammar's Blog</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description">微信号：aicjaish</div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a><a class="site-page" href="/comment/"><i class="fa-fw fa fa-coffee"></i><span> 留言</span></a><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Servlet</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-07-07<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-07-29</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/">Java</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/%E6%9C%8D%E5%8A%A1%E5%99%A8/">服务器</a></span><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">9.9k</span><span class="post-meta__separator">|</span><span>阅读时长: 39 分钟</span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><hr>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><p>Servlet (Server Applet) 用 Java编写的服务器端程序，可以独立于平台和协议，用于交互式浏览和生成数据，生成动态 Web 内容。</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15624882001983-servlet.jpg"></p>
<p>Servlet 指 服务器端，和客户端产生交互需要接口，实现这些接口的类叫 Servlet</p>
<h2 id="开发一个简单的servlet"><a href="#开发一个简单的servlet" class="headerlink" title="开发一个简单的servlet"></a>开发一个简单的servlet</h2><hr>
<ol>
<li>导入依赖的 jar 包，安装路径：Library&#x2F;Tomcat&#x2F;lib&#x2F;servlet-api.jar</li>
<li>创建一个类实现 javax.servlet.Servlet 接口，实现5个方法</li>
<li>方法中有 arg0,arg1，解决方法，导入源码，<a href="https://tomcat.apache.org/download-80.cgi" target="_blank" rel="noopener">tomcat</a>，下载 Source Code，并且导入即可。</li>
<li>在 service 方法中打印一句话，</li>
<li>通知 Tomcat 服务器来管理咱们自定义的类，web 的配置文件 web.xml</li>
<li>服务器需要的配置文件为 server.xml</li>
</ol>
<p>将配置文件 <code>server.xml</code> 中加入标签<br><code>&lt;Context docBase=&quot;绝对路径&quot; path=&quot;day3&quot;/&gt;</code></p>
<p>作用：path 为 Context容器 的路径，Tomcat 会从conf&#x2F;server.xml文件，获取所有的Context 容器，判断哪个的 path 属性值为 <code>day3</code>，接着找到当前 Context容器 的docBase属性值，该属性值就是当前访问项目的根的路径。</p>
<p>web.xml：配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">version</span>=<span class="string">"2.4"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 这个xml 是配置 tomcat 服务器的，让服务器来将请求数据传递给 servlet 实现类 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 通过类名，找到类的全限定名，tomcat 就可以调用 Servlet 实现类和客户端通信 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span><span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 告诉服务器，HelloServlet 类会实现 Servlet 接口去做事情</span></span><br><span class="line"><span class="comment">    	有了全限定名，服务器内部可以通过反射创建该类的对象，将 ServletConfi 传递给我们 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>username<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>xiaoming<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 映射，将url-pattern 和管理该地址的类做映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- servlet-mapping 映射，作用是客户端通过path找到服务器域名</span></span><br><span class="line"><span class="comment">        后的地址，将路径和 servlet 类名关联，在通过映射找到 Servlet 实现类 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/hello<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>小 tips: 复制 .java 文件的全限定名是路径，复制 .class 文件的全限定名是 根路径Classpath开始 包名.class文件</p>
</blockquote>
<p>如何安装 Tomcat 移步<a href="https://www.lizhaoloveit.cn/2019/07/09/Mac%E5%AE%89%E8%A3%85Tomcat%E6%8F%92%E4%BB%B6/" target="_blank" rel="noopener">这里</a></p>
<h1 id="Servlet-原理"><a href="#Servlet-原理" class="headerlink" title="Servlet 原理"></a>Servlet 原理</h1><hr>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15626604585041-servlet.png"></p>
<h2 id="Tomcat-启动工作"><a href="#Tomcat-启动工作" class="headerlink" title="Tomcat 启动工作"></a>Tomcat 启动工作</h2><hr>
<p>Tomcat 的容器等级中， Context 容器直接管理 Servlet 在容器中的包装类 Wrapper，所以Context 容器如何运行会直接影响 Servlet 的工作方式</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15625733327185-servlet.jpg"></p>
<p>Tomcat 的容器分为四个等级，真正管理 Servlet 容器的是 Context 容器，一个 Context 对应一个 Web 工程。</p>
<p>清单1. Context 配置参数：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Context</span> <span class="attr">path</span>=<span class="string">"/projectOne"</span> <span class="attr">docBase</span>=<span class="string">"D:/projects/projectOne"</span> <span class="attr">reloadable</span>=<span class="string">"true"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>下面介绍 Tomcat 解析 Context 容器的过程。</p>
<h3 id="Servlet-容器的启动过程"><a href="#Servlet-容器的启动过程" class="headerlink" title="Servlet 容器的启动过程"></a>Servlet 容器的启动过程</h3><hr>
<p>清单 2 . 给 Tomcat 增加一个 Web 工程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Tomcat tomcat = getTomcatInstance(); </span><br><span class="line">File appDir = <span class="keyword">new</span> File(getBuildDirectory(), <span class="string">"webapps/examples"</span>); </span><br><span class="line">tomcat.addWebapp(<span class="keyword">null</span>, <span class="string">"/examples"</span>, appDir.getAbsolutePath()); </span><br><span class="line"><span class="comment">// 添加了 Context 容器后，启动 tomcat，启动</span></span><br><span class="line">tomcat.start(); </span><br><span class="line">ByteChunk res = getUrl(<span class="string">"http://localhost:"</span> + getPort() + </span><br><span class="line">              <span class="string">"/examples/servlets/servlet/HelloWorldExample"</span>); </span><br><span class="line">assertTrue(res.toString().indexOf(<span class="string">"&lt;h1&gt;Hello World!&lt;/h1&gt;"</span>) &gt; <span class="number">0</span>);</span><br></pre></td></tr></table></figure>
<p>清单1 的代码是创建一个 Tomcat 实例并且新增一个 Web 应用，启动 Tomcat 并调用其中一个 HelloworldExample Servlet，看是否正确返回预期数据。</p>
<p>Tomcat 的 addWebapp 方法如下：</p>
<p>清单 3 .Tomcat.addWebapp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * url 和 path  是这个应用在 Tomcat 的访问路径和这个应用的实际物理路径</span></span><br><span class="line"><span class="comment"> * 这两个参数与清单1中的两个参数是一致的。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Context <span class="title">addWebapp</span><span class="params">(Host host, String url, String path)</span> </span>&#123; </span><br><span class="line">       silence(url); </span><br><span class="line">       <span class="comment">// 创建一个 servlet 容器</span></span><br><span class="line">       Context ctx = <span class="keyword">new</span> StandardContext(); </span><br><span class="line">       ctx.setPath( url ); </span><br><span class="line">       ctx.setDocBase(path); </span><br><span class="line">       <span class="keyword">if</span> (defaultRealm == <span class="keyword">null</span>) &#123; </span><br><span class="line">           initSimpleAuth(); </span><br><span class="line">       &#125; </span><br><span class="line">       ctx.setRealm(defaultRealm); </span><br><span class="line">       ctx.addLifecycleListener(<span class="keyword">new</span> DefaultWebXmlListener()); </span><br><span class="line">       <span class="comment">/** </span></span><br><span class="line"><span class="comment">         * 重要的配置对象，这个类将会负责整个 Web 应用配置的解析工作。</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">       ContextConfig ctxCfg = <span class="keyword">new</span> ContextConfig(); </span><br><span class="line">       ctx.addLifecycleListener(ctxCfg); </span><br><span class="line">       ctxCfg.setDefaultWebXml(<span class="string">"org/apache/catalin/startup/NO_DEFAULT_XML"</span>); </span><br><span class="line">       <span class="comment">/** </span></span><br><span class="line"><span class="comment">         * 将这个 Context 容器加到父容器的 Host 中</span></span><br><span class="line"><span class="comment">         * </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">       <span class="keyword">if</span> (host == <span class="keyword">null</span>) &#123; </span><br><span class="line">           getHost().addChild(ctx); </span><br><span class="line">       &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">           host.addChild(ctx); </span><br><span class="line">       &#125; </span><br><span class="line">       <span class="keyword">return</span> ctx; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接着，会调用 Tomcat 的 start 方法启动 Tomcat ，Tomcat 的启动是基于观察者模式设计的，所有的容器都会集成一个 Lifecycle 接口，其管理着容器的整个生命中期，所有容器的修改和状态的改变都会通知已经注册的观察者(Listener)，</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15625811215882-servlet.jpg"></p>
<h3 id="应用对应-Context容器-的启动过程"><a href="#应用对应-Context容器-的启动过程" class="headerlink" title="应用对应 Context容器 的启动过程"></a>应用对应 Context容器 的启动过程</h3><hr>
<p>ContextConfig 集成了 LifecycleListener 接口，成为了 Context容器 的监听者，ContextConfig 是在调用清单3 时被加入到 StandardContext 容器中的，负责整个 Web 应用的配置文件的解析工作。</p>
<p>ContextConfig 的 init 方法将会主要完成以下工作：</p>
<ol>
<li>创建用于解析 xml 配置文件的 ContextDigester 对象</li>
<li>读取 context.xml 文件、Host 配置文件，Context 自身的配置文件，设置 Context 的DocBase</li>
</ol>
<p>在 init 方法完成后， Context 容器会执行 startInternal 方法，该方法主要有以下功能：</p>
<ol>
<li>创建读取源文件的对象，创建 ClassLoader 对象</li>
<li>设置应用的工作目录</li>
<li>启动相关的辅助类：logger、realm、resource</li>
<li>修改启动状态，通知观察者(Web 应用的配置)</li>
<li>子容器的初始化，获取 ServletContext 并设置必要的参数</li>
<li>初始化 <code>load on startup </code>的 Servlet(即初始化 Web 应用)</li>
</ol>
<h2 id="Web-应用的初始化工作"><a href="#Web-应用的初始化工作" class="headerlink" title="Web 应用的初始化工作"></a>Web 应用的初始化工作</h2><hr>
<p>Web 应用的初始化工作是在 ContextConfig 的 configureStart 方法中实现的，应用的初始化主要是要解析 web.xml 文件，这个文件描述了一个 Web 应用的关键信息，也是一个 Web 应用的入口。</p>
<p>Tomcat 首先会找 globalWebXml ，搜索路径是 engine 个工作目录下寻找以下两个文件中的任一个，<code>org/apache/catalin/startup/NO_DEFAULT_XML</code> 或 <code>conf/web.xml</code></p>
<p>接着会找 <code>hostWebXml</code> 这个文件可能会在 <code>System.getProperty(&quot;catalina.base&quot;)/conf/${EngineName}/${HostName}/web.xml.default</code></p>
<p>接着寻找应用的配置文件 <code>examples/WEB-INF/web.xml</code></p>
<p>web.xml 文件中的各个配置项将会被解析成响应的属性保存在 WebXml 对象中。</p>
<blockquote>
<p>如果当前应用支持 Servlet3.0，解析还将完成额外 9 项工作，这个额外的 9 项工作主要是为 Servlet3.0 新增的特性，包括 jar 包中的 META-INF&#x2F;web-fragment.xml 的解析以及对 annotations 的支持。</p>
</blockquote>
<p>接下来，会将 WebXml 对象的属性设置到 Context 容器中，这里包括创建 Servlet 对象、filter、listener 等等，这段代码再 WebXml 的 configureContext 方法中。</p>
<p>下面是解析 Servlet 的代码片段：</p>
<p>清单4.创建 Wrapper 实例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (ServletDef servlet : servlets.values()) &#123; </span><br><span class="line">           <span class="comment">// 创建包装对象</span></span><br><span class="line">           Wrapper wrapper = context.createWrapper(); </span><br><span class="line">           </span><br><span class="line">           String jspFile = servlet.getJspFile(); </span><br><span class="line">           <span class="keyword">if</span> (jspFile != <span class="keyword">null</span>) &#123; </span><br><span class="line">               wrapper.setJspFile(jspFile); </span><br><span class="line">           &#125; </span><br><span class="line">           <span class="keyword">if</span> (servlet.getLoadOnStartup() != <span class="keyword">null</span>) &#123; </span><br><span class="line">               wrapper.setLoadOnStartup(servlet.getLoadOnStartup().intValue()); </span><br><span class="line">           &#125; </span><br><span class="line">           <span class="keyword">if</span> (servlet.getEnabled() != <span class="keyword">null</span>) &#123; </span><br><span class="line">               wrapper.setEnabled(servlet.getEnabled().booleanValue()); </span><br><span class="line">           &#125; </span><br><span class="line">           wrapper.setName(servlet.getServletName()); </span><br><span class="line">           Map&lt;String,String&gt; params = servlet.getParameterMap(); </span><br><span class="line">           <span class="keyword">for</span> (Entry&lt;String, String&gt; entry : params.entrySet()) &#123; </span><br><span class="line">               wrapper.addInitParameter(entry.getKey(), entry.getValue()); </span><br><span class="line">           &#125; </span><br><span class="line">           wrapper.setRunAs(servlet.getRunAs()); </span><br><span class="line">           Set&lt;SecurityRoleRef&gt; roleRefs = servlet.getSecurityRoleRefs(); </span><br><span class="line">           <span class="keyword">for</span> (SecurityRoleRef roleRef : roleRefs) &#123; </span><br><span class="line">               wrapper.addSecurityReference( </span><br><span class="line">                       roleRef.getName(), roleRef.getLink()); </span><br><span class="line">           &#125; </span><br><span class="line">           wrapper.setServletClass(servlet.getServletClass()); </span><br><span class="line">           MultipartDef multipartdef = servlet.getMultipartDef(); </span><br><span class="line">           <span class="keyword">if</span> (multipartdef != <span class="keyword">null</span>) &#123; </span><br><span class="line">               <span class="keyword">if</span> (multipartdef.getMaxFileSize() != <span class="keyword">null</span> &amp;&amp; </span><br><span class="line">                       multipartdef.getMaxRequestSize()!= <span class="keyword">null</span> &amp;&amp; </span><br><span class="line">                       multipartdef.getFileSizeThreshold() != <span class="keyword">null</span>) &#123; </span><br><span class="line">                   wrapper.setMultipartConfigElement(<span class="keyword">new</span> </span><br><span class="line">MultipartConfigElement( </span><br><span class="line">                           multipartdef.getLocation(), </span><br><span class="line">                           Long.parseLong(multipartdef.getMaxFileSize()), </span><br><span class="line">                           Long.parseLong(multipartdef.getMaxRequestSize()), </span><br><span class="line">                           Integer.parseInt( </span><br><span class="line">                                   multipartdef.getFileSizeThreshold()))); </span><br><span class="line">               &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                   wrapper.setMultipartConfigElement(<span class="keyword">new</span> </span><br><span class="line">MultipartConfigElement( </span><br><span class="line">                           multipartdef.getLocation())); </span><br><span class="line">               &#125; </span><br><span class="line">           &#125; </span><br><span class="line">           <span class="keyword">if</span> (servlet.getAsyncSupported() != <span class="keyword">null</span>) &#123; </span><br><span class="line">               wrapper.setAsyncSupported( </span><br><span class="line">                       servlet.getAsyncSupported().booleanValue()); </span><br><span class="line">           &#125; </span><br><span class="line">           context.addChild(wrapper); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码清楚的将 Servlet 包装成 Context 容器中的 StandardWrapper， </p>
<p><strong>为什么要把 Servlet 包装成 Context 容器中的 StandardWrapper 对象</strong></p>
<blockquote>
<p>StandardWrapper 是 Tomcat 容器中的一部分，具备容器的特征，Servlet 是一个独立的 web 开发标准，不应该强耦合在 Tomcat 中。</p>
</blockquote>
<p>Context 不仅包含了 standardWrpper ，还有 web.xml 的所有属性。所以 Context 容器才是真正运行 Servlet 的 Servlet 容器，一个 Web 应用对应一个 Context 容器。 </p>
<h3 id="创建-Servlet-实例"><a href="#创建-Servlet-实例" class="headerlink" title="创建 Servlet 实例"></a>创建 Servlet 实例</h3><hr>
<p>前面已经完成了 Servlet 的解析工作，Servlet 的类也被包装成 StandardWrapper 添加在 Context 容器中了，但是它还没有被实例化。</p>
<p>在解析配置文件时会读取默认的 globalWebXml，在 conf 下的 web.xml 文件中定义了两个 Servlet 分别是 <code>org.apache.catalina.servlets.DefaultServlet</code> 和 <code>org.apache.jasper.servlet.JspServlet</code> 他们的 <code>load-on-startup</code> 属性分别是 1 和 3。 如果 Servlet 的 load-on-startup 配置项大于0，在 Context 容器启动的时候就会被实例化，所以当 Tomcat 启动这两个 Servlet 就会启动。</p>
<p>创建 Servlet 实例的方法是从 Wapper.loadServlet 开始，loadServlet 方法要做的事情是获取 servletClass 然后把它交给 InstanceManager 创建一个基于 servletClass.class 的对象(这里其实就是通过反射创建对象)，如果 Servlet 配置了 jsp-file，那么这个 servletClass 就是conf&#x2F;web.xml 中定义的 <code>org.apache.jasper.servlet.JspServlet</code> 了。</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15625861755568-servlet.jpg"></p>
<p>上图可关联<a href="https://www.lizhaoloveit.cn/2019/07/08/UML%E7%B1%BB%E5%9B%BE%E7%9A%846%E7%A7%8D%E8%BF%9E%E7%BA%BF%E7%A4%BA%E6%84%8F/" target="_blank" rel="noopener">UML类图连线示意</a>一起食用</p>
<h3 id="初始化-Servlet"><a href="#初始化-Servlet" class="headerlink" title="初始化 Servlet"></a>初始化 Servlet</h3><hr>
<p>初始化 <code>Servlet</code> 在 <code>StandardWrpper</code> 的 <code>initServlet</code> 方法中，就是调用了 <code>Servlet</code> 的 <code>init</code> 方法，同时把 <code>StandardWrapper</code> 的 <code>StandardWrapperFacade</code> 作为 <code>ServletConfig</code> 传给 <code>Servlet</code>。</p>
<blockquote>
<p>Tomcat 容器为什么要把 StandardWrapperFacade 给 Servlet 对象呢？</p>
</blockquote>
<p>如果 Servlet 关联的是 jsp文件，那么前面初始化的就是 JspServlet ，接下来会模拟一次简单的请求，请求调用这个 jsp 文件，以编译这个 jsp 文件为 class，并且初始化这个 class。</p>
<p>这样，Servlet 对象就初始化完成了，实际情况是 Servlet 从被 web.xml 中解析到完成初始化，这个过程非常复杂，中间有很多过程，包括各种容器状态的转化引起的监听事件的触发、各种访问权限的控制和一些不可预料的错误发生的判断行为等等。</p>
<p>下图是完整的时序图，忽略了一些细节。</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15626331911222-servlet.jpg"></p>
<h2 id="Servlet-体系结构"><a href="#Servlet-体系结构" class="headerlink" title="Servlet 体系结构"></a>Servlet 体系结构</h2><hr>
<blockquote>
<p>Java Web 应用基于 Servlet 规范运转，Servlet 本身又如何运转，为何要设计这样的体系结构？</p>
</blockquote>
<p>顶层关联图</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15626340836838-servlet.jpg"></p>
<p>与 Servlet 主动关联的是3个类，<code>ServletConfig</code>、<code>ServletRequest</code>、<code>ServletResponse</code>，这3个类都是通过容器传递给 Servlet 的</p>
<p>其中 <code>ServletConfig</code> 是在 Servlet 初始化的时候就传给 Servlet(StandardWrapperFacade) 了，</p>
<p>后面两个是在请求达到时调用 Servlet 传递过来的，我们都知道是什么意思。 ServletConfig 接口中声明的方法都是为了获取这个 Servlet 的一些配置属性，这些属性可能在 Servlet 运行时被用到。</p>
<p>Servlet 的运行模式是 握手型的交互式 模式，两个模块为了交换数据，通常都会准备一个连接场景，这个场景一直跟随这这个连接过程直到连接完成。连接场景的初始化时根据连接对象指定的参数定制的，参数通常是一个配置类，所以连接场景就由 ServletContext 来描述，ServletContext 的集合就由 ServletConfig 描述，而 ServletRequest 和 ServletResponse 就是需要交互的对象，它们作为运输工具传递交互结果。</p>
<h3 id="Servlet-的继承体系"><a href="#Servlet-的继承体系" class="headerlink" title="Servlet 的继承体系"></a>Servlet 的继承体系</h3><hr>
<p><code>Command + t</code> 可以看到一个类的继承体系</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHttpServlet</span> <span class="keyword">extends</span> <span class="title">GenericServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		HttpServletRequest request = (HttpServletRequest) req;</span><br><span class="line">		HttpServletResponse response = (HttpServletResponse) res;</span><br><span class="line">		service(request, response);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletRequest res)</span> <span class="keyword">throws</span> ServletException, IOException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实际上，httpServlet 内部就是这么做的。所以我们只需要继承 httpServlet 就可以对 http 请求进行操作。</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15627428764567-servlet.png"></p>
<h3 id="ServletConfig"><a href="#ServletConfig" class="headerlink" title="ServletConfig"></a>ServletConfig</h3><hr>
<p>ServletConfig 在容器中的类关联图</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15626526651923-servlet.jpg"></p>
<p>Tomcat 的 context 容器中，StrandardWrapper 和 StandardWrapperFacade 都实现了 ServletConfig 接口，保证传给 Servlet 的 StandardWrapper 对象可以拿到 ServletConfig 规定的数据，而不会把 ServletConfig 不关心的数据暴露给 Servlet</p>
<p>ServletContext 也和 ServletConfig 有类似的结构，Servlet 中拿到的 ServletContext 的实际对象是 ApplicationContextFacade 对象，同样保证了 ServletContext 只能从其中拿到它该拿的数据，它们使用的都是门面设计模式</p>
<p>通过 ServletContext 可以拿到 Context 容器中一些必要的信息，比如应用的工作路径，容器支持的 Servlet 最小版本等等。</p>
<h3 id="ServletRequest-和-ServletResponse"><a href="#ServletRequest-和-ServletResponse" class="headerlink" title="ServletRequest 和 ServletResponse"></a>ServletRequest 和 ServletResponse</h3><hr>
<p>我们创建 request 和 response 对象时候，通常都是使用 HttpServletrequest 和 HttpServletResponse，它们继承了 ServletRequest 和 ServletResponse。下图为Request 相关类结构图</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15626531935426-servlet.jpg"></p>
<p>Tomcat 接受到请求，首先会创建 <code>org.apache.coyote.Request</code> 和 <code>org.apache.coyote.Response</code>，这两个类是 Tomcat 内部使用的描述一次请求和响应的信息类，它们是轻量级类，作用是在服务器接受到请求后，经过简单的解析将请求快速分配给后续线程处理。这两个对象很小，很容易被 GC 回收。</p>
<p>交给用户线程去处理请求时，又会创建 <code>org.apache.catalina.connector.Request</code> 和 <code>org.apache.catalina.connector.Response</code> 对象，这两个对象会穿越整个 Servlet 容器直到要传给 Servlet。</p>
<p>和上面的 ServletConfig 和 ServletContext 一样， Request 和 Response 传递给 Servlet 接口的也是包装过的门面类 RequestFacade 和 RequestFacade，封装容器中的数据，屏蔽掉不需要的信息。</p>
<h2 id="Servlet-工作方式"><a href="#Servlet-工作方式" class="headerlink" title="Servlet 工作方式"></a>Servlet 工作方式</h2><hr>
<p>用户发起请求，会包含如下信息：<a href="http://hostname:port/contextpath/servletpath">http://hostname:port/contextpath/servletpath</a>, hostname 和 port 是用来与服务器建立 TCP 连接，后面的 URL 才是选择服务器中的哪个子容器服务用户的请求，服务器是如何通过这个 URL 来达到正确的 Servlet 容器中？</p>
<p>这种映射工作专门由一个类完成 <code>org.apache.tomcat.util.http.mapper</code>，这个类保存了 Tomcat 的 Container 容器的所有子容器的信息，当 Request 类进入 Container 容器之前，mapper 会根据这次请求的 hostname 和 contextpath 将 host 和 context 容器设置到 Request 的 mappingData 属性中，所以当 Request 进入 Container 之前，它要访问哪个子容器就已经确定了。</p>
<p>下图为 Request 和 Mapper 的关系图</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15626589573409-servlet.jpg"></p>
<blockquote>
<p>MapperListener 类的初始化过程(为什么 mapper 会有容器的所有子容器)</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MapperListener.init</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123; </span><br><span class="line">       <span class="comment">// 找到 host</span></span><br><span class="line">       findDefaultHost();</span><br><span class="line">       <span class="comment">// 获取 容器</span></span><br><span class="line">       Engine engine = (Engine) connector.getService().getContainer(); </span><br><span class="line">       <span class="comment">// 添加 MapperListener 到容器中</span></span><br><span class="line">       engine.addContainerListener(<span class="keyword">this</span>); </span><br><span class="line">       <span class="comment">// 获取子容器</span></span><br><span class="line">       Container[] conHosts = engine.findChildren(); </span><br><span class="line">       <span class="keyword">for</span> (Container conHost : conHosts) &#123; </span><br><span class="line">           Host host = (Host) conHost; </span><br><span class="line">           <span class="keyword">if</span> (!LifecycleState.NEW.equals(host.getState())) &#123; </span><br><span class="line">               <span class="comment">// 将 mapperListener 到所有的子容器中</span></span><br><span class="line">               host.addLifecycleListener(<span class="keyword">this</span>); </span><br><span class="line">               registerHost(host); </span><br><span class="line">           &#125; </span><br><span class="line">       &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上述代码做的事情就是将 MapperListener 作为监听者添加到整个 Container 容器中的每个子容器中。</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15626604585040-servlet.png"></p>
<p>上图描述了一次 Request 请求是如何达到最终的 Wrapper 容器的，但是在达到最终的 Servlet 前，还要完成一些步骤，必须要执行 Filter 链，以及要通知你在 web.xml 中定义的 listener。</p>
<p>接下来就要执行 Servlet 的 service 方法了，通常，我们自己定义的 servlet 并不直接实现 <code>javax.servlet.Servlet</code>，类，而是去继承更简单的 HttpServlet 类或者 GenericServlet 类，有选择的覆盖相应的方法去实现我们要完成的工作。</p>
<p>Servlet 的确已经帮我们完成了所有的工作，但是现在 web 应用很少有直接将交互全部页面都用 servlet 来实现， 而是采用更加高效的 MVC 框架来实现。这些 MVC 框架基基本的原理都是将所有的请求都映射到一个 Servlet，然后去实现 service 方法，这个方法也是 MVC 框架的入口。</p>
<p>当 Servlet 从 Servlet 容器中移除时，就表明该 Servlet 的生命周期结束了，这时 Servlet 的 destroy 方法会被调用。</p>
<h2 id="Servlet-可以提供给我们的信息"><a href="#Servlet-可以提供给我们的信息" class="headerlink" title="Servlet 可以提供给我们的信息"></a>Servlet 可以提供给我们的信息</h2><hr>
<p>Servlet 能够给我们提供两部分数据，一个是 Servlet 初始化时设置的 ServletConfig，这个类基本涵盖了 Servlet 本身 和 Servlet 运行的容器的基本信息，ServletConfig 的实际对象是 StandardWrapperFacade，看看接口就可以知道有哪些信息。</p>
<p>还有一部分数据是 ServletRequest 类提供，实际对象是 RequestFacade，主要描述请求的 HTTP 协议信息，所以要掌握 Servlet 的工作方式，必须要清楚 HTTP 协议。关于这一块，还有 Session 与 Cookie。</p>
<h1 id="Servlet-的使用"><a href="#Servlet-的使用" class="headerlink" title="Servlet 的使用"></a>Servlet 的使用</h1><hr>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15627428764566-servlet.jpg"></p>
<h2 id="ServletConfig-接口的使用"><a href="#ServletConfig-接口的使用" class="headerlink" title="ServletConfig 接口的使用"></a>ServletConfig 接口的使用</h2><hr>
<p>方法：</p>
<ul>
<li><code>String getServletName()</code> 获取 Servlet 的 name 信息，web.xml中当前 <code>&lt;servlet&gt;</code> 中 <servlet-name> 中的文本。</li>
<li><code>ServletContext getServletContext()</code> 获取上下文对象</li>
<li><code>String getInitParameter(String name</code> 根据参数名称来获取初始化参数的值</li>
<li><code>Enumeration&lt;String&gt; getInitParameterNames()</code> 获取所有初始化参数的名称</li>
</ul>
<blockquote>
<p>需求：在 service 方法中做编码的判断处理，如果是 utf-8 则打印中文，如果不是打印英文</p>
</blockquote>
<p>xml 中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>username<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>xiaoming<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    	<span class="comment">&lt;!-- 告诉服务器，HelloServlet 类会实现 Servlet 接口去做事情</span></span><br><span class="line"><span class="comment">    	有了全限定名，服务器内部可以通过反射去创建该类的对象，调用方法，</span></span><br><span class="line"><span class="comment">    	实际上就是 url 中的 baidu.com/(类型调用的方法的返回值) --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>servlet.HelloServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>HelloServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span> <span class="comment">&lt;!-- 类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">// 获取 web.xml 中当前 Servlet 配置的初始化参数值</span></span><br><span class="line">	String encoding = config.getInitParameter(<span class="string">"encoding"</span>);</span><br><span class="line">	String username = config.getInitParameter(<span class="string">"username"</span>);</span><br><span class="line">	</span><br><span class="line">	System.out.println(username);</span><br><span class="line">	System.out.println(encoding);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span> (<span class="string">"utf-8"</span>.equals(encoding)) &#123;</span><br><span class="line">		System.out.println(<span class="string">"你好"</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	Enumeration&lt;String&gt; names = config.getInitParameterNames();</span><br><span class="line">	<span class="keyword">while</span> (names.hasMoreElements()) &#123;</span><br><span class="line">		String name = names.nextElement();</span><br><span class="line">		String value = config.getInitParameter(name);</span><br><span class="line">		System.out.println(name + <span class="string">":"</span> + value);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="HttpServletRequest-接口"><a href="#HttpServletRequest-接口" class="headerlink" title="HttpServletRequest 接口"></a>HttpServletRequest 接口</h2><hr>
<p>ServletRequest 的子接口，封装了请求的数据以及操作符合 http 协议相关的方法</p>
<p>常用的方法：</p>
<ol>
<li>getMethod 返回请求方式</li>
<li>getRequestURI 返回请求行中的资源名字部分 &#x2F;test&#x2F;index.html</li>
<li>getRequestURL 返回浏览器地址栏中的所有信息<ul>
<li>返回客户端请求的完整 URL(包括协议、服务器名、端口号、资源路径信息)，不含查询参数</li>
</ul>
</li>
<li>getContextPath 获取当前项目上下文路径<Context />标签的 path 属性</li>
<li>getRemoteAddr 返回发出请求的客户机的 IP 地址</li>
<li>getHeader 返回指定名称的头字段的值。</li>
<li>setCharacterEncoding(String env) 设置字符集编码</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	System.out.println(req.getMethod()); <span class="comment">// GET</span></span><br><span class="line">	System.out.println(req.getRequestURI()); <span class="comment">// /config	</span></span><br><span class="line">	System.out.println(req.getRequestURL()); <span class="comment">// http://localhost/config</span></span><br><span class="line">	System.out.println(req.getContextPath()); <span class="comment">// 获取 &lt;Context /&gt; 的 path 属性</span></span><br><span class="line">	System.out.println(req.getRemoteAddr()); <span class="comment">// 0:0:0:0:0:0:0:1 客户机的 IP 地址</span></span><br><span class="line">	System.out.println(req.getHeader(<span class="string">"User-Agent"</span>));</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * username :xiaoming</span></span><br><span class="line"><span class="comment">	 * [java, c]</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	System.out.println(<span class="string">"username :"</span> + req.getParameter(<span class="string">"username"</span>));</span><br><span class="line">	String[] values = req.getParameterValues(<span class="string">"hobby"</span>);</span><br><span class="line">	System.out.println(Arrays.toString(values));</span><br><span class="line">	</span><br><span class="line">	Enumeration&lt;String&gt; parameterNames = req.getParameterNames();</span><br><span class="line">	<span class="keyword">while</span> (parameterNames.hasMoreElements()) &#123;</span><br><span class="line">		String string = (String) parameterNames.nextElement();</span><br><span class="line">		System.out.println(string);</span><br><span class="line">		<span class="comment">// username hobby</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * key:username,vlaue:[Ljava.lang.String;@76c783cb</span></span><br><span class="line"><span class="comment">	 * key:hobby,vlaue:[Ljava.lang.String;@78006363</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	Map&lt;String, String[]&gt; map = req.getParameterMap();</span><br><span class="line">	Set&lt;String&gt; set = map.keySet();</span><br><span class="line">	<span class="keyword">for</span> (String key : set) &#123;</span><br><span class="line">		System.out.println(<span class="string">"key:"</span> + key + <span class="string">",vlaue:"</span> + map.get(key));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15627428764568-servlet.png"></p>
<p>获取表单请求参数：</p>
<ol>
<li>&#96;String getParameter(String name) 返回指定名字参数的值</li>
<li><code>String[] getParameterValues(String name)</code> 返回指定名字参数的多个参数值</li>
<li>&#96;Enumeration<String> getParameterNames() 返回所有参数名的 Enumeration 对象</li>
<li>&#96;Map&lt;String, String[]&gt; getParameterMap() 返回所有的参数和值所组成的 Map 对象</li>
</ol>
<p>开发中，表单一般使用 POST 请求</p>
<h3 id="请求编码问题"><a href="#请求编码问题" class="headerlink" title="请求编码问题"></a>请求编码问题</h3><hr>
<p><strong>乱码的原因：Tomcat 服务器在处理 get 和 post 请求时，使用的是 ISO-8859-1 编码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 序列化版本 id</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">1L</span>;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">	<span class="comment">// 设置字符集编码，此方法只支持 post 请求，在 Tomcat 8 之前不支持 get 请求</span></span><br><span class="line">	req.setCharacterEncoding(<span class="string">"UTF-8"</span>);</span><br><span class="line">	</span><br><span class="line">	System.out.println(<span class="string">"id="</span> + req.getParameter(<span class="string">"id"</span>));</span><br><span class="line">	System.out.println(<span class="string">"username="</span> + req.getParameter(<span class="string">"username"</span>));</span><br><span class="line">	System.out.println(<span class="string">"password="</span> + req.getParameter(<span class="string">"password"</span>));</span><br><span class="line">	System.out.println(<span class="string">"sex="</span> + req.getParameterValues(<span class="string">"sex"</span>));</span><br><span class="line">	System.out.println(<span class="string">"hobby="</span> + req.getParameterValues(<span class="string">"hobby"</span>));</span><br><span class="line">	System.out.println(<span class="string">"address="</span> + req.getParameter(<span class="string">"address"</span>));</span><br><span class="line">	System.out.println(<span class="string">"intro="</span> + req.getParameter(<span class="string">"intro"</span>));</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 写中文变成乱码</span></span><br><span class="line"><span class="comment">	 * 乱码的原因：Tomcat 服务器在处理 get 和 post 请求时，使用的是 ISO-8859-1 编码</span></span><br><span class="line"><span class="comment">	 * 此编码格式不支持中文</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decodeISO</span><span class="params">(String isoCode)</span> </span>&#123;</span><br><span class="line">	String utf8 = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">byte</span>[] buff = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		buff = isoCode.getBytes(<span class="string">"ISO-8859-1"</span>);</span><br><span class="line">		utf8 = <span class="keyword">new</span> String(buff);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> utf8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如何处理 GET 请求乱码问题<br>在 server.xml 中 70 行，<code>&lt;connector&gt;</code>标签下，Tomcat8之前默认是有一条属性，URIEncoding&#x3D;”ISO-8859-1” 改为 “utf-8” 即可。</p>
</blockquote>
<h2 id="HttpServletResponse-常用方法"><a href="#HttpServletResponse-常用方法" class="headerlink" title="HttpServletResponse 常用方法"></a>HttpServletResponse 常用方法</h2><hr>
<p>ServletResponse 接口 表示响应对象，做响应处理，封装了响应的一些 API<br>HttpServletResponse 接口 ServletResponse 的子接口，封装了 符合 http协议相关的响应方法</p>
<p>常用方法：</p>
<ol>
<li><code>OutputStream getOutStream()</code> 获取字节输出流对象，文件下载</li>
<li><code>PrintWriter getWriter()</code> 获取字符输出流对象，上述方法无法共存，否则报错<br> <img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15628170284557-servlet.jpg"></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">response.setContentType(<span class="string">"text/html"</span>); <span class="comment">// 设置输出的 MIME 类型</span></span><br><span class="line">response.setCaracterEncoding(<span class="string">"UTF-8"</span>); <span class="comment">// 设置输出数据的编码方式</span></span><br><span class="line">response.setContentType(<span class="string">"test/html;charset=utf-8"</span>); <span class="comment">// 可以将上述两行代码合并成一行代码</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>必须先设置 MIME 类型和编码，在获取输出流，否则没有效果</strong></p>
</blockquote>
<h2 id="web-xml-配置细节"><a href="#web-xml-配置细节" class="headerlink" title="web.xml 配置细节"></a>web.xml 配置细节</h2><hr>
<ol>
<li><p>Servet-name 不能使用 <code>default</code> 这个值</p>
<ul>
<li>原因：在 Tomcat&#x2F;conf&#x2F;web.xml 中配置了一个 servlet-name 为 <code>default</code> 的DefaultServlet，这个 Servlet 是用来处理静态资源的访问，如果我们配置了就覆盖了 DefaultServlet 的功能</li>
</ul>
</li>
<li><p>映射路径<code>&lt;url-pattern&gt;</code></p>
<ul>
<li>可以配置多个 <code>&lt;url-pattern&gt;</code> 注意：资源路径需要唯一，需要使用&#x2F;开头</li>
<li>配置多个 <code>&lt;servlet-mapping&gt;</code></li>
</ul>
</li>
<li><p>通配符：在<url-pattern> 中使用通配符</p>
<ul>
<li>*表示任意字符</li>
<li>&#x2F;*：任意的资源路径都可以访问的 servlet</li>
<li>&#x2F;ooxx&#x2F;*：任意以&#x2F;ooxx&#x2F;开头的资源路径都可以访问到 servlet</li>
<li>*.ooxx：任意以.ooxx结尾的资源路径都可以访问到 servlet，不能加&#x2F;</li>
</ul>
</li>
<li><p>配置欢迎页面</p>
<ul>
<li>默认是 Tomcat&#x2F;conf&#x2F;web.xml</li>
</ul>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- 配置欢迎页面，这个标签会覆盖 tomcat 的 web.xml 配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>/welcome.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>服务器启动初始化 servlet 配置</p>
<ul>
<li>设置 Servlet 的启动优先级就 OK</li>
<li><code>&lt;load-on-startup&gt;</code> 中间的数字表示执行的优先级别，数值越小优先级越高</li>
</ul>
<blockquote>
<p><code>&lt;load-on-startup&gt;</code>参数的作用：如果 init 方法中的代码比较多，第一个用户就会等待很久，调整优先级会保证 Servlet 在服务器启动时就会去初始化。</p>
</blockquote>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 服务器启动就创建对象调用 init 方法，在&lt;servlet&gt;标签下 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="web-xml-约束头"><a href="#web-xml-约束头" class="headerlink" title="web.xml 约束头"></a>web.xml 约束头</h3><hr>
<p>JDK 1.7+</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">version</span>=<span class="string">"3.1"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>JDK 1.6+</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">version</span>=<span class="string">"3.0"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>JDK 1.5+</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span>  </span></span><br><span class="line"><span class="tag">        <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</span> </span><br><span class="line">      version="3.1"&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;web-app xmlns=<span class="string">"http://java.sun.com/xml/ns/j2ee"</span>   </span><br><span class="line">    xmlns:xsi=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>  </span><br><span class="line">    xsi:schemaLocation=<span class="string">"http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"</span> </span><br><span class="line">    version=<span class="string">"2.4"</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="Servlet注解-web-xml配置"><a href="#Servlet注解-web-xml配置" class="headerlink" title="Servlet注解(web.xml配置)"></a>Servlet注解(web.xml配置)</h3><p>在 Servlet 类上贴一个标签,<code>@WebServlet(path)</code>，path 就相当 <code>&lt;url-pattern&gt;</code>中的内容</p>
<p>web.xml中<code>metadata-complete=&quot;true&quot;</code>表示是否忽略扫描注解</p>
<ul>
<li>metadata-complete&#x3D;”false” 扫描注解(默认)</li>
<li>metadata-complete&#x3D;”true” 不扫描注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(value = <span class="string">"/register"</span>, initParams = &#123;<span class="meta">@WebInitParam</span>(name = <span class="string">"encoding"</span>, value = <span class="string">"utf-8"</span>)&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AnnotationServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"进来了"</span>);</span><br><span class="line">		System.out.println(<span class="keyword">this</span>.getServletConfig().getInitParameter(<span class="string">"encoding"</span>));</span><br><span class="line">		<span class="comment">// utf-8</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">version</span>=<span class="string">"3.1"</span> <span class="attr">metadata-complete</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">&lt;!-- metadata-complete 表示是否忽略扫描注解，true 是不扫描，false 是扫描 --&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注解存在硬编码，需要根据需求来选用。一般通用的配置用注解，个性化的配置用 web.xml。防止硬编码的存在</p>
</blockquote>
<h1 id="JSP"><a href="#JSP" class="headerlink" title="JSP"></a>JSP</h1><hr>
<p>目的：前后端分离，不在 Java 中书写 html</p>
<p>使用：</p>
<ol>
<li>创建一个 jsp 文件</li>
<li>修改了 jsp 的默认编码</li>
<li>在 jsp 页面中可以直接书写引用 java 代码 <code>&lt;%=new Date() %&gt;</code></li>
<li>web.xml 配置<br> <img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15628177881468-servlet.jpg"></li>
</ol>
<h2 id="JSP-原理："><a href="#JSP-原理：" class="headerlink" title="JSP 原理："></a>JSP 原理：</h2><hr>
<ol>
<li>所有的.jsp 结尾的操作交给 JspServlet 处理</li>
<li>jsp文件转为 java 文件</li>
<li>java  编译为 class 文件</li>
<li>执行 class 文件</li>
</ol>
<p><code>/Library/Tomcat/work/Catalina</code> 路径下存放着你的jsp运行时会产生的 .java 和 .class 文件</p>
<h2 id="JSP-语法："><a href="#JSP-语法：" class="headerlink" title="JSP 语法："></a>JSP 语法：</h2><hr>
<ol>
<li><p>JSP 的注释：</p>
<ul>
<li><code>&lt;%--这是注释，不会翻译到 Servlet 中--%&gt;</code></li>
</ul>
</li>
<li><p>JSP 中的 Java 脚本片段：</p>
<ul>
<li><strong>实际开发中，应做到 JSP 中不能出现一行 Java 脚本片段</strong></li>
<li>语法：</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    语句<span class="number">1</span>;</span><br><span class="line">    语句<span class="number">2</span>;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>
<p> <img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15628177881469-servlet.png"></p>
<ul>
<li>原理：其中的语句会原封不动的被服务器翻译到对应的 Servlet 的 _jspService 方法中</li>
</ul>
</li>
<li><p>JSP 的 Java 脚本表达式：</p>
<ul>
<li><code>&lt;%=表达式%&gt;</code> 利用输出流打印到页面上，out.print(表达式);</li>
</ul>
</li>
<li><p>JSP 的声明：</p>
<ul>
<li>定义类的成员</li>
<li>语法：</li>
</ul>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;%!</span><br><span class="line">    Java 代码</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="JSP-的三大指令"><a href="#JSP-的三大指令" class="headerlink" title="JSP 的三大指令"></a>JSP 的三大指令</h2><p>设定 JSP 网页的整体配置信息</p>
<p>特点：不向客户端产生任何输出，指令在 JSP 整个文件内有效，为翻译阶段提供全局信息</p>
<p>语法：<code>&lt;%@ 指令  属性 %&gt;</code></p>
<h3 id="page"><a href="#page" class="headerlink" title="page"></a>page</h3><p>每个 jsp 页面都需要存在的一个指令，定义 JSP 页面的各种属性</p>
<ul>
<li><p>language JSP 页面中使用脚本语言，默认值java，目前只支持 Java</p>
</li>
<li><p>extends 指示 JSP 对应的 Servlet 类的父类，不要修改</p>
</li>
<li><p>*import 导入 JSP 中的 Java 脚本使用到的类或包。(Java的 import语句)</p>
</li>
<li><p>JSP 引擎自动导入以下包：<code>javax.servlet.*</code>、<code>javax.servlet.http.*</code>、<code>javax.servlet.jsp</code></p>
</li>
<li><p>*session 指示 JPS 页面是否创建 HttpSession 对象，默认值是 true</p>
</li>
<li><p>*buffer 指示 JSP 用的输出流的缓存大小，默认值是8kb</p>
</li>
<li><p>autoFlush 自动刷新输出流的缓存</p>
</li>
<li><p><del>isThreadSafe 指示页面是否是线程安全的，默认是 ture (已过时)</del></p>
</li>
<li><p>*errorPage 指示当前页面出错后转发的页面，目标页面如果以”&#x2F;“(当前应用)就是绝对路径</p>
<ul>
<li>配置全局错误提示页面： web.xml</li>
</ul>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exception-type</span>&gt;</span>java.lang.Exception<span class="tag">&lt;/<span class="name">exception-type</span>&gt;</span>    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/error.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span><span class="tag">&lt;<span class="name">error-page</span>&gt;</span><span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span>    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/404.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>*isErrorPage 指示当前页面是否产生 Exception 对象</p>
</li>
<li><p>*contextType 指定当前页面的 MIME 类型，(同 response.setContentType())</p>
</li>
<li><p>*pageEncoding 通知引擎读取 JSP 时采用的编码，还有contentType</p>
</li>
<li><p>*isELIgnored 是否忽略 EL 表达式 ${1+1}，默认是 false</p>
</li>
</ul>
<p>page 指令最简单的使用方式：</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> contentType=<span class="string">"text/html; charset=UTF-8"</span></span><br><span class="line">    pageEncoding=<span class="string">"UTF-8"</span> deferredSyntaxAllowedAsLiteral=<span class="string">"true"</span>%&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>deferredSyntaxAllowedAsLiteral 参数<br>解决了不能使用 #{…} 取值的问题<br>该属性是在JSP 2.1规范中引入的，JSP 2.1规范对JSP 2.0和Java Server Faces 1.1中的表达式语言进行了统一。在JSP 2.1中，字符序列#{被保留给表达式语言使用，你不能在模板本中使用字符序列#{。如果JSP页面运行在JSP 2.1之前版本的容器中，则没有这个限制。对于JSP 2.1的容器，如果在模板文本中需要出现字符序列#{，那么可以将该属性设置为true。</p>
</blockquote>
<h3 id="include"><a href="#include" class="headerlink" title="include"></a>include</h3><hr>
<p>(静态包含)</p>
<p>包含其他组件，语法：<code>&lt;%@include file=&quot;&quot;%&gt;</code>，file 指定要包含的目标组件，路径如果以”&#x2F;“(当前应用)就是绝对路径。</p>
<p>原理：把目标组件的内容加到源组件中，输出结果。</p>
<p>动态包含：&lt;jsp:include page&#x3D;””&#x2F;&gt; 路径如果以”&#x2F;“(当前应用)就是绝对路径</p>
<h3 id="taglib"><a href="#taglib" class="headerlink" title="taglib"></a>taglib</h3><hr>
<p>导入jar包：<code>taglibs-standard-impl-1.2.5.jar</code> <code>taglibs-standard-spec-1.2.5.jar</code></p>
<p>通过JSP的 taglib指令,引入标签库.</p>
<table>
<thead>
<tr>
<th>标签库</th>
<th>URI</th>
<th>前缀</th>
<th>使用方式</th>
</tr>
</thead>
<tbody><tr>
<td>核心标签库</td>
<td><a href="http://java.sun.com/jsp/jstl/core" target="_blank" rel="noopener">http://java.sun.com/jsp/jstl/core</a></td>
<td>c</td>
<td><code>&lt;c:tagname…&gt;</code></td>
</tr>
<tr>
<td>国际化标签(I18N)</td>
<td><a href="http://java.sun.com/jsp/jstl/fmt" target="_blank" rel="noopener">http://java.sun.com/jsp/jstl/fmt</a></td>
<td>fmt</td>
<td><code>&lt;fmt:tagname…&gt;</code></td>
</tr>
<tr>
<td>SQL标签库</td>
<td><a href="http://java.sun.com/jsp/jstl/sql" target="_blank" rel="noopener">http://java.sun.com/jsp/jstl/sql</a></td>
<td>sql</td>
<td><code>&lt;sql:tagname…&gt;</code></td>
</tr>
<tr>
<td>XML标签库</td>
<td><a href="http://java.sun.com/jsp/jstl/xml" target="_blank" rel="noopener">http://java.sun.com/jsp/jstl/xml</a></td>
<td>x</td>
<td><code>&lt;x:tagname…&gt;</code></td>
</tr>
</tbody></table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> <span class="attr">prefix</span>=<span class="string">"c"</span>%&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">"http://java.sun.com/jsp/jstl/fmt"</span> <span class="attr">prefix</span>=<span class="string">"fmt"</span>%&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15631731461038-servlet.jpg"></p>
<p>用法: <code>${status.index}</code></p>
<h1 id="创建JavaWeb项目结构"><a href="#创建JavaWeb项目结构" class="headerlink" title="创建JavaWeb项目结构"></a>创建JavaWeb项目结构</h1><hr>
<p>java web 严格来说分为两类工程结构：一个是工程编译目录结构，一个是工程发布目录结构。工程发布目录结构结构，为servlet容器加载web应用的统一标准目录，而工程编译目录结构是为了方便工程编写、修改的临时结构，需要通过工程构建工具(ant,maven,gradle等)编译生成最终的运行时发布结构。因此，工程编译目录结构并不统一，与所使用的编译工具有关(也和配置有关)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">├── pom.xml <span class="comment">// maven的配置文件</span></span><br><span class="line">└── src</span><br><span class="line">    ├── main</span><br><span class="line">    │   ├── java <span class="comment">// java代码的目录</span></span><br><span class="line">    │   │   └── mygroup</span><br><span class="line">    │   │       ├── controller</span><br><span class="line">    │   │       │   ├── HomeController.java</span><br><span class="line">    │   │       │   └── PersonController.java</span><br><span class="line">    │   │       ├── dao</span><br><span class="line">    │   │       │   └── PersonDao.java</span><br><span class="line">    │   │       └── model</span><br><span class="line">    │   │           └── Person.java</span><br><span class="line">    │   ├── resources <span class="comment">// 静态资源目录</span></span><br><span class="line">    │   │   ├── db.properties</span><br><span class="line">    │   │   ├── log4j.xml</span><br><span class="line">    │   │   └── META-INF</span><br><span class="line">    │   │       └── persistence.xml</span><br><span class="line">    │   └── webapp <span class="comment">// web应用部署根目录</span></span><br><span class="line">    │       ├── index.html <span class="comment">// 因为是静态html文件，不用放到WEB-INF目录下</span></span><br><span class="line">    │       ├── META-INF</span><br><span class="line">    │       │   ├── context.xml</span><br><span class="line">    │       │   └── MANIFEST.MF</span><br><span class="line">    │       ├── resources <span class="comment">// css，js等静态资源是不能放到WEB-INF目</span></span><br><span class="line">                          <span class="comment">// 录下的，因为WEB-INF下的资源，客户端无法直接访问</span></span><br><span class="line">    │       │   └── css</span><br><span class="line">    │       │       └── screen.css</span><br><span class="line">    │       └── WEB-INF <span class="comment">// jsp都会放到这里，以保证用户无法直接访问jsp，而是通过</span></span><br><span class="line">                        <span class="comment">// controller。这个目录下的所有内容客户端都无法直接访问，</span></span><br><span class="line">                        <span class="comment">// 所以不要放静态文件</span></span><br><span class="line">    │           ├── spring</span><br><span class="line">    │           │   ├── app</span><br><span class="line">    │           │   │   ├── controllers.xml</span><br><span class="line">    │           │   │   └── servlet-context.xml</span><br><span class="line">    │           │   ├── db.xml</span><br><span class="line">    │           │   └── root-context.xml</span><br><span class="line">    │           ├── views</span><br><span class="line">    │           │   ├── edit.jsp</span><br><span class="line">    │           │   ├── home.jsp</span><br><span class="line">    │           │   └── list.jsp</span><br><span class="line">    │           └── web.xml</span><br><span class="line">    └── test</span><br><span class="line">        ├── java</span><br><span class="line">        │   └── mygroup</span><br><span class="line">        │       ├── controller</span><br><span class="line">        │       │   ├── DataInitializer.java</span><br><span class="line">        │       │   ├── HomeControllerTest.java</span><br><span class="line">        │       │   └── PersonControllerTest.java</span><br><span class="line">        │       └── dao</span><br><span class="line">        │           └── PersonDaoTest.java</span><br><span class="line">        └── resources</span><br><span class="line">##             ├── db.properties</span><br><span class="line">            ├── log4j.xml</span><br><span class="line">            ├── test-context.xml</span><br><span class="line">            └── test-db.xml</span><br></pre></td></tr></table></figure>

<p><strong>创建 folder 时，可以用<code>/</code>来一次性创建多级文件夹结构</strong></p>
<p>使用 [Maven]管理框架</p>
<h1 id="跳转和信息共享"><a href="#跳转和信息共享" class="headerlink" title="跳转和信息共享"></a>跳转和信息共享</h1><hr>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15629009218887-servlet.jpg"></p>
<p>在一个 servlet 中完成任务会去执行另一个 servlet</p>
<h2 id="Web组件之间的跳转方式"><a href="#Web组件之间的跳转方式" class="headerlink" title="Web组件之间的跳转方式"></a>Web组件之间的跳转方式</h2><hr>
<ol>
<li>请求转发(forward)</li>
<li>URL重定向(redirect)</li>
<li>请求包含(include) 不用</li>
</ol>
<h3 id="请求转发-forward"><a href="#请求转发-forward" class="headerlink" title="请求转发 forward"></a>请求转发 forward</h3><hr>
<p>请求转发:<br>   从 Servlet1 , 请求转发到Servlet2.<br>   Servlet1 完成一部分的功能,再跳转到 Servlet2 ,继续完成剩下的功能.</p>
<ul>
<li>语法:<ul>
<li><code>request对象.getRequestDispatcher(String path).forward(request,response)</code>;</li>
<li>参数:path,表示跳转的目标的路径(资源的名称).</li>
<li>注意:别忘了forward.</li>
<li>不支持跨域名访问，可以访问 WEB-INF 中的资源<ul>
<li><code>req.getRequestDispatcher(&quot;/WEB-INF/hello.jsp&quot;).forward(req, resp)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/forward/a"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		resp.setContentType(<span class="string">"text/html; charset=utf-=8"</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = resp.getWriter();</span><br><span class="line">		</span><br><span class="line">		String username = req.getParameter(<span class="string">"username"</span>);</span><br><span class="line">		System.out.println(<span class="string">"A username:"</span> + username);</span><br><span class="line">		System.out.println(<span class="string">"A end"</span>);</span><br><span class="line">		</span><br><span class="line">		out.print(<span class="string">"a end..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/forward/b"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		req.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = resp.getWriter();</span><br><span class="line">		String username = req.getParameter(<span class="string">"username"</span>);</span><br><span class="line">		System.out.println(<span class="string">"B username:"</span> + username);</span><br><span class="line">		out.print(<span class="string">"B username:"</span> + username);</span><br><span class="line">		</span><br><span class="line">		req.getRequestDispatcher(<span class="string">"/a"</span>).forward(req, resp);</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 先运行 AServlet 然后再往下运行</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"B end..."</span>);</span><br><span class="line">		out.print(<span class="string">"B end..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">B username:默认的</span><br><span class="line">A username:默认的</span><br><span class="line">A end</span><br><span class="line">B end...</span><br></pre></td></tr></table></figure>

<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15629136248094-servlet.jpg"></p>
<p>页面 -&gt; 最后停留在 a.end，</p>
<p>请求转发的特点:</p>
<ol>
<li>浏览器地址栏不发生改变,依然是 &#x2F;forward&#x2F;s1,不是目标地址(&#x2F;forward&#x2F;s2).</li>
<li>请求转发只发送一个请求.</li>
<li>共享同一个请求中的数据.</li>
<li>最终响应给浏览器的由Servlet2来决定.</li>
<li><strong>请求转发不能跨域访问,只能跳转到当前应用中的资源.</strong></li>
<li>请求转发可以访问 WEB-INF 目录中的资源.</li>
</ol>
<h3 id="URL-重定向"><a href="#URL-重定向" class="headerlink" title="URL 重定向"></a>URL 重定向</h3><hr>
<p>语法：</p>
<pre><code>- `response对象.sendRedirect(String path);`
- path指的是这个资源路径(资源名称)
</code></pre>
<p>特点：</p>
<ol>
<li>浏览器地址发生改变，从 &#x2F;redirect&#x2F;a，跳转到(&#x2F;redirect&#x2F;b)</li>
<li>发送两个请求(相当于把资源拷贝到浏览器上，在浏览器再起去发送请求)</li>
<li>没有共享请求数据(因为是两个请求，所以不能共享数据)</li>
<li>最终响应给浏览器的由 BServlet 决定</li>
<li><strong>URL 重定向支持跨域访问，可以跳转到其他网站</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@WebServlet</span>(<span class="string">"/redirect/b"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">		</span><br><span class="line">		req.setCharacterEncoding(<span class="string">"utf-8"</span>);</span><br><span class="line">		resp.setContentType(<span class="string">"text.html; charset=utf-8"</span>);</span><br><span class="line">		</span><br><span class="line">		PrintWriter out = resp.getWriter();</span><br><span class="line">		String username = req.getParameter(<span class="string">"username"</span>);</span><br><span class="line">		System.out.println(<span class="string">"B username:"</span> + username);</span><br><span class="line">		out.print(<span class="string">"B username:"</span> + username);</span><br><span class="line">		resp.sendRedirect(<span class="string">"a"</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"B end..."</span>);</span><br><span class="line">		out.print(<span class="string">"B end..."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>运行结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">B username:默认的</span><br><span class="line">B end...</span><br><span class="line">A username:<span class="keyword">null</span></span><br><span class="line">A end</span><br></pre></td></tr></table></figure>

<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15629145502483-servlet.jpg"></p>
<h3 id="有无-x2F-的区别"><a href="#有无-x2F-的区别" class="headerlink" title="有无&#x2F;的区别"></a>有无&#x2F;的区别</h3><hr>
<p>同域资源访问：</p>
<ol>
<li>带了<code>/</code>表示从当前上下文路径下去查找资源</li>
<li>没有带 <code>/</code> 表示从当前资源所在目录下去查找资源</li>
</ol>
<p>跨域访问 redirect</p>
<ol>
<li>带 <code>/</code> 直接在外部地址上找 <code>/+资源名称</code></li>
<li>不带 <code>/</code> 直接将资源地址放入地址栏执行</li>
</ol>
<blockquote>
<p>建议：同域建议直接加 <code>/</code> 直接在 webapp 下去查找，比较清晰，跨域直接写地址</p>
</blockquote>
<h2 id="Servlet-的三大作用域对象"><a href="#Servlet-的三大作用域对象" class="headerlink" title="Servlet 的三大作用域对象"></a>Servlet 的三大作用域对象</h2><hr>
<h2 id="作用-用来共享数据"><a href="#作用-用来共享数据" class="headerlink" title="作用:用来共享数据"></a>作用:用来共享数据</h2><table>
<thead>
<tr>
<th>作用域</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>request</td>
<td>HttpServletRequest</td>
<td>作用：在一个请求中的多个跳转间共享数据</td>
</tr>
<tr>
<td>session</td>
<td>HttpSession</td>
<td>会话，打开浏览器-&gt;访问网站(会话开始)，一次与服务器的连接</td>
</tr>
<tr>
<td>application</td>
<td>ServletContext</td>
<td>应用对象，一个应用只有一个ServletContext对象，作用：多个会话中可以共享一个 application，只要服务器不关闭，Web 应用不 reload ，就不会被销毁</td>
</tr>
</tbody></table>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15629177845679-servlet.jpg"></p>
<h2 id="如何取值："><a href="#如何取值：" class="headerlink" title="如何取值："></a>如何取值：</h2><ul>
<li>request: 直接在 service 方法中使用</li>
<li>session: 使用请求对象去获取 request.getSession();</li>
<li>application&#x2F;servletContext:<ol>
<li>通过父类获取<ul>
<li>super.getServletContext() &#x2F; super.getServletConfig().getServletContext()</li>
</ul>
</li>
<li>通过请求对象去获取<ul>
<li>request.getServletContext()</li>
</ul>
</li>
<li>通过 session 对象去获取<ul>
<li>request.getSession().getServletContext();</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="数据如何共享"><a href="#数据如何共享" class="headerlink" title="数据如何共享:"></a>数据如何共享:</h2><ol>
<li>如何在作用域对象中去设置&#x2F;存入要共享的数据<ul>
<li><strong>作用域对象.setAttribute(String name, Object value)</strong></li>
<li>参数：name:要共享的数据起一个唯一的标志。 value:要共享的数据</li>
</ul>
</li>
<li>如何作用域对象中去获取共享的数据<ul>
<li>Object value &#x3D; 作用域对象.getAttribute(String name);</li>
<li>参数：name:要获取共享数据的唯一标志</li>
</ul>
</li>
<li>如何删除作用域对象中的数据<ul>
<li>作用域对象.removeAttribute(String name);</li>
</ul>
</li>
</ol>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15629201118238-servlet.jpg"></p>
<h2 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h2><p>表示应用对象：一个应用只有一个 ServletContext 对象</p>
<p>常用方法：</p>
<ul>
<li><p><code>getRealpath(String path)</code> 获取相对 web 根路径的路径的绝对路径</p>
</li>
<li><p><code>getContextpath()</code> 获取上下文路径</p>
</li>
<li><p><code>getRealpath(String path)</code> 获取相对 web 根路径的路径的绝对路径</p>
</li>
</ul>
<p>ServletContext.getRealPath() 是从当前servlet 在tomcat 中的存放文件夹开始计算起的</p>
<p>比如，有个servlet 叫 UploadServlet，它部署在tomcat 下面以后的绝对路径如下：</p>
<p>“C:\Program Files\apache-tomcat-8.0.3\webapps\UploadServlet”</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ServletContext.getRealPath(<span class="string">"/"</span>) </span><br><span class="line"><span class="comment">// 返回 "C:\Program Files\apache-tomcat-8.0.3\webapps\UploadServlet"</span></span><br><span class="line"></span><br><span class="line">ServletContext.getRealPath(<span class="string">"/attachment"</span>) </span><br><span class="line"><span class="comment">// 返回 "C:\Program Files\apache-tomcat-8.0.3\webapps\UploadServlet\attachment"</span></span><br><span class="line"></span><br><span class="line">ServletContext.getRealPath(<span class="string">"attachment"</span>) </span><br><span class="line"><span class="comment">// 会导致NullPointerException</span></span><br></pre></td></tr></table></figure>
<p>结论就是：</p>
<p><strong>在使用ServletContext.getRealPath() 时，传入的参数是从 当前servlet 部署在tomcat中的文件夹算起的相对路径，要以”&#x2F;“ 开头，否则会找不到路径，导致NullPointerException</strong></p>
<ul>
<li><code>getContextpath()</code> 获取上下文路径</li>
</ul>
<p>全局的初始化参数配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">version</span>=<span class="string">"3.1"</span> <span class="attr">metadata-complete</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">      <span class="comment">&lt;!-- 配置全局的初始化参数 --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>username<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>lizhao<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>password<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ServletContext context = <span class="keyword">super</span>.getServletContext();</span><br><span class="line">System.out.println(context.getContextPath());</span><br><span class="line"><span class="comment">// 返回 service.xml 中 Context 标签的 path 属性</span></span><br><span class="line">System.out.println(context.getInitParameter(<span class="string">"username"</span>)); <span class="comment">// 输出 lizhao</span></span><br><span class="line">System.out.println(context.getInitParameter(<span class="string">"password"</span>)); <span class="comment">// 输出 123456</span></span><br></pre></td></tr></table></figure>

<h1 id="分页实现和设计"><a href="#分页实现和设计" class="headerlink" title="分页实现和设计"></a>分页实现和设计</h1><hr>
<ol>
<li><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15631062300051-servlet.jpg"></li>
</ol>
<h1 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h1><hr>
<p>作用：</p>
<ol>
<li>以常规方式调用资源(Servlet&#x2F;jsp)</li>
<li>利用修改过的请求信息调用资源</li>
<li>调用资源之后，在响应到客户端之前，对响应做出修改</li>
<li>组织当前资源调用，代之转到其他资源</li>
</ol>
<p>过滤在开发中的应用：</p>
<ol>
<li>可以做请求字符的编码处理</li>
<li>可以做登录验证过滤器</li>
<li>做敏感字(非法字符)过滤</li>
<li>做 MVC 框架的前端控制器(处理请求，进行分发)</li>
</ol>
<p>做自己擅长的事情，不要复制粘贴</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/server/servlet/15634212283189-servlet.jpg"></p>
<h2 id="开发流程"><a href="#开发流程" class="headerlink" title="开发流程"></a>开发流程</h2><hr>
<p>同 Servlet</p>
<ol>
<li>创建一个类去实现 javax.servlet.Filter 接口</li>
<li>实现接口中的3个方法<ul>
<li><code>destroy()</code></li>
<li><code>doFilter()</code></li>
<li><code>init(FilterConfig filterConfig)</code></li>
</ul>
</li>
<li>通知服务器管理我们自定义的 Filter 类(web.xml @WebFilter())</li>
</ol>
<h2 id="请求编码过滤"><a href="#请求编码过滤" class="headerlink" title="请求编码过滤"></a>请求编码过滤</h2><hr>
<h3 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">version</span>=<span class="string">"3.1"</span> <span class="attr">metadata-complete</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter.java<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>cn.lizhaoloveit.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">      	</span><br><span class="line">      	<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CheckLoginFilter.java<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>cn.lizhaoloveit.filter.CheckLoginFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CheckLoginFilter.java<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">      	<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/check/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">      </span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="CharacterEncodingFilter"><a href="#CharacterEncodingFilter" class="headerlink" title="CharacterEncodingFilter"></a>CharacterEncodingFilter</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">	<span class="comment">// 在过滤器中写死，存在硬编码问题，使用web.xml 来配置初始化参数，在过滤器中获取初始化参数</span></span><br><span class="line">	chain.doFilter(request, response);</span><br><span class="line">	<span class="keyword">if</span> (!<span class="string">""</span>.equals(encoding)) &#123;</span><br><span class="line">		request.setCharacterEncoding(encoding);</span><br><span class="line">	&#125; </span><br><span class="line">	chain.doFilter(request, response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="CheckLoginFilte"><a href="#CheckLoginFilte" class="headerlink" title="CheckLoginFilte"></a>CheckLoginFilte</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">	HttpServletRequest req = (HttpServletRequest) request;</span><br><span class="line">	HttpServletResponse resp = (HttpServletResponse) response;</span><br><span class="line">	</span><br><span class="line">	Object obj = req.getSession().getAttribute(<span class="string">"USER_IN_SESSION"</span>);</span><br><span class="line">	<span class="keyword">if</span> (obj == <span class="keyword">null</span>) &#123;</span><br><span class="line">		resp.sendRedirect(<span class="string">"/login.jsp"</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	chain.doFilter(request, response);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 以上代码不会加以甄别，过滤所有请求，如果要区别哪些资源需要登录，哪些不需要</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 在 Servlet 的 url-pattren 加上 /check/ 就行了，有了 /check/* 去过滤，就不需要判断是否是 login 了</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="dispatcher元素"><a href="#dispatcher元素" class="headerlink" title="dispatcher元素"></a>dispatcher元素</h2><p>2.4版本的servlet规范在部属描述符中新增加了一个 <code>&lt;dispatcher&gt; </code>元素，这个元素有四个可能的值：即REQUEST,FORWARD,INCLUDE和ERROR，可以在一个<code>&lt;filter-mapping&gt;</code>元素中加入任意数目的<code>&lt;dispatcher&gt;</code>，使得filter将会作用于直接从客户端过来的request（REQUEST），通过forward过来的request（FORWARD），通过include过来的request（INCLUDE）和通过<code>&lt;error-page&gt;</code>过来的request（ERROR）。如果没有指定任何<code>&lt; dispatcher &gt;</code>元素，默认值是REQUEST。<br>注意：<code>&lt;dispatcher&gt;&lt;/dispatcher&gt;</code>必须写在filter-mapping的最后。dispatcher的前提条件当然是要先满足url-pattern，然后dispatcher有四种可能的属性： </p>
<ol>
<li>REQUEST</li>
</ol>
<ul>
<li>只要发起的操作是一次HTTP请求，比如请求某个URL、发起了一个GET请求、表单提交方式为POST的POST请求、表单提交方式为GET的GET请求。一次重定向则前后相当于发起了两次请求，这些情况下有几次请求就会走几次指定过滤器。</li>
</ul>
<ol start="2">
<li>FOWARD</li>
</ol>
<ul>
<li>只有当当前页面是通过请求转发转发过来的情形时，才会走指定的过滤器</li>
</ul>
<ol start="3">
<li>INCLUDE</li>
</ol>
<ul>
<li>只要是通过&lt;jsp:include page&#x3D;”xxx.jsp” &#x2F;&gt;，嵌入进来的页面，每嵌入的一个页面，都会走一次指定的过滤器。</li>
</ul>
<ol start="4">
<li>ERROR</li>
</ol>
<ul>
<li>假如web.xml里面配置了<error-page></error-page>：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>400<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/filter/error.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>404<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/filter/error.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">error-page</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">error-code</span>&gt;</span>500<span class="tag">&lt;/<span class="name">error-code</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">location</span>&gt;</span>/filter/error.jsp<span class="tag">&lt;/<span class="name">location</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">error-page</span>&gt;</span></span><br></pre></td></tr></table></figure>

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ammar</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://lizhaoloveit.cn/2019/07/07/Servlet/">http://lizhaoloveit.cn/2019/07/07/Servlet/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lizhaoloveit.cn">Ammar's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Servlet/">Servlet    </a></div><div class="post_share"><div class="social-share" data-image="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2019/07/08/UML%E7%B1%BB%E5%9B%BE%E7%9A%846%E7%A7%8D%E8%BF%9E%E7%BA%BF%E7%A4%BA%E6%84%8F/"><img class="prev_cover lozad" data-src="https://www.lizhaoloveit.cn/blogimages/blog/cover/1.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/2.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/3.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/4.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/5.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/6.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/7.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/8.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/9.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/10.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/11.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/12.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/13.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/14.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/15.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/16.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/17.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/18.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/19.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/20.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/21.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/22.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/23.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/24.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/25.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/26.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/27.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/28.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/29.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/31.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/32.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/33.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/34.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/35.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/36.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/37.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/38.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/39.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/40.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/41.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/42.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/43.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/44.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/45.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/46.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/47.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/48.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/49.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/50.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/51.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/52.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/53.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/54.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/55.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/56.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/57.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/58.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/59.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/60.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/62.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/63.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/64.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/65.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/66.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/67.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/68.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/69.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/70.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/71.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/72.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/73.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/74.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/75.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/76.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/77.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/78.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/79.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>UML 类图的6种连线示意</span></div></a></div><div class="next-post pull-right"><a href="/2019/07/07/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8BSocket/"><img class="next_cover lozad" data-src="https://www.lizhaoloveit.cn/blogimages/blog/cover/1.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/2.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/3.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/4.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/5.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/6.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/7.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/8.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/9.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/10.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/11.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/12.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/13.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/14.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/15.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/16.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/17.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/18.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/19.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/20.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/21.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/22.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/23.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/24.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/25.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/26.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/27.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/28.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/29.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/31.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/32.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/33.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/34.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/35.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/36.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/37.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/38.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/39.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/40.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/41.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/42.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/43.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/44.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/45.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/46.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/47.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/48.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/49.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/50.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/51.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/52.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/53.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/54.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/55.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/56.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/57.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/58.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/59.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/60.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/62.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/63.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/64.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/65.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/66.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/67.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/68.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/69.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/70.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/71.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/72.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/73.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/74.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/75.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/76.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/77.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/78.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/79.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>网络编程Socket</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'http://lizhaoloveit.cn/2019/07/07/Servlet/';
  this.page.identifier = '2019/07/07/Servlet/';
  this.page.title = 'Servlet';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'lizhao' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2014 - 2024 By Ammar</div><div class="icp"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener"><span>浙ICP备19013619号-1</span></a></div><div class="bag"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010502006128" target="_blank" rel="noopener"><img src="/img/beian.png"><span>浙公网安备 33010502006128号</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="阅读模式"> </i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">繁</a><i class="far fa-moon nightshift" id="nightshift" title="夜间模式"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script async src="/js/search/algolia.js"></script><script src="/js/nightshift.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>