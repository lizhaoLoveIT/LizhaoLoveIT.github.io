<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>MyBatis | Ammar's Blog</title><meta name="description" content="MyBatis"><meta name="keywords" content="MyBatis"><meta name="author" content="Ammar"><meta name="copyright" content="Ammar"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.1/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://lizhaoloveit.cn/2019/07/06/MyBatis/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="MyBatis"><meta name="twitter:description" content="MyBatis"><meta name="twitter:image" content="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg"><meta property="og:type" content="article"><meta property="og:title" content="MyBatis"><meta property="og:url" content="http://lizhaoloveit.cn/2019/07/06/MyBatis/"><meta property="og:site_name" content="Ammar's Blog"><meta property="og:description" content="MyBatis"><meta property="og:image" content="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="网络编程Socket" href="http://lizhaoloveit.cn/2019/07/07/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8BSocket/"><link rel="next" title="JDBC" href="http://lizhaoloveit.cn/2019/07/04/JDBC/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?162506e75ffd64287398566b2f5738c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"VRMKRAV9AT","apiKey":"bd7157400046d0f02396708a501a3480","indexName":"lizhaoloveit","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://lizhaoloveit.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天'

  
}</script><meta name="generator" content="Hexo 4.2.1"><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ORM-Object-Relational-Mapping"><span class="toc-number">1.</span> <span class="toc-text">ORM(Object Relational Mapping)</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mybatis-概述"><span class="toc-number">2.</span> <span class="toc-text">mybatis 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#使用步骤"><span class="toc-number">2.1.</span> <span class="toc-text">使用步骤</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#准备工作"><span class="toc-number">3.</span> <span class="toc-text">准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#导入-mybatis"><span class="toc-number">3.1.</span> <span class="toc-text">导入 mybatis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建数据库表"><span class="toc-number">3.2.</span> <span class="toc-text">创建数据库表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建domain类"><span class="toc-number">3.3.</span> <span class="toc-text">创建domain类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-config-XML"><span class="toc-number">4.</span> <span class="toc-text">MyBatis-config.XML</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#约束头"><span class="toc-number">4.1.</span> <span class="toc-text">约束头</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MyBatis-config-XML-1"><span class="toc-number">4.2.</span> <span class="toc-text">MyBatis-config.XML</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mapper映射文件"><span class="toc-number">5.</span> <span class="toc-text">mapper映射文件</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#约束头-1"><span class="toc-number">5.1.</span> <span class="toc-text">约束头</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#标签属性-自动返回主键"><span class="toc-number">5.2.</span> <span class="toc-text">标签属性(自动返回主键)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#resultMap"><span class="toc-number">5.3.</span> <span class="toc-text">resultMap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-mapper-接口"><span class="toc-number">5.4.</span> <span class="toc-text">使用 mapper 接口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-Param-设置多个参数"><span class="toc-number">5.5.</span> <span class="toc-text">使用 @Param 设置多个参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在mapper-xml-中的使用场景"><span class="toc-number">5.6.</span> <span class="toc-text">${}在mapper.xml 中的使用场景</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#外键支持"><span class="toc-number">6.</span> <span class="toc-text">外键支持</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一对一"><span class="toc-number">6.1.</span> <span class="toc-text">一对一</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多对一-多个学生与一个老师"><span class="toc-number">6.2.</span> <span class="toc-text">多对一(多个学生与一个老师)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#多对一-add-添加数据"><span class="toc-number">6.2.1.</span> <span class="toc-text">多对一(add) 添加数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多对一-select"><span class="toc-number">6.2.2.</span> <span class="toc-text">多对一(select)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#N-1-sql-多对一查询"><span class="toc-number">6.2.3.</span> <span class="toc-text">N+1 sql (多对一查询)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多表联查"><span class="toc-number">6.2.4.</span> <span class="toc-text">多表联查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多对一删除"><span class="toc-number">6.2.5.</span> <span class="toc-text">多对一删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#一对多-一个老师教多个学生"><span class="toc-number">6.3.</span> <span class="toc-text">一对多(一个老师教多个学生)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一对多-add"><span class="toc-number">6.3.1.</span> <span class="toc-text">一对多(add)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一对多select-额外-sql"><span class="toc-number">6.3.2.</span> <span class="toc-text">一对多select(额外 sql)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一对多-关联查询"><span class="toc-number">6.3.3.</span> <span class="toc-text">一对多(关联查询)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一对多-delete"><span class="toc-number">6.3.4.</span> <span class="toc-text">一对多(delete)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多对多映射"><span class="toc-number">6.4.</span> <span class="toc-text">多对多映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#多对多-save"><span class="toc-number">6.4.1.</span> <span class="toc-text">多对多(save)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多对多-get-额外sql"><span class="toc-number">6.4.2.</span> <span class="toc-text">多对多(get 额外sql)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多对多-get-关联查询"><span class="toc-number">6.4.3.</span> <span class="toc-text">多对多(get 关联查询)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多对多-delete"><span class="toc-number">6.4.4.</span> <span class="toc-text">多对多(delete)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#延迟加载问题"><span class="toc-number">7.</span> <span class="toc-text">延迟加载问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#延迟加载原理"><span class="toc-number">7.1.</span> <span class="toc-text">延迟加载原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mybatis-缓存"><span class="toc-number">8.</span> <span class="toc-text">Mybatis 缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#一级缓存"><span class="toc-number">8.1.</span> <span class="toc-text">一级缓存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二级缓存"><span class="toc-number">8.2.</span> <span class="toc-text">二级缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#二级缓存的高效使用"><span class="toc-number">8.2.1.</span> <span class="toc-text">二级缓存的高效使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EhCashe-二级缓存"><span class="toc-number">8.3.</span> <span class="toc-text">EhCashe 二级缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#导包"><span class="toc-number">8.3.1.</span> <span class="toc-text">导包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置文件"><span class="toc-number">8.3.2.</span> <span class="toc-text">配置文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mybatis局限性"><span class="toc-number">8.4.</span> <span class="toc-text">mybatis局限性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#启动框架"><span class="toc-number">9.</span> <span class="toc-text">启动框架</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#插入"><span class="toc-number">9.1.</span> <span class="toc-text">插入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#修改"><span class="toc-number">9.2.</span> <span class="toc-text">修改</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#删除"><span class="toc-number">9.3.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#查询"><span class="toc-number">9.4.</span> <span class="toc-text">查询</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MyBatis-操作流程"><span class="toc-number">10.</span> <span class="toc-text">MyBatis 操作流程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OGNL-表达式"><span class="toc-number">11.</span> <span class="toc-text">OGNL 表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#如何取值"><span class="toc-number">11.1.</span> <span class="toc-text">如何取值</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#使用日志"><span class="toc-number">12.</span> <span class="toc-text">使用日志</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#动态-SQL"><span class="toc-number">13.</span> <span class="toc-text">动态 SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#xml-转义字符"><span class="toc-number">13.1.</span> <span class="toc-text">xml 转义字符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例"><span class="toc-number">13.2.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#if"><span class="toc-number">13.3.</span> <span class="toc-text">if</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#choose-when-otherwise"><span class="toc-number">13.4.</span> <span class="toc-text">choose, when, otherwise</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#trim-where-set"><span class="toc-number">13.5.</span> <span class="toc-text">trim, where, set</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#foreach"><span class="toc-number">13.6.</span> <span class="toc-text">foreach</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#批量插入和批量删除"><span class="toc-number">13.6.1.</span> <span class="toc-text">批量插入和批量删除</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bind"><span class="toc-number">13.7.</span> <span class="toc-text">bind</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Multi-db-vendor-support"><span class="toc-number">13.8.</span> <span class="toc-text">Multi-db vendor support</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://lizhaoloveit.cn/blogimages/blog/top_img.jpg)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">Ammar's Blog</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description">微信号：aicjaish</div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a><a class="site-page" href="/comment/"><i class="fa-fw fa fa-coffee"></i><span> 留言</span></a><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">MyBatis</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-07-06<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-08-30</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/">Java</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/%E6%A1%86%E6%9E%B6/">框架</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/%E6%A1%86%E6%9E%B6/MyBatis/">MyBatis</a></span><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">10.9k</span><span class="post-meta__separator">|</span><span>阅读时长: 46 分钟</span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="ORM-Object-Relational-Mapping"><a href="#ORM-Object-Relational-Mapping" class="headerlink" title="ORM(Object Relational Mapping)"></a>ORM(Object Relational Mapping)</h1><hr>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><p>ORM思想：为了解决面向对象与关系数据库存在的互不匹配的现象的技术。ORM是通过使用描述对象和数据库之间映射的元数据，将java程序中的对象自动持久化到关系数据库中。将关系数据库中表中的记录映射成对象，以对象的形式展现。把对数据库的操作转化为对对象的操作。因此 ORM 的目的是为了让开发人员以面向对象的思想来实现对数据库的操作。</p>
<p>目前流行的 ORM 框架：</p>
<ol>
<li>JPA : 一种 ORM 规范，需要各大 ORM 框架实现，JavaEE 的规范，Java persistence api : Java 持久化 API</li>
<li>Hibernate : 最流行的 ORM 框架，设计灵巧，性能优秀，文档丰富</li>
<li>MyBatis : 本是 apache 的一个开源项目 iBatis，提供的持久层框架包括SQL、Maps和DAO，允许开发人员直接编写SQL</li>
</ol>
<h1 id="mybatis-概述"><a href="#mybatis-概述" class="headerlink" title="mybatis 概述"></a>mybatis 概述</h1><hr>
<p>MyBatis 是一个 SQL 的映射框架，其前身是 iBatis，也就是淘宝试用的持久层框架，<code>org.apache.ibatis</code></p>
<blockquote>
<p>mybatis 主要功能</p>
</blockquote>
<p><strong>几乎消除了所有 JDBC 代码和参数的手工设置以及结果集都可以交给 MyBatis完成</strong></p>
<p>这些只需要简单的使用 XML 或者 注释配置即可</p>
<h2 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h2><hr>
<ol>
<li>使用配置文件(主配置文件&#x2F;总配置文件&#x2F;全局配置文件)，告知框架连接数据库四要素</li>
<li>使用配置文件(SQL映射文件)，告知框架执行哪些SQL</li>
<li>启动框架，让框架执行具体SQL任务</li>
</ol>
<p>框架从对应的配置文件中获取数据(DOM 解析)，其他的事情都已经做好了。</p>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><hr>
<h2 id="导入-mybatis"><a href="#导入-mybatis" class="headerlink" title="导入 mybatis"></a>导入 mybatis</h2><hr>
<p>导入 mybatis 核心包和 mysql 驱动包</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15623837273533-mybatis.jpg"></p>
<h2 id="创建数据库表"><a href="#创建数据库表" class="headerlink" title="创建数据库表"></a>创建数据库表</h2><hr>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15623838844336-mybatis.jpg"></p>
<h2 id="创建domain类"><a href="#创建domain类" class="headerlink" title="创建domain类"></a>创建domain类</h2><hr>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15623838943779-mybatis.jpg"></p>
<h1 id="MyBatis-config-XML"><a href="#MyBatis-config-XML" class="headerlink" title="MyBatis-config.XML"></a>MyBatis-config.XML</h1><hr>
<p>又叫 <strong>主配置文件&#x2F;总配置文件&#x2F;全局配置文件</strong></p>
<p>主要是告知框架 <strong>连接数据库四要素，事务处理，关联mapper文件，启动框架时，只会加载主配置文件</strong></p>
<blockquote>
<p>规范</p>
</blockquote>
<ol>
<li>起名：mybatis-config.xml</li>
<li>路径，放在classpath 下面，创建一个 source folder:resources</li>
<li>参考文档：mybatis 中文文档&#x2F;XML 映射文件</li>
</ol>
<h2 id="约束头"><a href="#约束头" class="headerlink" title="约束头"></a>约束头</h2><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">  PUBLIC <span class="string">"-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line">  <span class="string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>约束头的作用：有网络会用网络上的 dtd约束， 如果没有网络，需要配置离线的约束，离线约束加载如下，只需将 dtd 放在 resources 即可</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15623955030389-mybatis.jpg"></p>
<h2 id="MyBatis-config-XML-1"><a href="#MyBatis-config-XML-1" class="headerlink" title="MyBatis-config.XML"></a>MyBatis-config.XML</h2><hr>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE configuration</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 这句xml 的作用：将db.properties 属性装包：为了可以用#&#123;&#125;去取值 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"db.properties"</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 别名，主配置文件，配好，mapper 可以使用 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 别名，主配置文件，配好，mapper 可以使用 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- &lt;typeAlias type="cn.lizhaoloveit.mybatis.User" alias="User"/&gt; --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 给包取别名后，默认别名是简单名称 类型的别名，只能在 Type 中使用 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"cn.lizhaoloveit.mybatis"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置多个环境 default:默认使用什么环境(开发，测试，上线等) --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"dev"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- id:当前环境的唯一标记，不能重复告诉框架事务处理和四要素 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"dev"</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- 事务处理的类型，使用 JDBC 回滚，提交，表示要使用事务 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">			<span class="comment">&lt;!-- type:连接池的类型，POOLED 表示可以使用连接池 --&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;driverClassName&#125;"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;url&#125;"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;username&#125;"</span>/&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;password&#125;"</span>/&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 启动框架的时候，只会加载主配置文件，不会加载映射文件，</span></span><br><span class="line"><span class="comment">	使用 mappers 标签，告诉框架上哪找 SQL 映射文件 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- resource 映射文件的路径，以斜杠分割，从classpath 开始找 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"cn/lizhaoloveit/mybatis/UserMapper.xml"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>MyBatis 的 XML 配置文件的高级结构如下：</p>
<ul>
<li>configuration 配置<ul>
<li>properties 属性</li>
<li>setting 设置</li>
<li>typeAliases 类型命名</li>
<li>typeHandlers 类型处理器</li>
<li>objectFactory 对象工厂</li>
<li>plugins 插件</li>
<li>environments 环境<ul>
<li>environment 环境变量<ul>
<li>transactionManager 事务管理器</li>
<li>dataSource 数据源</li>
</ul>
</li>
</ul>
</li>
<li>databaseIdProvider chinese?</li>
<li>mappers 映射器</li>
</ul>
</li>
</ul>
<h1 id="mapper映射文件"><a href="#mapper映射文件" class="headerlink" title="mapper映射文件"></a>mapper映射文件</h1><hr>
<p>主要告知框架可以执行哪些数据库操作(<strong>写增删改查的SQL语句</strong>)</p>
<blockquote>
<p>规范</p>
</blockquote>
<ol>
<li>起名：xxxMapper.xml -&gt; xxx 表示 domain, userMapper.xml</li>
<li>路径：映射文件跟 mapper(用来做增删改查) 接口 位置一致。</li>
</ol>
<h2 id="约束头-1"><a href="#约束头-1" class="headerlink" title="约束头"></a>约束头</h2><hr>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE mapper</span></span><br><span class="line"><span class="meta">  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"</span></span><br><span class="line"><span class="meta">  "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="标签属性-自动返回主键"><a href="#标签属性-自动返回主键" class="headerlink" title="标签属性(自动返回主键)"></a>标签属性(自动返回主键)</h2><hr>
<p>SQL 映射文件有很少的几个顶级元素(按照它们应该被定义的顺序)：</p>
<ul>
<li>cache 配置给定命名空间的缓存</li>
<li>cache-ref 从其他命名空间引用缓存配置</li>
<li>resultMap 最复杂，用来描述如何从数据库结果集中加载你的对象</li>
<li>sql 可以重用的 SQL 块，</li>
<li>insert 映射插入语句</li>
<li>update 映射更新语句</li>
<li>delete 映射删除语句</li>
<li>select 映射查询语句</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- namespace: 命名空间，给当前 mapper 文件取一个名字，</span></span><br><span class="line"><span class="comment">找到指定的 SQL 语句： namespace 值 + . + id值</span></span><br><span class="line"><span class="comment">namespace 的值需要规范，使用 mapper 接口的全限定名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.wolfcode.UserMapper"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- SQL语句写在标签中间</span></span><br><span class="line"><span class="comment">    id:当前 SQL 语句的唯一标记，id 值跟接口中的方法名一致</span></span><br><span class="line"><span class="comment">    注意：mapper 文件中，不认识占位符，使用语法 #(属性名)，从对象中</span></span><br><span class="line"><span class="comment">    取什么属性的值放在占位符上，替代占位符 ? useGenerateKeys 表示是否</span></span><br><span class="line"><span class="comment">    要获取自动生成主键，keyProperty 表示把主键赋值到哪个属性上 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">        inset into user(name, salary, hiredate) values(#&#123;name&#125;, #&#123;salary&#125;, #&#123;hiredate&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"update"</span>&gt;</span></span><br><span class="line">		update user set name=#&#123;name&#125;, salary=#&#123;salary&#125;, hiredate=#&#123;hiredate&#125; where id=#&#123;id&#125;;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete"</span>&gt;</span></span><br><span class="line">		delete from user where id=#&#123;id&#125;;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"get"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">		select * from user where id=#&#123;id&#125;;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"gets"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></span><br><span class="line">		select * from user;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>建议：写 SQL 的时候，先写带有占位符 ？ 的那种写法，再使用 #{} 去替换。</p>
</blockquote>
<h2 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h2><hr>
<p>如果列名和属性名匹配，可以直接使用 resultType，否则就要使用 resultMap了</p>
<p>只要是查询：就一定要有结果类型， 要么是 resultType, 要么是 resultMap</p>
<p>封装映射，将字段名和属性名一一对应。</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15624282283518-mybatis.jpg"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- resultType 属性：如果列名和属性名匹配，可以使用 </span></span><br><span class="line"><span class="comment">     如果不匹配，用 resultMap</span></span><br><span class="line"><span class="comment">     resultMap: 要去匹配哪一个 resultMap 标签</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"listAll"</span> <span class="attr">resultMap</span>=<span class="string">"basemap"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- type: 跟 java 中的类型做映射</span></span><br><span class="line"><span class="comment">     id: 当前 resultMap 标签的唯一映射</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"cn.lizhaoloveit.User"</span> <span class="attr">id</span>=<span class="string">"basemap"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- id 用来处理主键 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>/ <span class="attr">cloumn</span>=<span class="string">"uid"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"uname"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"usalary"</span> <span class="attr">property</span>=<span class="string">"salary"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"uhiredate"</span> <span class="attr">property</span>=<span class="string">"hiredate"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>只要是查询，一定有结果类型。</p>
</blockquote>
<h2 id="使用-mapper-接口"><a href="#使用-mapper-接口" class="headerlink" title="使用 mapper 接口"></a>使用 mapper 接口</h2><hr>
<ol>
<li>创建一个 Mapper 接口，这个接口的要求：<ol>
<li>这个接口的全限定名&#x3D;&#x3D;&#x3D;对应的 Mapper 文件的 namespace</li>
<li>这个接口中的方法和 Mapper 文件的 SQL 元素一一对应：方法名字&#x3D;SQL元素id，方法的参数类型&#x3D;SQL元素中定义的 parameterType 类型，方法的返回类型&#x3D;SQL元素中定义的resultType&#x2F;resultMap 类型’</li>
</ol>
</li>
<li>创建 sqlSession</li>
<li>通过 sqlSession.getMapper(xxxMapper.class) 方法得到一个 Mapper 对象</li>
<li>调用 Mapper 对象上的方法文成对象的查询</li>
</ol>
<h2 id="使用-Param-设置多个参数"><a href="#使用-Param-设置多个参数" class="headerlink" title="使用 @Param 设置多个参数"></a>使用 @Param 设置多个参数</h2><hr>
<p>如果要在 Mapper 接口上的一个方法中，添加多个参数，就一定要在每个参数前使用 @Param 标签</p>
<p>User login(@Param(“name”)String name, @Param(“password”)String password);</p>
<p><strong>原理：Mybatis 在处理这些Mapper方法的时候，会自动的把这些参数包装成一个 Map 对象，@Param中的 value 就会作为这个 Map 的 key，对应的参数值，就会作为这个 Key 的value</strong></p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15624282283519-mybatis.png"></p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15637019018473-mybatis.png"></p>
<h2 id="在mapper-xml-中的使用场景"><a href="#在mapper-xml-中的使用场景" class="headerlink" title="${}在mapper.xml 中的使用场景"></a>${}在mapper.xml 中的使用场景</h2><blockquote>
<p>mapper.xml  select 中若需要作为 order by group by 取值，要用${} ， <code>(#{}会给列名 + &#39;&#39;)</code> 会导致排序无效。</p>
</blockquote>
<h1 id="外键支持"><a href="#外键支持" class="headerlink" title="外键支持"></a>外键支持</h1><hr>
<p>我们不能在数据库添加外键，这样会非常影响数据库读写数据的性能。所以使用代码去实现表与表之间的关联是必须的。</p>
<h2 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h2><hr>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"mybatis.Orders"</span> <span class="attr">id</span>=<span class="string">"OrdersUserResultMap"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置映射订单信息 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">property</span>=<span class="string">"userId"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"number"</span> <span class="attr">property</span>=<span class="string">"number"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"createtime"</span> <span class="attr">property</span>=<span class="string">"createtime"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"note"</span> <span class="attr">property</span>=<span class="string">"note"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射的关联的用户信息 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- association用于映射关联查询单个对象的信息</span></span><br><span class="line"><span class="comment">		property：要将关联查询的用户信息映射到Orders中的哪个属性</span></span><br><span class="line"><span class="comment">		javaType：该属性的类型</span></span><br><span class="line"><span class="comment">      select: 转换对象的 sql，即如何将 user_id转换成 User 对象</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"mybatis.po.User"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sex"</span> <span class="attr">property</span>=<span class="string">"sex"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"address"</span> <span class="attr">property</span>=<span class="string">"address"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>上述配置，相当于一个 Order 类中保存这一个 User 类，使用 <association> 标签来</p>
<h2 id="多对一-多个学生与一个老师"><a href="#多对一-多个学生与一个老师" class="headerlink" title="多对一(多个学生与一个老师)"></a>多对一(多个学生与一个老师)</h2><hr>
<p>由 Student类来维护 Student与 Teacher的关系。</p>
<p>项目结构如下：</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398455-mybatis.png" alt="2019-07-24 at 8.50 P"></p>
<p>表结构：<br><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398453-mybatis.png"></p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398454-mybatis.png" alt="2019-07-24 at 8.47 P"></p>
<p>domain 类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="keyword">private</span> Teacher teacher;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多对一-add-添加数据"><a href="#多对一-add-添加数据" class="headerlink" title="多对一(add) 添加数据"></a>多对一(add) 添加数据</h3><hr>
<p>写代码时，我一般的习惯是先从测试入手，先想好程序外面会如何使用功能，再着手实现。思考过程如下：<br>Student 类中包含 Teacher，所以想要得到 Student 必须先有 Teacher。Test 中代码就很容易写了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Student 类中包含 Teacher ，所以想要得到 Student 必须先有 Teacher</span></span><br><span class="line">	Teacher tea = <span class="keyword">new</span> Teacher(<span class="keyword">null</span>, <span class="string">"小A"</span>, <span class="string">"女"</span>);</span><br><span class="line">	teaDao.save(tea);</span><br><span class="line">	</span><br><span class="line">	Student stu1 = <span class="keyword">new</span> Student(<span class="keyword">null</span>, <span class="string">"A"</span>, <span class="string">"123456"</span>, tea);</span><br><span class="line">	Student stu2 = <span class="keyword">new</span> Student(<span class="keyword">null</span>, <span class="string">"B"</span>, <span class="string">"123456"</span>, tea);</span><br><span class="line">	</span><br><span class="line">	stuDao.save(stu1);</span><br><span class="line">	stuDao.save(stu2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TeacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">		insert into teacher_all2one (name, sex) values(#&#123;name&#125;, #&#123;sex&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">		insert into student_all2one (name, password, tea_id) values(#&#123;name&#125;, #&#123;password&#125;, #&#123;teacher.id&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在保存的时候，先保存 teacher 然后根据 tea 的 id 属性，保存stu1，stu2。</p>
<h3 id="多对一-select"><a href="#多对一-select" class="headerlink" title="多对一(select)"></a>多对一(select)</h3><hr>
<p>还是老办法，先写 test</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Student student = stuDao.get(<span class="number">1l</span>);</span><br><span class="line">	System.out.println(student);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>思考：从上面的测试方法中，我们需要得到一个 student 对象，且属性 teacher 要能够被赋值。</p>
<p>解决方法，使用 resultMap 映射，将 teacher 属性映射成一行数据，该行数据正好是 teacher 表中的一行，即查询 teacher 表中的一行数据赋值给 Student 类中的 teacher 属性。</p>
<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"studentMap"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 关联关系映射，(某一列，映射成对象)，</span></span><br><span class="line"><span class="comment">        association: 关联关系映射，映射成对象，</span></span><br><span class="line"><span class="comment">        property: 要映射的对象属性:Student 的 teacher属性</span></span><br><span class="line"><span class="comment">        column: 要映射表的列名: Student 表的 tea_id 列</span></span><br><span class="line"><span class="comment">        select: 转换对象的 sql，即如何将 tea_id 转换成 teacher 对象</span></span><br><span class="line"><span class="comment">        sql: selec * from teacher where id=#&#123;id&#125; 执行sql 返回对象，并赋值给 Student</span></span><br><span class="line"><span class="comment">        的 teacher 属性</span></span><br><span class="line"><span class="comment">        通过 column 对应列的值，执行 sql 查询出 teacher 对象</span></span><br><span class="line"><span class="comment">        列-------类-------对象--------赋值</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"teacher"</span> <span class="attr">javaType</span>=<span class="string">"Teacher"</span> <span class="attr">column</span>=<span class="string">"tea_id"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">select</span>=<span class="string">"cn.lizhaoloveit.mybatis.mapper.TeacherMapper.getById"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getById"</span> <span class="attr">resultMap</span>=<span class="string">"studentMap"</span>&gt;</span></span><br><span class="line">	select * from student_all2one where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TeacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getById"</span> <span class="attr">resultType</span>=<span class="string">"Teacher"</span>&gt;</span></span><br><span class="line">	select * from teacher_all2one where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"全限定名"</span> <span class="attr">id</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 普通映射字段 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 关联关系映射，(某一列，映射成对象)，</span></span><br><span class="line"><span class="comment">        association: 关联关系映射，映射成对象，</span></span><br><span class="line"><span class="comment">        property: 要映射的对象属性:Employee 的 dept属性</span></span><br><span class="line"><span class="comment">        column: 要映射表的列名: employee 表的 dept_id 列</span></span><br><span class="line"><span class="comment">        select: 转换对象的 sql，即如何将 dept_id转换成 Department 对象</span></span><br><span class="line"><span class="comment">        sql: selec id, name from department where id=#&#123;id&#125;</span></span><br><span class="line"><span class="comment">        通过 column 对应列的值，执行 sql 查询出 department 对象</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        列-------类</span></span><br><span class="line"><span class="comment">        select 类中的变量信息，from department where id=#&#123;已知信息&#125;</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">select</span>=<span class="string">"全限定名.get"</span> <span class="attr">property</span>=<span class="string">"dept"</span> <span class="attr">column</span>=<span class="string">"dept_id"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用了继承，是因为订单信息和关联的用户信息和前面一对一是完全一样的，不需要再写一遍，resultMap 支持继承，直接继承那个 resultMap 即可，然后加上订单明细这部分。</p>
<h3 id="N-1-sql-多对一查询"><a href="#N-1-sql-多对一查询" class="headerlink" title="N+1 sql (多对一查询)"></a>N+1 sql (多对一查询)</h3><hr>
<p>问题：多对一 n+1 问题是指以下情况，假设系统中存在两张表，学生表(多)，和老师表(1)，<br>学生表字段：sid,sname,tid。老师表字段为 tid tname  ， 两张表通过 tid关联。</p>
<p>现在假设一个页面需要浏览学生记录，同时要显示这个学生对应的老师名称，有两种查询方法。</p>
<ol>
<li>n+1 句 sql，先查询 select * from 学生表。再根据结果记录查询 select * from 老师表 where tid &#x3D; ?</li>
<li>建立一条联合查询语句 select * from 学生表 a inner join 老师表 b on a.tid&#x3D;b.tid</li>
</ol>
<p>在没有分页的情况下，第二种方法的效率比第一种方法高，然而在有分页的情况下，反而是 n+1 句 sql 的执行效率高。</p>
<p>没分页的情况下，复杂度 10000 + 10000 * 1000  第二个是 10000 * 1000</p>
<p>假设两张表没有索引，学生表有10000条记录，老师表为1000条记录，每个页面显示 100 条记录，第一种方法数据库的执行的时间复杂度是 10000 + 100 * 1000。</p>
<p>第二种方法是 10000 * 1000.<br>双方差100倍<br>所以系统存在分页，采取 n+1 句sql 语句进行查询的效率更高。而且第一种方法也是一种扩展性比较良好的方法，假设老师表的数据过多，我们需要把老师表进行水平切割成100个表，那么第一种方法的扩展性是比较好的。</p>
<p>总结：分页查询和查询单个对象时，一般使用 N + 1，在全部列表查询，一般使用多表查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Teacher teacher</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"studentMap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 普通映射字段 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">select</span>=<span class="string">"Teacher.get"</span> <span class="attr">property</span>=<span class="string">"teacher"</span> <span class="attr">column</span>=<span class="string">"t_id"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>两个 maper，一个是 select * from student, 一个是 select * from teacher where id &#x3D; tid</p>
<h3 id="多表联查"><a href="#多表联查" class="headerlink" title="多表联查"></a>多表联查</h3><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Employee employee)</span> </span>&#123;</span><br><span class="line">        <span class="function">Employee <span class="title">get</span><span class="params">(Long id)</span></span>;</span><br><span class="line">        <span class="function">List&lt;Employee&gt; <span class="title">list</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Employee"</span> <span class="attr">id</span>=<span class="string">"employeeMap"</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- 配置映射订单信息 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">&lt;!-- 配置映射的关联的用户信息 --&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- association用于映射关联查询单个对象的信息</span></span><br><span class="line"><span class="comment">		property：要将关联查询的用户信息映射到Orders中的哪个属性</span></span><br><span class="line"><span class="comment">		javaType：该属性的类型</span></span><br><span class="line"><span class="comment">      select: 转换对象的 sql，即如何将 user_id转换成 User 对象</span></span><br><span class="line"><span class="comment">      解释属性 teacher 的类型有哪些属性 关联 查询表的那些列</span></span><br><span class="line"><span class="comment">	 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"dept"</span> <span class="attr">javaType</span>=<span class="string">"Department"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"d_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"d_name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"get"</span> <span class="attr">resultMap</span>=<span class="string">"singleMap2"</span>&gt;</span></span><br><span class="line">    select e.id, e.name, d.id d_id, d.name d_name from employee e left join department d on d.dept_id=d.id where e.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> student <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> teacher <span class="keyword">ON</span> tid = <span class="keyword">id</span> <span class="keyword">WHERE</span> student.id = <span class="comment">#&#123;id&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15637019018477-mybatis.png"></p>
<h3 id="多对一删除"><a href="#多对一删除" class="headerlink" title="多对一删除"></a>多对一删除</h3><hr>
<p>首先，删除学生的话不会有任何影响，但是删除老师就意味着这个老师教授的学生的老师字段将不存在，所以需要将这些字段的值一并删除，才符合现实逻辑。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	teaDao.delete(<span class="number">2l</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>要先将这个老师教授的学生与这个老师的关系删除，</li>
<li>再删除这个老师</li>
</ol>
<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"deleteRelation"</span>&gt;</span></span><br><span class="line">	update student_all2one set tea_id=null where tea_id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete"</span>&gt;</span></span><br><span class="line">	delete from student_all2one where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>TeacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete"</span>&gt;</span></span><br><span class="line">	delete from teacher_all2one where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>TeacherDAOImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">	SqlSession session = MybatisUtil.getConnection();</span><br><span class="line">	TeacherMapper teaMapper = session.getMapper(TeacherMapper.class);</span><br><span class="line">	StudentMapper stuMapper = session.getMapper(StudentMapper.class);</span><br><span class="line">	<span class="comment">// 先删除关系 即执行如下sql，将所有学生和这个老师的关系斩断</span></span><br><span class="line">	<span class="comment">// sql:update student_all2one set tea_id=null where tea_id=#&#123;id&#125;</span></span><br><span class="line">	stuMapper.deleteRelation(id);</span><br><span class="line">	teaMapper.delete(id);</span><br><span class="line">	session.commit();</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="一对多-一个老师教多个学生"><a href="#一对多-一个老师教多个学生" class="headerlink" title="一对多(一个老师教多个学生)"></a>一对多(一个老师教多个学生)</h2><hr>
<p>由 Teacher类来维护 Teacher和 Student类之间的关系</p>
<p>表结构不会改变，但 domain类中的维护关系方变成 Teacher 了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Student&gt; stus = <span class="keyword">new</span> ArrayList&lt;Student&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="一对多-add"><a href="#一对多-add" class="headerlink" title="一对多(add)"></a>一对多(add)</h3><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> IStudentDAO stuDao = <span class="keyword">new</span> StudentDAOImpl();</span><br><span class="line"><span class="keyword">private</span> ITeacherDAO teaDao = <span class="keyword">new</span> TeacherDAOImpl();</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="comment">// Teacher 类中包含 stus Student类的集合，所以先创建 Student 类</span></span><br><span class="line">	Student stu1 = <span class="keyword">new</span> Student();</span><br><span class="line">	stu1.setName(<span class="string">"小A"</span>);</span><br><span class="line">	stu1.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">	Student stu2 = <span class="keyword">new</span> Student(<span class="keyword">null</span>, <span class="string">"小B"</span>, <span class="string">"123456"</span>);</span><br><span class="line">	stuDao.save(stu1, stu2);</span><br><span class="line">	</span><br><span class="line">	Teacher tea = <span class="keyword">new</span> Teacher();</span><br><span class="line">	tea.setName(<span class="string">"A"</span>);</span><br><span class="line">	tea.setSex(<span class="string">"女"</span>);</span><br><span class="line">	tea.getStus().add(stu1);</span><br><span class="line">	tea.getStus().add(stu2);</span><br><span class="line">	teaDao.save(tea);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span> (Student stu : tea.getStus()) &#123;</span><br><span class="line">	   <span class="comment">// 添加依赖，维护 student表的 tea_id字段</span></span><br><span class="line">		stuDao.addRelation(tea.getId(), stu.getId());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析：先插入多个 Student对象，然后创建 Teacher对象，最后添加依赖。由于维护关系的责任在 Teacher身上，所以 Student类不能在被添加到数据库时知道自己是哪个 Teacher的学生。只能等 Teacher分配好以后才能知道，所以最后需要维护 student表的 tea_id字段。</p>
<p>TeacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">	insert into teacher_one2all (name, sex) values(#&#123;name&#125;, #&#123;sex&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">	insert into student_one2all (name, password) values(#&#123;name&#125;, #&#123;password&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"addRelation"</span>&gt;</span></span><br><span class="line">	update student_one2all set tea_id=#&#123;teaId&#125; where id=#&#123;stuId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>StudentMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">save</span><span class="params">(Student stu)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 多对一的情况，teacher 无法感知依赖，所以需要在保存的时候手动添加依赖</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> stuId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> teaId</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">addRelation</span><span class="params">(@Param(<span class="string">"teaId"</span>)</span>Long teaId, @<span class="title">Param</span><span class="params">(<span class="string">"stuId"</span>)</span>Long stuId)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span></span>;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">deleteRelation</span><span class="params">(Long id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="一对多select-额外-sql"><a href="#一对多select-额外-sql" class="headerlink" title="一对多select(额外 sql)"></a>一对多select(额外 sql)</h3><hr>
<p>test，需要做到在数据库中查询出 teacher时，就能得到对应的学生列表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	Teacher teacher = teaDao.get(<span class="number">39l</span>); <span class="comment">// 第一步</span></span><br><span class="line">	System.out.println(teacher);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由 teacher的 id属性到 student表中查询出所有 tea_id&#x3D;id的学生，需要在 StudentMapper.xml 添加一个额外的方法用于查询出 Student集合。</p>
<p>TeacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Teacher"</span> <span class="attr">id</span>=<span class="string">"teacherMap"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- colmn 把 teacher 表中的那一列作为参数，传到 select 里面去 --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 第三步 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"stus"</span> <span class="attr">column</span>=<span class="string">"id"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">select</span>=<span class="string">"cn.lizhaoloveit.mybatis.mapper.StudentMapper.getByTeaId"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 第二步 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getById"</span> <span class="attr">resultMap</span>=<span class="string">"teacherMap"</span>&gt;</span></span><br><span class="line">	select * from teacher_one2all where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getByTeaId"</span> <span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	select * from student_one2all where tea_id=#&#123;teaId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="一对多-关联查询"><a href="#一对多-关联查询" class="headerlink" title="一对多(关联查询)"></a>一对多(关联查询)</h3><hr>
<p>改动 DepartmentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Department"</span> <span class="attr">id</span>=<span class="string">"singleMap2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 关联查询，一对多，实际上就是类中包含了一个集合变量</span></span><br><span class="line"><span class="comment">        ofType 集合中每个元素的类型</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"es"</span> <span class="attr">ofType</span>=<span class="string">"Employee"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- Employee 中的属性分别对应列中的那些字段 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"e_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"e_name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"get"</span> <span class="attr">resultMap</span>=<span class="string">"map"</span>&gt;</span></span><br><span class="line">    select d.id, d.name, e.id e_id, e.name e_name </span><br><span class="line">    from department d left join employee e on d.id=e.dept_id</span><br><span class="line">    where d.id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="一对多-delete"><a href="#一对多-delete" class="headerlink" title="一对多(delete)"></a>一对多(delete)</h3><hr>
<ol>
<li>将 student表中的对应要删除的 tea_id 置空</li>
<li>删除 tea_id 的 teacher表中的数据。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	teaDao.delete(<span class="number">42l</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TeacherDAOImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">	SqlSession session = MybatisUtil.getConnection();</span><br><span class="line">	TeacherMapper teaMapper = session.getMapper(TeacherMapper.class);</span><br><span class="line">	StudentMapper stuMapper = session.getMapper(StudentMapper.class);</span><br><span class="line">	<span class="comment">// 先要解除关系，置空 tea_id 字段</span></span><br><span class="line">	stuMapper.deleteRelation(id);</span><br><span class="line">	teaMapper.delete(id);</span><br><span class="line">	session.commit();</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"deleteRelation"</span>&gt;</span></span><br><span class="line">	update student_one2all set tea_id=null where tea_id=#&#123;teaId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TeacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete"</span>&gt;</span></span><br><span class="line">	delete from teacher_one2all where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="多对多映射"><a href="#多对多映射" class="headerlink" title="多对多映射"></a>多对多映射</h2><hr>
<p>表结构：</p>
<p>学生表：</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398456-mybatis.png" alt="2019-07-25 at 4.06 P"></p>
<p>老师表：</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398457-mybatis.png" alt="2019-07-25 at 4.07 P"></p>
<p>关系表：</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398458-mybatis.png" alt="2019-07-25 at 4.08 P"></p>
<h3 id="多对多-save"><a href="#多对多-save" class="headerlink" title="多对多(save)"></a>多对多(save)</h3><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Teacher&gt; teachers = <span class="keyword">new</span> ArrayList&lt;Teacher&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> String sex;</span><br><span class="line">	<span class="keyword">private</span> List&lt;Student&gt; stus = <span class="keyword">new</span> ArrayList&lt;Student&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>test.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Student s1 = <span class="keyword">new</span> Student();</span><br><span class="line">s1.setName(<span class="string">"乔峰"</span>);</span><br><span class="line">s1.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">Student s2 = <span class="keyword">new</span> Student();</span><br><span class="line">s2.setName(<span class="string">"张无忌"</span>);</span><br><span class="line">s2.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">Teacher t1 = <span class="keyword">new</span> Teacher();</span><br><span class="line">t1.setName(<span class="string">"dafei"</span>);</span><br><span class="line">t1.setSex(<span class="string">"女"</span>);</span><br><span class="line">Teacher t2 = <span class="keyword">new</span> Teacher();</span><br><span class="line">t2.setName(<span class="string">"will"</span>);</span><br><span class="line">t2.setSex(<span class="string">"女"</span>);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 关系维护</span></span><br><span class="line">s1.getTeachers().add(t1);</span><br><span class="line">s1.getTeachers().add(t2);</span><br><span class="line">s2.getTeachers().add(t1);</span><br><span class="line">s2.getTeachers().add(t2);</span><br><span class="line">    </span><br><span class="line">t1.getStus().add(s1);</span><br><span class="line">t1.getStus().add(s2);</span><br><span class="line">t2.getStus().add(s1);</span><br><span class="line">t2.getStus().add(s2);</span><br></pre></td></tr></table></figure>

<p>创建 Student 和 Teacher对象，然后维护对象之间的关系，然后就要保存对象到数据库，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">stuDao.save(s1, s2); <span class="comment">// 1</span></span><br><span class="line">teaDao.save(t1, t2); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 维护中间表 student_teacher 保存这所有学生和老师的关系</span></span><br><span class="line"><span class="keyword">for</span> (Teacher t : s1.getTeachers()) &#123;</span><br><span class="line">	stuDao.addRelation(t.getId(), s1.getId());</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">// 维护中间表</span></span><br><span class="line"><span class="keyword">for</span> (Teacher t : s2.getTeachers()) &#123;</span><br><span class="line">	stuDao.addRelation(t.getId(), s2.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>操作 1和 2只是让数据进入到了表里，并没有对其关系做关联。因此需要额外表 student_teacher，保存 student 和 teacher表的关系。</p>
<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">	insert into student_all2all (name, password) values(#&#123;name&#125;, #&#123;password&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addRelation"</span>&gt;</span></span><br><span class="line">	insert into student_teacher (stu_id, tea_id) values(#&#123;stuId&#125;, #&#123;teaId&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>TeacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"save"</span> <span class="attr">useGeneratedKeys</span>=<span class="string">"true"</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span>&gt;</span></span><br><span class="line">	insert into teacher_all2all (name, sex) values(#&#123;name&#125;, #&#123;sex&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addRelation"</span>&gt;</span></span><br><span class="line">	insert into student_teacher (stu_id, tea_id) values(#&#123;stuId&#125;, #&#123;teaId&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="多对多-get-额外sql"><a href="#多对多-get-额外sql" class="headerlink" title="多对多(get 额外sql)"></a>多对多(get 额外sql)</h3><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	System.out.println(stuDao.get(<span class="number">9l</span>));</span><br><span class="line">	System.out.println(teaDao.get(<span class="number">10l</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>查询时，希望得到的 Student对象中 teachers可以被直接赋值。此时需要通过 resultMap </p>
<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"studentMap"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"teachers"</span> <span class="attr">column</span>=<span class="string">"id"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">select</span>=<span class="string">"cn.lizhaoloveit.mybatis.mapper.TeacherMapper.getByStuId"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getById"</span> <span class="attr">resultMap</span>=<span class="string">"studentMap"</span>&gt;</span></span><br><span class="line">	select * from student_all2all where id=#&#123;stuId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Teacher.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 将老师表和关系表以老师id 键连接，查询出所有教某个学生的 老师集合 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getByStuId"</span> <span class="attr">resultType</span>=<span class="string">"Teacher"</span>&gt;</span></span><br><span class="line">	select * </span><br><span class="line">	from teacher_all2all t left join student_teacher st on t.id=st.tea_id </span><br><span class="line">	where stu_id=#&#123;stuId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>查询 Student，需要在关联表中通过 stu_id，查出所有与之匹配的 tea_id，就可以找到该学生被哪些老师教授了。</p>
<p>同理，想要得到 Teacher对象。需要根据 tea_id，在关联表中找出所有匹配的 stu_id</p>
<p>TeacherMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Teacher"</span> <span class="attr">id</span>=<span class="string">"teacherMap"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"stus"</span> <span class="attr">column</span>=<span class="string">"id"</span></span></span><br><span class="line"><span class="tag">		<span class="attr">select</span>=<span class="string">"cn.lizhaoloveit.mybatis.mapper.StudentMapper.getByTeaId"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getById"</span> <span class="attr">resultMap</span>=<span class="string">"teacherMap"</span>&gt;</span></span><br><span class="line">	select * from teacher_all2all where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getByTeaId"</span> <span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	select * </span><br><span class="line">	from student_all2all s left join student_teacher st on s.id = st.stu_id   </span><br><span class="line">	where tea_id=#&#123;teaId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 也可以如下写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getByTeaId"</span> <span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	select * </span><br><span class="line">	from student_all2all </span><br><span class="line">	where id in</span><br><span class="line">	(select stu_id from student_teacher where tea_id=#&#123;teaId&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="多对多-get-关联查询"><a href="#多对多-get-关联查询" class="headerlink" title="多对多(get 关联查询)"></a>多对多(get 关联查询)</h3><hr>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s.id, s.name, t.id t_id, t.name t_name <span class="keyword">FROM</span> student s </span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> student_teacher st <span class="keyword">ON</span> s.id = st.stu_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> teacher <span class="keyword">ON</span> t.id = st.tea_id <span class="keyword">WHERE</span> s.id = <span class="comment">#&#123;id&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"Student"</span> <span class="attr">id</span>=<span class="string">"StudentMap"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"ts"</span> <span class="attr">ofType</span>=<span class="string">"Teacher"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"t_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"t_name"</span> <span class="attr">property</span>=<span class="string">"name"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SqlSession session = MyBatisUtil.getSqlSession();</span><br><span class="line">StudentMapper studentMapper = session.getMapper(StudentMapper.class);</span><br><span class="line"></span><br><span class="line">Student student = studentMapper.get(<span class="number">1L</span>);</span><br><span class="line"></span><br><span class="line">session.commit();</span><br><span class="line">session.close();</span><br></pre></td></tr></table></figure>

<h3 id="多对多-delete"><a href="#多对多-delete" class="headerlink" title="多对多(delete)"></a>多对多(delete)</h3><hr>
<p>在删除其中一个表的一个数据时，需要先删除其与其他表的关联。即先删除中间表中存在该字段的行。再删除该数据</p>
<p>以删除 student 表中一个数据为例，(teacher 同理)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	teaDao.delete(<span class="number">9l</span>);</span><br><span class="line">	stuDao.delete(<span class="number">10l</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StudentDAOImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(Long stuId)</span> </span>&#123;</span><br><span class="line">	SqlSession session = MybatisUtil.getConnection();</span><br><span class="line">	StudentMapper mapper = session.getMapper(StudentMapper.class);</span><br><span class="line">	mapper.deleteRelation(stuId);</span><br><span class="line">	mapper.delete(stuId);</span><br><span class="line">	session.commit();</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"delete"</span>&gt;</span></span><br><span class="line">	delete from student_all2all where id=#&#123;stuId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"deleteRelation"</span>&gt;</span></span><br><span class="line">	delete from student_teacher where stu_id=#&#123;stuId&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h1 id="延迟加载问题"><a href="#延迟加载问题" class="headerlink" title="延迟加载问题"></a>延迟加载问题</h1><hr>
<ul>
<li>什么是延迟加载</li>
</ul>
<p>查询订单并且关联查询用户信息时，如果先查询订单信息即可满足要求，当我们需要查询用户信息时再查询用户信息，把对用户信息的按需查询叫做延迟加载，</p>
<p>延迟加载就是，先从单表查询，需要时再从关联表取查询，单标查询要比关联表查询速度快。</p>
<p>使用 association、collection 实现一对一及一对多映射，association 和 collection 还具备延迟加载功能，查询订单并且关联查询用户，查询用户使用延迟加载。</p>
<p>延迟加载要查询两次，第二次是按需查询，之前一对一关联查询的时候，只需要查一次，把订单和用户信息都查出来了，所以只要一个 mapper。但是延迟加载查两次，所以要有两个 mapper。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 只查询表单 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersUserLazyLoading"</span> <span class="attr">resultMap</span>=<span class="string">"OrdersUserLazyLoadingResultMap"</span>&gt;</span></span><br><span class="line">	SELECT * FROM orders</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 只查询用户 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></span><br><span class="line">	select * from user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>延迟加载的配置：<br>mybatis 默认没有开启延迟加载，需要在 SqlMapConfig.xml 中的一些配置，有一个<code>&lt;settings&gt;</code>，可以通过这个标签来配置一下延迟加载。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 打开延迟加载的开关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将积极加载改为消极加载，即延迟加载 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"aggressiveLazyLoading"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 屏蔽掉 toString 方法 equals,clone,hashCode --&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadTriggerMethods"</span> <span class="attr">value</span>=<span class="string">"equals,clone,hashCode"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapperOrders</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//省去不相关代码</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//查询订单，关联用户查询，用户查询用的是延迟加载</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Orders&gt; <span class="title">findOrdersUserLazyLoading</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindOrdersUserLazyLoading</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line">	UserMapperOrders userMapperOrders = sqlSession.getMapper(UserMapperOrders.class);</span><br><span class="line">	<span class="comment">// 查询订单表（单表）</span></span><br><span class="line">	List&lt;Orders&gt; list = userMapperOrders.findOrdersUserLazyLoading();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 遍历上边的订单列表</span></span><br><span class="line">	<span class="keyword">for</span>(Orders orders : list) &#123;</span><br><span class="line">		<span class="comment">// 执行getUser()去查询用户信息，这里实现按需加载</span></span><br><span class="line">		User user = orders.getUser();</span><br><span class="line">		System.out.println(user);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用了延迟加载，将关联查询分成了两次单表查询，第二次查询用户的时候，没有发送 sql 就拿到了数据，其实这是 mybatis 中的一级缓存。</p>
<h2 id="延迟加载原理"><a href="#延迟加载原理" class="headerlink" title="延迟加载原理"></a>延迟加载原理</h2><hr>
<p>深入一些可以发现 orders.getUser() 方法中并没有相关的 sql 执行，为什么在加载完 list 订单表时，没有执行 sql ，而在 orders.getUser() 调用时，发送了查询 user 表的 sql。这是为什么？</p>
<p>其实，Mybatis 使用了动态代理技术，在 Mybatis 内部会生成一个动态代理类 Orders$xxxx类，该类继承 Orders，并会拦截所有 public 方法。</p>
<p>当调用 Orders 的 getUser()，调用的是代理类的同名方法，代理类会引用一个实现了 InvocationHandler 接口的切面增强类，会调接口的 invoke 方法，将方法名和方法参数传入 invoke 中，然后增强类引用 Orders 真实类型，并调用 Orders 的方法并传入参数。在 Orders 方法调用前后实现增强，详情见<a href="https://www.lizhaoloveit.cn/2019/07/31/SpringAOP/#JDK-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%8E%9F%E7%90%86" target="_blank" rel="noopener">动态代理原理</a></p>
<p>Orders$xxxx类，会有一个参数判断 User 是否已经加载，<code>boolean userLoaded = false</code>，在调用 getUser() 时，</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!userLoaded) &#123;</span><br><span class="line">        <span class="comment">// 执行 UserMapper 的 getUser 方法</span></span><br><span class="line">        <span class="comment">// 赋值</span></span><br><span class="line">        userLoaded = <span class="keyword">true</span>;</span><br><span class="line">        <span class="comment">// 返回</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 直接返回</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Mybatis-缓存"><a href="#Mybatis-缓存" class="headerlink" title="Mybatis 缓存"></a>Mybatis 缓存</h1><hr>
<p>缓存本质就是 Map，缓存是存在内存中的，可以在查询的时候减少数据库的访问次数，加快查询速度。</p>
<h2 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h2><hr>
<p>一级缓存的工作原理：</p>
<p>第一次发起查询用户id为1的用户信息，先去缓存中找是否有id为1的用户信息，如果没有，从数据库查询用户信息，得到用户信息，将用户信息存储到一级缓存中。</p>
<p>如果中间 sqlSession 去执行 commit 操作(插入、更新、删除)，则会清空 SqlSession 中的一级缓存，这样做的目的是为了让缓存中存储的是最新的版本，避免脏读。</p>
<p>第二次发起查询用户id为1的用户信息，先去找缓存中是否有id为1的用户信息，缓存中有，直接从缓存中获取用户信息。测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCache1</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	SqlSession sqlSession = sqlSessionFactory.openSession();<span class="comment">//创建代理对象</span></span><br><span class="line">	UserMapper userMapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//下边查询使用一个SqlSession</span></span><br><span class="line">	<span class="comment">//第一次发起请求，查询id为1的用户</span></span><br><span class="line">	User user1 = userMapper.findUserById(<span class="number">1</span>);</span><br><span class="line">	System.out.println(user1);</span><br><span class="line">	</span><br><span class="line"><span class="comment">//		如果sqlSession去执行commit操作（执行插入、更新、删除），清空SqlSession中的一级缓存，这样做的目的为了让缓存中存储的是最新的信息，避免脏读。</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//更新user1的信息</span></span><br><span class="line">	user1.setUsername(<span class="string">"测试用户22"</span>);</span><br><span class="line">	userMapper.updateUser(user1);</span><br><span class="line">	<span class="comment">//执行commit操作去清空缓存</span></span><br><span class="line">	sqlSession.commit();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//第二次发起请求，查询id为1的用户</span></span><br><span class="line">	User user2 = userMapper.findUserById(<span class="number">1</span>);</span><br><span class="line">	System.out.println(user2);</span><br><span class="line">	sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>一级缓存生命周期&#x3D;&#x3D;session 的生命周期，在多个 session 中是无法尽心该数据共享。</strong></p>
<p>在一次会话中，如果需要查询多次相同 id  的对象，此时后面几次的查询都会从缓存中获取，减少了访问数据库的次数，一级缓存的作用有限，只提高了一点点性能。</p>
<h2 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h2><hr>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398448-mybatis.jpg"></p>
<ol>
<li>二级缓存生命周期&#x3D;&#x3D; sessionFactory 的生命周期</li>
<li>二级缓存可以在不同的 session 之间进行数据的共享</li>
<li>二级缓存默认是关闭的，需要手动的去开启 <code>&lt;cache/&gt;</code></li>
<li>不是所有对象都适合放到二级缓存中，只有读远远大于写的对象才适合放到二级缓存中</li>
<li>只要对象发生 DML 操作，MyBatis 中的二级缓存都会给清除</li>
<li>手动开启二级缓存，对应的 mapper.xml 文件添加一行：<ul>
<li><code>&lt;cache/&gt;</code> 同时，需要缓存的对象实现序列化接口</li>
</ul>
</li>
</ol>
<p><strong>当内存中的对象已经达到设置的存储最大值，超出的对象如果需要也缓存起来，支持把缓存对象序列化到硬盘中，要获取的时候再反序列化回来</strong><br>domain</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">USer</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UserMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"User.Mapper"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">"org.mybatis.caches.ehcache.EhcacheCache"</span>/&gt;</span> <span class="comment">&lt;!-- 开启二级缓存，存到哪里 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    SqlSession session = MyBatisUtil.openSession();</span><br><span class="line">    UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line">    </span><br><span class="line">    User user = mapper.get(<span class="number">1l</span>);</span><br><span class="line">    </span><br><span class="line">    session.commit();</span><br><span class="line">    session.close();</span><br><span class="line">    </span><br><span class="line">    session = MyBatisUtil.openSession();</span><br><span class="line">    mapper = session.getMapper(UserMapper.class);</span><br><span class="line">    </span><br><span class="line">    user = mapper.get(<span class="number">1l</span>);</span><br><span class="line">    session.commit();</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二级缓存的高效使用"><a href="#二级缓存的高效使用" class="headerlink" title="二级缓存的高效使用"></a>二级缓存的高效使用</h3><hr>
<p>需求： 开启二级缓存后，get(1l); insert(4l); get(1l) —&gt; 总共发送3条 SQL</p>
<ol>
<li>查询所有记录的查询语句，如果每次都先去二级缓存中获取，经常获取不到，然后又要去数据库中查询，效率低，查询所有不使用二级缓存：<ul>
<li><code>useCache=&quot;false&quot;</code></li>
<li><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398449-mybatis.png"></li>
</ul>
</li>
<li>insert 不会对 get(1L) 造成影响，所以 insert 只有在查询所有的时候才会有影响，出现脏读，可以让 insert 不刷新缓存<ul>
<li><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398450-mybatis.png"></li>
</ul>
</li>
</ol>
<p>get(1L); insert(4l); get(1L) 就会只发送2条 SQL。第二次 get(1L) 是从二级缓存中获取的。</p>
<h2 id="EhCashe-二级缓存"><a href="#EhCashe-二级缓存" class="headerlink" title="EhCashe 二级缓存"></a>EhCashe 二级缓存</h2><hr>
<ul>
<li>mybatis-ehcache-1.0.2.jar</li>
<li>ehcache-core-2.6.5.jar</li>
</ul>
<h3 id="导包"><a href="#导包" class="headerlink" title="导包"></a>导包</h3><p>mybatis和ehcache包装的jar</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span>    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.caches<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>名称固定 ehcache.xml</p>
<blockquote>
<p><strong>maxElementsInMemory</strong>: 该缓存池在内存中最大的缓存对象个数<br><strong>eternal</strong>: 是否永久有效，如果设置为 true， 内存中对象永不过期<br><strong>timeToIdleSeconds</strong>: 缓存对象最大空闲时间，单位: 秒;<br><strong>timeToLiveSeconds</strong>: 缓存对象最大生存时间，单位: 秒;<br><strong>overflowToDisk</strong>: 当内存中对象超过最大值，是否临时保存到磁盘<br><strong>maxElementsOnDisk</strong>: 能保存到磁盘上最大对象数量<br><strong>diskExpiryThreadIntervalSeconds</strong>: 磁盘失效线程运行时间间隔，默认是120秒<br><strong>memoryStoreEvictionPolicy</strong>: 当达到 maxElementsInMemory 限制时， Ehcache 将会根据指定的策略去清理内存。默认策略是LRU(最近最少使用)，可以设置为 FIFO(先进先出)或者 LFU(较少使用)</p>
</blockquote>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398451-mybatis.png"></p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15640538230355-mybatis.jpg"></p>
<p>如果我们Mapper想单独拥有一些特性，需要在mapper.xml中单独配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 单位：毫秒 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">"org.mybatis.caches.ehcache.EhcacheCache"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeToIdleSeconds"</span> <span class="attr">value</span>=<span class="string">"12000"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeToLiveSeconds"</span> <span class="attr">value</span>=<span class="string">"3600"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 同ehcache参数maxElementsInMemory --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxEntriesLocalHeap"</span> <span class="attr">value</span>=<span class="string">"1000"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 同ehcache参数maxElementsOnDisk --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxEntriesLocalDisk"</span> <span class="attr">value</span>=<span class="string">"10000000"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"memoryStoreEvictionPolicy"</span> <span class="attr">value</span>=<span class="string">"LRU"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="mybatis局限性"><a href="#mybatis局限性" class="headerlink" title="mybatis局限性"></a>mybatis局限性</h2><hr>
<p>mybatis二级缓存对细粒度的数据级别的缓存实现不好，比如如下需求：</p>
<p>对商品信息进行缓存，由于商品信息查询访问量大，但是要求用户每次都能查询最新的商品信息，此时如果使用mybatis的二级缓存就无法实现当一个商品变化时只刷新该商品的缓存信息而不刷新其它商品的信息，因为mybaits的二级缓存区域以mapper为单位划分，当一个商品信息变化会将所有商品信息的缓存数据全部清空。解决此类问题需要在业务层根据需求对数据有针对性缓存。</p>
<h1 id="启动框架"><a href="#启动框架" class="headerlink" title="启动框架"></a>启动框架</h1><hr>
<p>目的：拿到数据库连接对象，操作增删改查</p>
<blockquote>
<p>步骤：</p>
</blockquote>
<ol>
<li>加载主配置文件</li>
<li>获取 SqlSesstionFactory 对象(相当于连接池)</li>
<li>通过 factory 获取 SqlSesstion</li>
</ol>
<h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 1.加载主配置文件 ? 和 Thread.currentThread().</span></span><br><span class="line"><span class="comment">     * getContextClassLoader()加载的区别</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	  InputStream in = Resources.getResourceAsStream(<span class="string">"mybatis-config.xml"</span>);</span><br><span class="line">    <span class="comment">// 2. 获取 factory 对象</span></span><br><span class="line">	  SqlSessionFactory factory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(in);</span><br><span class="line">    <span class="comment">// 3. 获取 session 对象 </span></span><br><span class="line">    SqlSession session = factory.openSession();</span><br><span class="line">    <span class="comment">// 参数1：找到指定的 SQL，namespace + . + id</span></span><br><span class="line">    <span class="comment">// 参数2：执行 SQL 是否需要给占位符设置参数</span></span><br><span class="line">    User u = <span class="keyword">new</span> User(<span class="keyword">null</span>, <span class="string">"谢谢"</span>, <span class="keyword">new</span> BigDecimal(<span class="string">"1000"</span>), <span class="keyword">new</span> Date());</span><br><span class="line">    System.out.println(u);</span><br><span class="line">    session.insert(<span class="string">"cn.lizhaoloveit.mybatis.UserMapper.insert"</span>, u);</span><br><span class="line">    <span class="comment">// 4.执行增删改，需要提交事务。</span></span><br><span class="line">    session.commit();</span><br><span class="line">    <span class="comment">// 5.不要忘记关闭资源</span></span><br><span class="line">    session.close();</span><br><span class="line">    System.out.println(u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Thread.currentThread().getContextClassLoader() 和 Class.getClassLoader() 的区别</p>
</blockquote>
<p><strong>前者是比较安全的用法，如果要在代码中动态加载 jar、资源文件的时候，首先应该使用 Thread.currentThread().getContextClassLoader()，因为如果你是用class.getClassLoader()，可能会导致和当前线程所运行的类加载器不一致，Java是天然的多线程，Java 只要类加载器不一致，加载出的类即使源文件一样，也会有不同的字节码对象。</strong></p>
<p><strong>Class.getClassLoader() 一般用在 getResource，因为你想获取某个资源文件的时候，这个资源文件的位置是相对固定的。</strong></p>
<blockquote>
<p>优化，1. 配置文件只需加载一次，整个应用只需要一个 SessionFactory 对象，也就是连接池对象</p>
</blockquote>
<p>优化后代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory factory = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String USERMAPPER_PATH = <span class="string">"cn.lizhaoloveit.mybatis.UserMapper"</span>;</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		factory = <span class="keyword">new</span> SqlSessionFactoryBuilder()</span><br><span class="line">				.build(Resources.getResourceAsStream(<span class="string">"mybatis-config.xml"</span>));</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	<span class="comment">// 获取 sesstion 对象</span></span><br><span class="line">	SqlSession session = factory.openSession();</span><br><span class="line">	<span class="comment">// </span></span><br><span class="line">	User u = <span class="keyword">new</span> User(<span class="keyword">null</span>, <span class="string">"路驾驭"</span>, <span class="keyword">new</span> BigDecimal(<span class="string">"100"</span>), <span class="keyword">new</span> Date());</span><br><span class="line">	session.insert(USERMAPPER_PATH + <span class="string">".insert"</span>, u);</span><br><span class="line">	<span class="comment">// 提交</span></span><br><span class="line">	session.commit();</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	SqlSession sesstion = factory.openSession();</span><br><span class="line">	User u = <span class="keyword">new</span> User(<span class="number">9l</span>, <span class="string">"路驾驭"</span>, <span class="keyword">new</span> BigDecimal(<span class="string">"100"</span>), <span class="keyword">new</span> Date());</span><br><span class="line">	sesstion.update(USERMAPPER_PATH + <span class="string">".update"</span>, u);</span><br><span class="line">	sesstion.commit();</span><br><span class="line">	sesstion.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	SqlSession session = factory.openSession();</span><br><span class="line">	session.delete(USERMAPPER_PATH + <span class="string">".delete"</span>, <span class="number">3l</span>);</span><br><span class="line">	session.commit();</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	SqlSession session = factory.openSession();</span><br><span class="line">	User u = session.selectOne(USERMAPPER_PATH + <span class="string">".get"</span>, <span class="number">2l</span>);</span><br><span class="line">	session.close();</span><br><span class="line">	System.out.println(u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGets</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">	SqlSession session = factory.openSession();</span><br><span class="line">	List&lt;User&gt; list = session.selectList(USERMAPPER_PATH + <span class="string">".gets"</span>);</span><br><span class="line">	session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="MyBatis-操作流程"><a href="#MyBatis-操作流程" class="headerlink" title="MyBatis 操作流程"></a>MyBatis 操作流程</h1><hr>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15623830724585-mybatis.jpg"></p>
<ol>
<li>通过主配置文件来启动框架，目的主要是获取 SqlSession 对象<br> 告知框架四要素和事务处理，以及关联mapper映射文件。</li>
<li>使用 session 对象执行 SQL 命令。<ul>
<li>找到指定的 SQL 命令：namespace(cn.lizhaoloveit.mybatis.UserMapper.insert) + . + id</li>
<li>传递执行该 SQL 需要的参数</li>
</ul>
</li>
<li>如果执行 DML 操作，不要忘记提交事务。</li>
<li>关闭源</li>
</ol>
<h1 id="OGNL-表达式"><a href="#OGNL-表达式" class="headerlink" title="OGNL 表达式"></a>OGNL 表达式</h1><hr>
<p><code>#{}</code> ：mybatis 会将该语法进行翻译，将<code>#{}</code>直接使用 ? 来替换，相当于是一个 SQL 模板，创建一个预编译语句对象，给占位符设置值</p>
<p><code>#{}</code> 就是一个 OGNL 表达式</p>
<p>OGNL (Object-Graph Navigation Language) 对象图形导航语言，可以存取对象的属性和调用对象的方法，遍历整个对象的结构图。</p>
<h2 id="如何取值"><a href="#如何取值" class="headerlink" title="如何取值"></a>如何取值</h2><hr>
<blockquote>
<p><code>#{}</code> 可以直接取某个位置的属性<br>如果该位置是一个 javabean 对象，**#{属性名}**<br>如果该位置是一个 map 对象 <strong>#{key}</strong><br>如果该位置是简单类型 <strong>#{任意}</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">    <span class="keyword">int</span> age;</span><br><span class="line">    Dept dept;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dept</span> </span>&#123;</span><br><span class="line">    String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * #(name) 取出来该对象的名字</span></span><br><span class="line"><span class="comment"> * #(age) 取出该对象的年龄</span></span><br><span class="line"><span class="comment"> * #(dept) 取出对象的部门信息</span></span><br><span class="line"><span class="comment"> * 表达式#&#123;dept.name&#125;，表示访问了 employee 对象的 dept 属性的 name 属性</span></span><br><span class="line"><span class="comment"> * 等价于 employee.getDept().getName()</span></span><br><span class="line"><span class="comment"> * 只要知道放在箱子中的数据类型是什么，就可以通过 #&#123;&#125;方法获取数据，以后</span></span><br><span class="line"><span class="comment"> * 应用最多的场景是往箱子中存 javabean</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>什么时候往 session 中放的数据<br>使用 session 对象调用增删改查的时候，传递的参数就是放数据</p>
</blockquote>
<blockquote>
<p>什么时候取？<br>在 mapper 文件中取</p>
</blockquote>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15624223475466-mybatis.jpg"></p>
<h1 id="使用日志"><a href="#使用日志" class="headerlink" title="使用日志"></a>使用日志</h1><hr>
<p>日志框架可以把日志的输出和代码分离，方便的定义日志的输出环境，控制台，文件，数据库，方便的定义日志的输出格式和输出级别。</p>
<p>ERROR &gt; WARN &gt; INFO &gt; TRACE</p>
<p>导入日志框架包：</p>
<p><code>log4j-1.2.17.jar</code> <code>slf4j-api-1.7.25.jar</code> <code>slf4j-log4j12-1.7.25.jar</code>—&gt; stf4 规范</p>
<p>配置日志文件监控 MyBatis 的运行</p>
<p>log4j.properties; 日志文件在 classpath</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Global logging configuration</span></span><br><span class="line"><span class="meta">log4j.rootLogger</span>=<span class="string">ERROR, stdout</span></span><br><span class="line"><span class="comment"># MyBatis logging configuration...</span></span><br><span class="line"><span class="meta">log4j.logger.cn.lizhaoloveit</span>=<span class="string">TRACE</span></span><br><span class="line"><span class="comment"># Console output...</span></span><br><span class="line"><span class="meta">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="meta">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%5p [%t] - %m%n</span></span><br></pre></td></tr></table></figure>

<h1 id="动态-SQL"><a href="#动态-SQL" class="headerlink" title="动态 SQL"></a>动态 SQL</h1><hr>
<p>如果你有 JDBC 或者其他相似框架的使用经验，就明白条件地串联 SQL 字符串在一起有多痛苦，确保不能忘了空格或者在列表的最后省略逗号。动态 SQL 可以彻底处理这种痛苦</p>
<p>通常使用动态 SQL 不可能是独立的一部分，MyBatis 使用一种强大的 动态 SQL 语言可以被用在任意映射的 SQL 语句中。</p>
<ul>
<li>if</li>
<li>choose(when, otherwise)</li>
<li>trim(where, set)</li>
<li>(foreach)</li>
</ul>
<h2 id="xml-转义字符"><a href="#xml-转义字符" class="headerlink" title="xml 转义字符"></a>xml 转义字符</h2><hr>
<table>
<thead>
<tr>
<th>字符实体</th>
<th>字符</th>
<th>意义</th>
</tr>
</thead>
<tbody><tr>
<td><code>&amp;lt;</code></td>
<td>&lt;</td>
<td>小于</td>
</tr>
<tr>
<td><code>&amp;gt;</code></td>
<td>&gt;</td>
<td>大于</td>
</tr>
<tr>
<td><code>&amp;amp;</code></td>
<td>&amp;</td>
<td>和</td>
</tr>
<tr>
<td><code>&amp;apos;</code></td>
<td>‘</td>
<td>单引号</td>
</tr>
<tr>
<td><code>&amp;quot;</code></td>
<td>“</td>
<td>双引号</td>
</tr>
</tbody></table>
<h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><hr>
<p>查询类如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QueryStudent</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> minAge;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> maxAge;</span><br><span class="line">	<span class="keyword">private</span> QueryByPage qbp;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span>[] ages;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper.xml 内要做模糊匹配和范围查询，三种方式和第一个 select 标签内要查询同一个内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryForName"</span> <span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	select * from student </span><br><span class="line">		where name like concat('%', concat(#&#123;name&#125;, '%')) </span><br><span class="line">			and age &amp;lt; #&#123;maxAge&#125; and age &amp;gt; #&#123;minAge&#125; </span><br><span class="line">				limit #&#123;qbp.beginIndex&#125;, #&#123;qbp.pageSize&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryForName"</span> <span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	select * from student</span><br><span class="line">	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null"</span>&gt;</span></span><br><span class="line">			name like concat('%', concat(#&#123;name&#125;, '%'))</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"maxAge != null"</span>&gt;</span></span><br><span class="line">			and age &amp;lt; #&#123;maxAge&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"minAge != null"</span>&gt;</span></span><br><span class="line">			and age &amp;gt; #&#123;minAge&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">		limit #&#123;qbp.beginIndex&#125;, #&#123;qbp.pageSize&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"queryForName"</span> <span class="attr">resultType</span>=<span class="string">"Student"</span>&gt;</span></span><br><span class="line">	select * from student</span><br><span class="line">	<span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"name != null"</span>&gt;</span></span><br><span class="line">			name like concat('%', concat(#&#123;name&#125;, '%'))</span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"ages != null"</span>&gt;</span></span><br><span class="line">			and age in</span><br><span class="line">			<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ages"</span> <span class="attr">item</span>=<span class="string">"age"</span> <span class="attr">index</span>=<span class="string">"index"</span> </span></span><br><span class="line"><span class="tag">			<span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">				#&#123;age&#125;</span><br><span class="line">			<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">		limit #&#123;qbp.beginIndex&#125;, #&#123;qbp.pageSize&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><hr>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findActiveBlogWithTitleLike"</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">parameterType</span>=<span class="string">"Blog"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG </span><br><span class="line">  WHERE state = ‘ACTIVE’ </span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span>  --如果title != null if 标签-- </span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果没有 title state&#x3D;’ACTIVE’ 的 blog 将会被返回，如果传递了 title，就会查找相近的 title 的 blog。</p>
<p>如果我们想可选的搜索 title 和 auther ，加入另一个简单的条件即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findActiveBlogLike"</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">parameterType</span>=<span class="string">"Blog"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’ </span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"author != null and author.name != null"</span>&gt;</span></span><br><span class="line">    AND author_name like #&#123;author.name&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="choose-when-otherwise"><a href="#choose-when-otherwise" class="headerlink" title="choose, when, otherwise"></a>choose, when, otherwise</h2><hr>
<p>有时候，不想应用所有的条件，很多情况下只选择一种，和 Java 中的 switch 语句相似，MyBatis 提供 choose 元素。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findActiveBlogLike"</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">parameterType</span>=<span class="string">"Blog"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG WHERE state = ‘ACTIVE’</span><br><span class="line">  <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">      AND title like #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"author != null and author.name != null"</span>&gt;</span></span><br><span class="line">      AND author_name like #&#123;author.name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">      AND featured = 1</span><br><span class="line">    <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="trim-where-set"><a href="#trim-where-set" class="headerlink" title="trim, where, set"></a>trim, where, set</h2><hr>
<p>如果 Where 后面的语句都是条件语句。就可以会出现问题，如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findActiveBlogLike"</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">parameterType</span>=<span class="string">"Blog"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG </span><br><span class="line">  WHERE </span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"state != null"</span>&gt;</span></span><br><span class="line">    state = #&#123;state&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">    AND title like #&#123;title&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"author != null and author.name != null"</span>&gt;</span></span><br><span class="line">    AND author_name like #&#123;author.name&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果这些条件都没有匹配上，这条 SQL 结束时就会成这样:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> BLOG </span><br><span class="line"><span class="keyword">WHERE</span></span><br></pre></td></tr></table></figure>
<p>如果仅仅第二条语句匹配：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> BLOG </span><br><span class="line"><span class="keyword">WHERE</span> </span><br><span class="line"><span class="keyword">AND</span> title <span class="keyword">like</span> ‘someTitle’</span><br></pre></td></tr></table></figure>
<p>where 标签就是用来解决这个问题，如果以 “AND” “OR” 开头的内容，就会跳过不插入 “AND” 或者 “OR”</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findActiveBlogLike"</span> </span></span><br><span class="line"><span class="tag">     <span class="attr">parameterType</span>=<span class="string">"Blog"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG </span><br><span class="line">  <span class="tag">&lt;<span class="name">where</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"state != null"</span>&gt;</span></span><br><span class="line">         state = #&#123;state&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"title != null"</span>&gt;</span></span><br><span class="line">        AND title like #&#123;title&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"author != null and author.name != null"</span>&gt;</span></span><br><span class="line">        AND author_name like #&#123;author.name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果 where 标签没有做出你想要的，可以使用 trim 标签自定义，比如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND |OR "</span>&gt;</span></span><br><span class="line">  ... </span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>和 where 类似，set 在更新时，也可能没有要更新的列字段。此时就会变成</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update Author set where id = ...</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateAuthorIfNecessary"</span></span></span><br><span class="line"><span class="tag">       <span class="attr">parameterType</span>=<span class="string">"domain.blog.Author"</span>&gt;</span></span><br><span class="line">  update Author</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"username != null"</span>&gt;</span>username=#&#123;username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"password != null"</span>&gt;</span>password=#&#123;password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"email != null"</span>&gt;</span>email=#&#123;email&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"bio != null"</span>&gt;</span>bio=#&#123;bio&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">  where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h2><hr>
<p>如果你需要动态在范围查找，构建一个集合，你可以传递一个 List 对象或者数组作为参数，MyBatis 会自动将它包装在一个 Map 中，名称作为键，List对象会以 “list” 作为键，数组会以 “array” 作为键。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectPostIn"</span> <span class="attr">resultType</span>=<span class="string">"domain.blog.Post"</span>&gt;</span></span><br><span class="line">  SELECT *</span><br><span class="line">  FROM POST P</span><br><span class="line">  WHERE ID in</span><br><span class="line">  <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">collection</span>=<span class="string">"list"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></span><br><span class="line">        #&#123;item&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果User有属性List ids。入参是User对象，那么这个collection &#x3D; “ids”<br>如果User有属性<code>Ids ids</code>;其中 Ids 是个对象，Ids 有个属性 <code>List id</code>;<br>入参是User对象，那么collection &#x3D; “ids.id”<br>如果参数是一个数组、或者一个集合，应该用 array 或者 list 来获取</p>
</blockquote>
<h3 id="批量插入和批量删除"><a href="#批量插入和批量删除" class="headerlink" title="批量插入和批量删除"></a>批量插入和批量删除</h3><hr>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/mybatis/15638780398452-mybatis.png"></p>
<h2 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h2><p>–</p>
<p>效果：可以把一段字符串拼接成一个属性”name”值 中</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectBlogsLike"</span> <span class="attr">parameterType</span>=<span class="string">"Blog"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bind</span> <span class="attr">name</span>=<span class="string">"pattern"</span> <span class="attr">value</span>=<span class="string">"'%' + _parameter.getTitle() + '%'"</span> /&gt;</span></span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line">  WHERE title LIKE #&#123;pattern&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Multi-db-vendor-support"><a href="#Multi-db-vendor-support" class="headerlink" title="Multi-db vendor support"></a>Multi-db vendor support</h2><p>支持不同的数据库一起查询</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insert"</span> <span class="attr">parameterType</span>=<span class="string">"org.myapp.domain.User"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"BEFORE"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_databaseId == 'oracle'"</span>&gt;</span></span><br><span class="line">      select seq_users.nextval from dual</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"_databaseId == 'db2'"</span>&gt;</span></span><br><span class="line">      select nextval for seq_users from sysibm.sysdummy1"</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">  insert into users values (#&#123;id&#125;, #&#123;name&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>MyBatis 3.2 开始，支持可插拔的脚本语言。</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectBlog"</span> <span class="attr">lang</span>=<span class="string">"raw"</span>&gt;</span></span><br><span class="line">  SELECT * FROM BLOG</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Mapper</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Lang</span>(RawLanguageDriver.class)</span><br><span class="line">  <span class="meta">@Select</span>(<span class="string">"SELECT * FROM BLOG"</span>)</span><br><span class="line">  <span class="function">List&lt;Blog&gt; <span class="title">selectBlog</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LanguageDriver</span> </span>&#123;</span><br><span class="line">  <span class="function">ParameterHandler <span class="title">createParameterHandler</span><span class="params">(MappedStatement mappedStatement, Object parameterObject, BoundSql boundSql)</span></span>;</span><br><span class="line">  <span class="function">SqlSource <span class="title">createSqlSource</span><span class="params">(Configuration configuration, XNode script, Class&lt;?&gt; parameterType)</span></span>;</span><br><span class="line">  <span class="function">SqlSource <span class="title">createSqlSource</span><span class="params">(Configuration configuration, String script, Class&lt;?&gt; parameterType)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ammar</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://lizhaoloveit.cn/2019/07/06/MyBatis/">http://lizhaoloveit.cn/2019/07/06/MyBatis/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lizhaoloveit.cn">Ammar's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MyBatis/">MyBatis    </a></div><div class="post_share"><div class="social-share" data-image="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2019/07/07/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8BSocket/"><img class="prev_cover lozad" data-src="https://www.lizhaoloveit.cn/blogimages/blog/cover/1.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/2.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/3.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/4.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/5.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/6.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/7.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/8.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/9.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/10.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/11.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/12.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/13.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/14.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/15.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/16.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/17.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/18.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/19.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/20.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/21.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/22.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/23.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/24.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/25.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/26.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/27.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/28.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/29.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/31.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/32.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/33.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/34.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/35.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/36.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/37.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/38.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/39.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/40.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/41.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/42.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/43.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/44.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/45.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/46.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/47.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/48.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/49.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/50.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/51.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/52.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/53.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/54.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/55.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/56.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/57.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/58.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/59.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/60.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/62.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/63.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/64.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/65.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/66.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/67.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/68.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/69.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/70.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/71.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/72.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/73.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/74.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/75.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/76.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/77.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/78.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/79.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>网络编程Socket</span></div></a></div><div class="next-post pull-right"><a href="/2019/07/04/JDBC/"><img class="next_cover lozad" data-src="https://www.lizhaoloveit.cn/blogimages/blog/cover/1.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/2.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/3.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/4.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/5.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/6.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/7.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/8.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/9.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/10.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/11.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/12.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/13.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/14.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/15.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/16.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/17.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/18.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/19.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/20.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/21.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/22.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/23.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/24.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/25.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/26.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/27.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/28.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/29.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/31.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/32.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/33.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/34.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/35.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/36.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/37.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/38.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/39.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/40.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/41.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/42.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/43.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/44.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/45.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/46.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/47.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/48.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/49.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/50.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/51.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/52.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/53.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/54.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/55.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/56.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/57.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/58.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/59.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/60.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/62.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/63.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/64.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/65.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/66.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/67.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/68.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/69.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/70.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/71.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/72.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/73.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/74.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/75.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/76.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/77.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/78.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/79.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>JDBC</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'http://lizhaoloveit.cn/2019/07/06/MyBatis/';
  this.page.identifier = '2019/07/06/MyBatis/';
  this.page.title = 'MyBatis';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'lizhao' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2014 - 2024 By Ammar</div><div class="icp"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener"><span>浙ICP备19013619号-1</span></a></div><div class="bag"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010502006128" target="_blank" rel="noopener"><img src="/img/beian.png"><span>浙公网安备 33010502006128号</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="阅读模式"> </i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">繁</a><i class="far fa-moon nightshift" id="nightshift" title="夜间模式"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script async src="/js/search/algolia.js"></script><script src="/js/nightshift.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>