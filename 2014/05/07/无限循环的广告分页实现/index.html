<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>无限循环的广告分页实现 | Ammar's Blog</title><meta name="description" content="无限循环的广告分页实现"><meta name="keywords" content="iOS"><meta name="author" content="Ammar"><meta name="copyright" content="Ammar"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.1/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://lizhaoloveit.cn/2014/05/07/%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%B9%BF%E5%91%8A%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="无限循环的广告分页实现"><meta name="twitter:description" content="无限循环的广告分页实现"><meta name="twitter:image" content="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg"><meta property="og:type" content="article"><meta property="og:title" content="无限循环的广告分页实现"><meta property="og:url" content="http://lizhaoloveit.cn/2014/05/07/%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%B9%BF%E5%91%8A%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/"><meta property="og:site_name" content="Ammar's Blog"><meta property="og:description" content="无限循环的广告分页实现"><meta property="og:image" content="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="iOS通知机制" href="http://lizhaoloveit.cn/2014/05/11/iOS%E9%80%9A%E7%9F%A5%E6%9C%BA%E5%88%B6/"><link rel="next" title="iOS控制器间跳转" href="http://lizhaoloveit.cn/2014/04/18/iOS%E6%8E%A7%E5%88%B6%E5%99%A8%E9%97%B4%E8%B7%B3%E8%BD%AC/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?162506e75ffd64287398566b2f5738c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"VRMKRAV9AT","apiKey":"bd7157400046d0f02396708a501a3480","indexName":"lizhaoloveit","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://lizhaoloveit.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天'

  
}</script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#这是一个使用3个-imageView-完成的广告展示页面"><span class="toc-number">1.</span> <span class="toc-text">这是一个使用3个 imageView 完成的广告展示页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实现思路如下："><span class="toc-number">2.</span> <span class="toc-text">实现思路如下：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#具体代码和讲解："><span class="toc-number">3.</span> <span class="toc-text">具体代码和讲解：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#第一步需要搞清楚项目需求"><span class="toc-number">3.1.</span> <span class="toc-text">第一步需要搞清楚项目需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#接下来就要开始初始化控件了"><span class="toc-number">3.2.</span> <span class="toc-text">接下来就要开始初始化控件了</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三步要控制子控件的尺寸"><span class="toc-number">3.3.</span> <span class="toc-text">第三步要控制子控件的尺寸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#给子控件设置显示内容"><span class="toc-number">3.4.</span> <span class="toc-text">给子控件设置显示内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用代理让外界可以监听到按钮的点击"><span class="toc-number">3.5.</span> <span class="toc-text">使用代理让外界可以监听到按钮的点击</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#第一步：声明代理和代理方法"><span class="toc-number">3.5.1.</span> <span class="toc-text">第一步：声明代理和代理方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#第二步：在监听点击的方法中调用代理的代理方法即可"><span class="toc-number">3.5.2.</span> <span class="toc-text">第二步：在监听点击的方法中调用代理的代理方法即可</span></a></li></ol></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://lizhaoloveit.cn/blogimages/blog/top_img.jpg)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">Ammar's Blog</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description">微信号：aicjaish</div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a><a class="site-page" href="/comment/"><i class="fa-fw fa fa-coffee"></i><span> 留言</span></a><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">无限循环的广告分页实现</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2014-05-07<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-07-29</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/iOS/">iOS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/iOS/UI/">UI</a></span><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">2.5k</span><span class="post-meta__separator">|</span><span>阅读时长: 9 分钟</span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h2 id="这是一个使用3个-imageView-完成的广告展示页面"><a href="#这是一个使用3个-imageView-完成的广告展示页面" class="headerlink" title="这是一个使用3个 imageView 完成的广告展示页面"></a>这是一个使用3个 imageView 完成的广告展示页面</h2><p>代码如下：<a href="https://github.com/lizhaoLoveIT/AMInfiniteScrollPage" target="_blank" rel="noopener">无线循环的广告分页</a></p>
<hr>
<h2 id="实现思路如下："><a href="#实现思路如下：" class="headerlink" title="实现思路如下："></a>实现思路如下：</h2><p>当用户向左滑动屏幕时，此时 imageView3 展示到了 scrollView 上，imageView1 完全看不见，可以将 imageView1 重用到 imageView3 后面展示下一张图片。</p>
<p>当用户向右滑动屏幕时，此时 imageView1 展示到了 scrollView 上， imageView3 完全看不见，可以将 imageView3 重用到 imageView1 前面展示上一张图片。</p>
<h2 id="具体代码和讲解："><a href="#具体代码和讲解：" class="headerlink" title="具体代码和讲解："></a>具体代码和讲解：</h2><h3 id="第一步需要搞清楚项目需求"><a href="#第一步需要搞清楚项目需求" class="headerlink" title="第一步需要搞清楚项目需求"></a>第一步需要搞清楚项目需求</h3><p>创建项目，这里以我的 AMInfiniteScrollPage 为例：</p>
<p>拿到一个自定义控件，我们要先写其接口，就是先思考外界如何使用你的控件。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AMInfiniteScrollPage</span> : <span class="title">UIView</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** 图片名 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSArray</span> *imageNames;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 设置自动滚动时间间隔 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSTimeInterval</span> timeInterval;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 设置右下角点点的选中颜色 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIColor</span> *currentPageIndicatorTintColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 设置右下角点点未选中时的颜色 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIColor</span> *pageIndicatorTintColor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** 设置右下角点点的位置 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">assign</span>, <span class="keyword">nonatomic</span>) <span class="built_in">CGPoint</span> pageControllerCenter;</span><br></pre></td></tr></table></figure>

<p>需要展示广告图片，因此需要接受一个图片<strong>名数组</strong>：imageNames。</p>
<p>既然是广告，需要自动滚动，因此要设置滚动<strong>时间间隔</strong>：timeInterval</p>
<p>右下角的点点的<strong>颜色</strong>和<strong>位置</strong>也不应该写死，要有外界传入，因此需要参数：<code>currentPageIndicatorTintColor</code>，<code>pageIndicatorTintColor</code>，<code>pageControllerCenter</code>。</p>
<p>既然是广告肯定可以点，因此我们还需要<strong>监听用户对图片的点击</strong>，需要设置<strong>代理</strong>。</p>
<h3 id="接下来就要开始初始化控件了"><a href="#接下来就要开始初始化控件了" class="headerlink" title="接下来就要开始初始化控件了"></a>接下来就要开始初始化控件了</h3><p>接下来就要初始化控件了。我们需要搞清楚都有哪些控件，第一：滚动说明肯定有 scrollView，scrollView 里需要展示图片，所以 scrollView 里包含 button 按钮。第二：需要标注页码，所以需要 pageController。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AMInfiniteScrollPage</span> () </span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** scrollView */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIScrollView</span> *scrollView;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** pageController */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="built_in">UIPageControl</span> *pageController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>初始化方法需要写在下面的方法中：<br>这里建议将代码模块化，一个方法做一件事情，将每个功能都封装起来。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">instancetype</span>)initWithFrame:(<span class="built_in">CGRect</span>)frame</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> initWithFrame:frame]) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 创建并设置 scrollView</span></span><br><span class="line">        [<span class="keyword">self</span> setupScrollView];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setupScrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 首先去掉滚动条</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.showsHorizontalScrollIndicator = <span class="literal">NO</span>;</span><br><span class="line">    <span class="keyword">self</span>.scrollView.showsVerticalScrollIndicator = <span class="literal">NO</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 然后去掉弹簧效果</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.bounces = <span class="literal">NO</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加分页效果</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.pagingEnabled = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 允许用户交互</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.userInteractionEnabled = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置代理</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.delegate = <span class="keyword">self</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加按钮控件</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; imageViewCount; i++) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">UIButton</span> *button = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 默认是 YES，如果是 YES 按钮会在点击的时候变暗</span></span><br><span class="line">        button.adjustsImageWhenHighlighted = <span class="literal">NO</span>;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 接受中间的按钮的点击事件</span></span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">1</span>) &#123;</span><br><span class="line">            [button addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(didSelectedImage) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span>.scrollView addSubview:button];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里用按钮替代了 imageView 是因为将来用户可能点击图片进入广告界面，因此需要监听用户的点击，按钮可以很轻松的监听到用户点击</p>
<p>建议把子控件写成懒加载的形式，这样在设置子控件的时候不用在意顺序，肯定是不为空的。下面为懒加载代码：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建 scrollView</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_scrollView == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">UIScrollView</span> *scrollView = [[<span class="built_in">UIScrollView</span> alloc] init];</span><br><span class="line">        </span><br><span class="line">        _scrollView = scrollView;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> addSubview:scrollView];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _scrollView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建 pageController</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="built_in">UIPageControl</span> *)pageController</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (_pageController == <span class="literal">nil</span>) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">UIPageControl</span> *pageController = [[<span class="built_in">UIPageControl</span> alloc] init];</span><br><span class="line">        </span><br><span class="line">        _pageController = pageController;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 单页时隐藏</span></span><br><span class="line">        pageController.hidesForSinglePage = <span class="literal">YES</span>;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span> addSubview:pageController];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _pageController;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>到这里我们已经初始化完成了 <code>scrollView</code> 和 <code>pageController</code></p>
<h3 id="第三步要控制子控件的尺寸"><a href="#第三步要控制子控件的尺寸" class="headerlink" title="第三步要控制子控件的尺寸"></a>第三步要控制子控件的尺寸</h3><p>接下来我们需要设置子控件的尺寸了，下面这点很关键：</p>
<p><strong>由于 <code>AMInfiniteScrollPage:UIView</code> 是父控件，而它的尺寸是由外界决定的，而设置子控件(scrollView 和 pageController)的尺寸时必须基于父控件，这时我们需要用到 <code>-layoutSubviews</code>方法，这个方法会在 <code>AMInfiniteScrollPage:UIView</code> 的尺寸发生变化之后的一个恰当的时刻调用，而进入这个方法后，<code>AMInfiniteScrollPage:UIView</code> 的尺寸就准确了。因此在这个方法中布局子控件是最合适的</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)layoutSubviews</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">super</span> layoutSubviews];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置 scrollView 的尺寸</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.frame = <span class="keyword">self</span>.bounds;</span><br><span class="line">    <span class="keyword">self</span>.scrollView.contentSize = <span class="built_in">CGSizeMake</span>(<span class="keyword">self</span>.bounds.size.width * imageViewCount, <span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置图片按钮的尺寸和位置</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span>; i &lt; imageViewCount; i++) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">UIButton</span> *button = <span class="keyword">self</span>.scrollView.subviews[i];</span><br><span class="line">        </span><br><span class="line">        button.frame = <span class="built_in">CGRectMake</span>(i * <span class="keyword">self</span>.scrollView.frame.size.width, <span class="number">0</span>, <span class="keyword">self</span>.scrollView.frame.size.width, <span class="keyword">self</span>.scrollView.frame.size.height);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置 pageController</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">CGPointEqualToPoint</span>(<span class="keyword">self</span>.pageController.center, <span class="built_in">CGPointZero</span>)) &#123; <span class="comment">// 如果用户设置尺寸和位置</span></span><br><span class="line">        <span class="keyword">self</span>.pageController.center = <span class="keyword">self</span>.pageControllerCenter;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; <span class="comment">// 使用默认</span></span><br><span class="line">        <span class="keyword">self</span>.pageController.center = <span class="built_in">CGPointMake</span>(<span class="number">0.83</span> * <span class="keyword">self</span>.bounds.size.width, <span class="number">0.9</span> * <span class="keyword">self</span>.bounds.size.height);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置内容</span></span><br><span class="line">    [<span class="keyword">self</span> addImageToButton];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在布局完子控件的尺寸后，就要给子控件设置内容了。前面说过，单独的功能封装成单独的方法。</p>
<h3 id="给子控件设置显示内容"><a href="#给子控件设置显示内容" class="headerlink" title="给子控件设置显示内容"></a>给子控件设置显示内容</h3><p>重写 imageNames 的 <code>setter</code> 方法，这里可以拿到外界传入的 <code>imageNames</code>，我们就可以知道有多少页了，同时还知道具体的图片是什么了。这时设置 <code>pageController</code> 和 添加图片到 imageView 上去的最佳时机。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)setImageNames:(<span class="built_in">NSArray</span> *)imageNames</span><br><span class="line">&#123;</span><br><span class="line">    _imageNames = imageNames;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置 pageController</span></span><br><span class="line">    <span class="keyword">self</span>.pageController.numberOfPages = imageNames.count;</span><br><span class="line">    <span class="keyword">self</span>.pageController.currentPage = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 更新 imageView 图片</span></span><br><span class="line">    [<span class="keyword">self</span> addImageToButton];</span><br><span class="line">    </span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加图片到 button 的背景图片中去</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)addImageToButton</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 清空当前 currentPages 数组</span></span><br><span class="line">    [<span class="keyword">self</span>.theCurrentPages removeAllObjects];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSInteger</span> i = <span class="number">0</span> ; i &lt; imageViewCount; i++) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 取出 button</span></span><br><span class="line">        <span class="built_in">UIButton</span> *button = <span class="keyword">self</span>.scrollView.subviews[i];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 取出当前页码</span></span><br><span class="line">        <span class="built_in">NSInteger</span> index = <span class="keyword">self</span>.pageController.currentPage;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果是第一个 imageView，所对应的图片名在图片数组中的位置应该是: index - 1</span></span><br><span class="line">            index--;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果是第三个 imageView，所对应的图片名在图片数组中的位置应该是: index + 1</span></span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 判断是否是第一张图片或者是最后一张图片</span></span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 当前显示第一张图片</span></span><br><span class="line">            index = <span class="keyword">self</span>.pageController.numberOfPages - <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (index == <span class="keyword">self</span>.pageController.numberOfPages) &#123;</span><br><span class="line">            <span class="comment">// 当前显示最后一张图片</span></span><br><span class="line">            index = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        [button setBackgroundImage:[<span class="built_in">UIImage</span> imageNamed:<span class="keyword">self</span>.imageNames[index]] forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">        [<span class="keyword">self</span>.theCurrentPages addObject:@(index)];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 设置偏移量始终在中间</span></span><br><span class="line">    <span class="keyword">self</span>.scrollView.contentOffset = <span class="built_in">CGPointMake</span>(<span class="keyword">self</span>.scrollView.frame.size.width, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>思路：以当前展示图片的中间的 button 为基准，假设图片名在 imageNames 中的索引为 index，则前一个索引就是 index–(由前一个 imageView 负责展示)，后一个索引就是 index++(由后一个 button 负责展示)，如果当前索引为0，则说明展示的是第一张图片，这前一个 button 就展示 imageNames 的最后一张图片。<br>   因为一会滚动时需要拿到当前3个 button  所展示的3张图片进行操作，所以用一个数组保存当前的3个 button 展示的图片的索引。然后根据索引对 button 中的 image 赋值。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** 用来记录当前3个 imageView 显示的页码 */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">strong</span>, <span class="keyword">nonatomic</span>) <span class="built_in">NSMutableArray</span> *theCurrentPages;</span><br><span class="line"></span><br><span class="line">```   </span><br><span class="line">   最后不要忘记让 scrollView 偏移到中间的 button(显示中间的 button 的背景图片)。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">但由于此时可能 `AMInfiniteScrollPage:<span class="built_in">UIView</span>` 调用 `- (<span class="keyword">void</span>)setImageNames:(<span class="built_in">NSArray</span> *)imageNames` 方法时并没有尺寸。因此为了保险起见，应当在 `- (<span class="keyword">void</span>)layoutSubviews` 方法中设置完尺寸后再调用一次 `- (<span class="keyword">void</span>)addImageToButton` 方法显示图片。</span><br><span class="line"></span><br><span class="line">***</span><br><span class="line"></span><br><span class="line">到这一步，当你导入头文件，设置属性后，运行程序已经可以看见图片显示了。</span><br><span class="line"></span><br><span class="line"><span class="meta">### 实现业务逻辑</span></span><br><span class="line"></span><br><span class="line">接下来需要实现的是，当用户拖拽 scrollView 时，<span class="number">3</span>个 imageView 不断显示新的图片即可。</span><br><span class="line">代码如下：</span><br><span class="line"></span><br><span class="line">```objc</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 滚动时会调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidScroll:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 找出中间的 button 的页码</span></span><br><span class="line">    <span class="built_in">NSInteger</span> cunrrentPage = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.scrollView.contentOffset.x &gt;= <span class="number">0.5</span> * <span class="keyword">self</span>.scrollView.contentSize.width) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 当向左划超过 button 一半的尺寸时</span></span><br><span class="line">        cunrrentPage = [<span class="keyword">self</span>.theCurrentPages[imageViewCount - <span class="number">1</span>] integerValue];</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span>.scrollView.contentOffset.x &gt;= <span class="number">0.5</span> * <span class="keyword">self</span>.scrollView.frame.size.width) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 当向左或者向右滑都未超过一半 button 的尺寸时</span></span><br><span class="line">        cunrrentPage = [<span class="keyword">self</span>.theCurrentPages[imageViewCount - <span class="number">2</span>] integerValue];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 向右滑超过 button 一半的尺寸时</span></span><br><span class="line">        cunrrentPage = [<span class="keyword">self</span>.theCurrentPages[imageViewCount - <span class="number">3</span>] integerValue];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.pageController.currentPage = cunrrentPage;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们必须实现 scrollView 的代理方法，关于 scrollView 的用法可参见 <strong><a href="https://lizhaoloveit.github.io/2014/03/27/OC-UIScrollView/" target="_blank" rel="noopener">UIScrollView</a></strong></p>
<p>具体看注释。通过 scrollView 的 contentOffset.x 的值来判定当前展示的是哪个 button。<br>及时调整 currentPage 的值。接下来，当用户停止拖拽时，只需要根据 currentPage 来重新给 button 赋上新的 image 即可。这里需要考虑不是用户拖拽，而是别的情况导致 scrollView 的 contentOffset 属性的变化引起的 currentPage 的变化。具体代码如下</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户快要停止拖拽时调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidEndDecelerating:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 更新状态</span></span><br><span class="line">    [<span class="keyword">self</span> addImageToButton];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * contentOffset 属性改变时</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidEndScrollingAnimation:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> addImageToButton];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>当这些代码完成后，你已经可以拖拽广告页面了，基本实现了3个控件轮播展示广告分页，接下来需要做的就是加一个定时器让 scrollView 自动滚动。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开启定时器方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)setTimeInterval:(<span class="built_in">NSTimeInterval</span>)timeInterval</span><br><span class="line">&#123;</span><br><span class="line">    _timeInterval = timeInterval;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建定时器</span></span><br><span class="line">    <span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:timeInterval target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(nextPage) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">    <span class="keyword">self</span>.timer = timer;</span><br><span class="line">    </span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> mainRunLoop] addTimer:<span class="keyword">self</span>.timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 跳转下一页</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)nextPage</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.scrollView setContentOffset:<span class="built_in">CGPointMake</span>(<span class="number">2</span> * <span class="keyword">self</span>.scrollView.frame.size.width, <span class="number">0</span>) animated:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们拿到外界的间隔时间，创建定时器。每隔 <code>timeInterval</code> 秒执行 <code>nextPage</code> 方法。定时器需要在用户拖拽时销毁，而在用户停止拖拽时启动。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * scrollView 用户拖拽之前会调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewWillBeginDragging:(<span class="built_in">UIScrollView</span> *)scrollView</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> stopTimer];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 停止定时器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)stopTimer</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span>.timer invalidate];</span><br><span class="line">    <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * scrollView 用户停止拖拽时</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)scrollViewDidEndDragging:(<span class="built_in">UIScrollView</span> *)scrollView willDecelerate:(<span class="built_in">BOOL</span>)decelerate</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="keyword">self</span> setTimeInterval:<span class="keyword">self</span>.timeInterval];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>至此除了监听按钮点击功能，其他功能已经写完了。</p>
<h3 id="使用代理让外界可以监听到按钮的点击"><a href="#使用代理让外界可以监听到按钮的点击" class="headerlink" title="使用代理让外界可以监听到按钮的点击"></a>使用代理让外界可以监听到按钮的点击</h3><p>要想监听按钮的点击功能，由于外界拿不到 AMInfiniteScrollPage 中的 button，因此外界无法直接监听 AMInfiniteScrollPage 的点击事件，需要设置代理。</p>
<p>当用户点击了哪张图片，就调用代理方法通知外界，并将图片的索引传给外界。</p>
<h4 id="第一步：声明代理和代理方法"><a href="#第一步：声明代理和代理方法" class="headerlink" title="第一步：声明代理和代理方法"></a>第一步：声明代理和代理方法</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">AMInfiniteScrollPageDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)infiniteScrollPage:(AMInfiniteScrollPage *)infiniteScrollPage didSelectedImageAtIndex:(<span class="built_in">NSInteger</span>)index;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<h4 id="第二步：在监听点击的方法中调用代理的代理方法即可"><a href="#第二步：在监听点击的方法中调用代理的代理方法即可" class="headerlink" title="第二步：在监听点击的方法中调用代理的代理方法即可"></a>第二步：在监听点击的方法中调用代理的代理方法即可</h4><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点击了 scrollView中的按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">- (<span class="keyword">void</span>)didSelectedImage</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 监听到了按钮点击 调用代理方法通知外界</span></span><br><span class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.delegate respondsToSelector:<span class="keyword">@selector</span>(infiniteScrollPage:didSelectedImageAtIndex:)]) &#123;</span><br><span class="line">        </span><br><span class="line">        [<span class="keyword">self</span>.delegate infiniteScrollPage:<span class="keyword">self</span> didSelectedImageAtIndex:<span class="keyword">self</span>.pageController.currentPage];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ammar</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://lizhaoloveit.cn/2014/05/07/%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%B9%BF%E5%91%8A%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/">http://lizhaoloveit.cn/2014/05/07/%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%B9%BF%E5%91%8A%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lizhaoloveit.cn">Ammar's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/iOS/">iOS    </a></div><div class="post_share"><div class="social-share" data-image="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2014/05/11/iOS%E9%80%9A%E7%9F%A5%E6%9C%BA%E5%88%B6/"><img class="prev_cover lozad" data-src="https://www.lizhaoloveit.cn/blogimages/blog/cover/1.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/2.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/3.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/4.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/5.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/6.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/7.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/8.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/9.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/10.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/11.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/12.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/13.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/14.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/15.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/16.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/17.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/18.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/19.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/20.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/21.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/22.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/23.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/24.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/25.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/26.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/27.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/28.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/29.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/31.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/32.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/33.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/34.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/35.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/36.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/37.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/38.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/39.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/40.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/41.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/42.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/43.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/44.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/45.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/46.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/47.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/48.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/49.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/50.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/51.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/52.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/53.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/54.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/55.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/56.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/57.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/58.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/59.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/60.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/62.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/63.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/64.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/65.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/66.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/67.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/68.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/69.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/70.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/71.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/72.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/73.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/74.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/75.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/76.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/77.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/78.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/79.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>iOS通知机制</span></div></a></div><div class="next-post pull-right"><a href="/2014/04/18/iOS%E6%8E%A7%E5%88%B6%E5%99%A8%E9%97%B4%E8%B7%B3%E8%BD%AC/"><img class="next_cover lozad" data-src="https://www.lizhaoloveit.cn/blogimages/blog/cover/1.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/2.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/3.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/4.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/5.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/6.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/7.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/8.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/9.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/10.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/11.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/12.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/13.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/14.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/15.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/16.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/17.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/18.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/19.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/20.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/21.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/22.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/23.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/24.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/25.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/26.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/27.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/28.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/29.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/31.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/32.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/33.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/34.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/35.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/36.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/37.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/38.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/39.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/40.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/41.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/42.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/43.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/44.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/45.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/46.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/47.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/48.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/49.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/50.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/51.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/52.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/53.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/54.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/55.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/56.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/57.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/58.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/59.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/60.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/62.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/63.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/64.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/65.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/66.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/67.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/68.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/69.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/70.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/71.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/72.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/73.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/74.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/75.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/76.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/77.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/78.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/79.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>iOS控制器间跳转</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'http://lizhaoloveit.cn/2014/05/07/%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%B9%BF%E5%91%8A%E5%88%86%E9%A1%B5%E5%AE%9E%E7%8E%B0/';
  this.page.identifier = '2014/05/07/无限循环的广告分页实现/';
  this.page.title = '无限循环的广告分页实现';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'lizhao' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2014 - 2023 By Ammar</div><div class="icp"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener"><span>浙ICP备19013619号-1</span></a></div><div class="bag"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010502006128" target="_blank" rel="noopener"><img src="/img/beian.png"><span>浙公网安备 33010502006128号</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="阅读模式"> </i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">繁</a><i class="far fa-moon nightshift" id="nightshift" title="夜间模式"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script async src="/js/search/algolia.js"></script><script src="/js/nightshift.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>