<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>Zookeeper的应用 | Ammar's Blog</title><meta name="description" content="Zookeeper的应用"><meta name="keywords" content="Zookeeper"><meta name="author" content="Ammar"><meta name="copyright" content="Ammar"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.1/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="canonical" href="http://lizhaoloveit.cn/2020/09/07/Zookeeper%E7%9A%84%E5%BA%94%E7%94%A8/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Zookeeper的应用"><meta name="twitter:description" content="Zookeeper的应用"><meta name="twitter:image" content="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Zookeeper的应用"><meta property="og:url" content="http://lizhaoloveit.cn/2020/09/07/Zookeeper%E7%9A%84%E5%BA%94%E7%94%A8/"><meta property="og:site_name" content="Ammar's Blog"><meta property="og:description" content="Zookeeper的应用"><meta property="og:image" content="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="prev" title="Zookeeper" href="http://lizhaoloveit.cn/2020/09/07/Zookeeper/"><link rel="next" title="MyBatis Generator" href="http://lizhaoloveit.cn/2020/07/28/MyBatis-Generator/"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?162506e75ffd64287398566b2f5738c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"VRMKRAV9AT","apiKey":"bd7157400046d0f02396708a501a3480","indexName":"lizhaoloveit","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":1,"translateDelay":0,"cookieDomain":"https://lizhaoloveit.cn/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  highlight_copy: 'true',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: '添加书签',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天'

  
}</script><meta name="generator" content="Hexo 4.2.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ZkClient-客户端"><span class="toc-number">1.</span> <span class="toc-text">ZkClient 客户端</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Curator-客户端"><span class="toc-number">2.</span> <span class="toc-text">Curator 客户端</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#配置维护"><span class="toc-number">3.</span> <span class="toc-text">配置维护</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#命名服务"><span class="toc-number">4.</span> <span class="toc-text">命名服务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DNS-服务器"><span class="toc-number">5.</span> <span class="toc-text">DNS 服务器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Master-选举"><span class="toc-number">6.</span> <span class="toc-text">Master 选举</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#广告推荐系统"><span class="toc-number">6.1.</span> <span class="toc-text">广告推荐系统</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#MySQL-数据复制总线"><span class="toc-number">7.</span> <span class="toc-text">MySQL 数据复制总线</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#复制任务注册"><span class="toc-number">7.1.</span> <span class="toc-text">复制任务注册</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#replicator-热备"><span class="toc-number">7.2.</span> <span class="toc-text">replicator 热备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#主备切换"><span class="toc-number">7.3.</span> <span class="toc-text">主备切换</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#集群管理"><span class="toc-number">8.</span> <span class="toc-text">集群管理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#分布式日志收集系统"><span class="toc-number">9.</span> <span class="toc-text">分布式日志收集系统</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#分布式锁"><span class="toc-number">10.</span> <span class="toc-text">分布式锁</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#实现"><span class="toc-number">10.1.</span> <span class="toc-text">实现</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#分布式队列"><span class="toc-number">11.</span> <span class="toc-text">分布式队列</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FIFO-队列"><span class="toc-number">11.1.</span> <span class="toc-text">FIFO 队列</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#分布式屏障-Barrier-队列"><span class="toc-number">11.2.</span> <span class="toc-text">分布式屏障 Barrier 队列</span></a></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://lizhaoloveit.cn/blogimages/blog/top_img.jpg)"><div id="page-header"><span class="pull-left"> <a class="blog_title" id="site-name" href="/">Ammar's Blog</a></span><div class="open toggle-menu pull-right"><div class="menu-icon-first"></div><div class="menu-icon-second"></div><div class="menu-icon-third"></div></div><span class="pull-right menus"><div class="mobile_author_icon"><img class="lozad" data-src="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'"><div class="mobile_author-info__description">微信号：aicjaish</div></div><hr><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a><a class="site-page" href="/comment/"><i class="fa-fw fa fa-coffee"></i><span> 留言</span></a><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a><script>document.body.addEventListener('touchstart', function(){ });</script></div></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Zookeeper的应用</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-09-07<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-09-24</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/">Java</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/%E6%A1%86%E6%9E%B6/">框架</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/%E6%A1%86%E6%9E%B6/Zookeeper/">Zookeeper</a></span><div class="post-meta-wordcount"><span>字数总计: </span><span class="word-count">3.1k</span><span class="post-meta__separator">|</span><span>阅读时长: 9 分钟</span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h1 id="ZkClient-客户端"><a href="#ZkClient-客户端" class="headerlink" title="ZkClient 客户端"></a>ZkClient 客户端</h1><hr>
<p>见 pdf 4.3</p>
<h1 id="Curator-客户端"><a href="#Curator-客户端" class="headerlink" title="Curator 客户端"></a>Curator 客户端</h1><hr>
<p>见 pdf 4.4</p>
<h1 id="配置维护"><a href="#配置维护" class="headerlink" title="配置维护"></a>配置维护</h1><hr>
<p>分布式系统中，很多服务都是部署在集群中的，多台服务器中部署着完全相同的应用，起着完全相同的作用。集群中这些服务器的配置文件是完全相同的。</p>
<p>如果集群中服务器的配置文件需要进行修改，那么我们就需要逐台修改这些服务器中的配置文件。如果我们集群服务器比较少，那么这些修改还不是太麻烦，如果某些大型互联网公司 Hadoop 集群有数千台服务器，纯手工更改就显得不可行了。过多的人工参与会使得出错率大幅提升。</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16006629878761-zookeeper.jpg" alt=""></p>
<p>zk 可以通过 “发布/订阅模型” 实现对集群配置文件的管理与维护。</p>
<h1 id="命名服务"><a href="#命名服务" class="headerlink" title="命名服务"></a>命名服务</h1><hr>
<p>可以为一定范围内的元素命名一个唯一标识，以与其他元素进行区分。在分布式系统中被命名的实体可以是集群中的主机、服务地址等。作用相当于 UUID，但一定不会重复。</p>
<blockquote>
<p>原理 通过利用 zk 中顺序节点自动生成唯一编号的特点来实现命名服务，首先创建一组业务相关的节点，然后再在这些节点下创建顺序节点，此时的顺序节点的路径+名称即为生成的唯一标识。</p>
</blockquote>
<h1 id="DNS-服务器"><a href="#DNS-服务器" class="headerlink" title="DNS 服务器"></a>DNS 服务器</h1><hr>
<p>zk 的 DNS 服务是命名服务的一种特殊用法。其对外表现是防止提供者</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16006721540658-zookeeper.jpg" alt=""></p>
<p>如果 app1 具有多个服务器名称，则可以在该应用节点下添加多个子节点。如果某个域名需要修改，则直接新增一个节点。</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16006721648048-zookeeper.jpg" alt=""></p>
<h1 id="Master-选举"><a href="#Master-选举" class="headerlink" title="Master 选举"></a>Master 选举</h1><hr>
<p>为了解决分布式系统中计算单元的单点问题，水平扩展计算单元的处理能力。<br>一般情况下，会在集群中选出一个 Master，用于协调集群中的其他 Slave 主机，对于 Slave 主机的状态具有决定权。<br>例如，读写分离集群，Master 处理写请求，Slave 处理读请求<br>对于复杂处理逻辑的系统，Master 负责处理复杂逻辑计算，然后将计算结果写入到一个中间存储系统(DB，或 DFS 等)，Slave 负责从中间存储系统中读取结果，并向读请求进行相应。</p>
<h2 id="广告推荐系统"><a href="#广告推荐系统" class="headerlink" title="广告推荐系统"></a>广告推荐系统</h2><hr>
<p>需求：系统会根据用户画像，将用户归结为不同的种类。系统会为不同种类的用户推荐不同的广告。每个用户前端需要从广告推荐系统中获取到不同的广告ID</p>
<p>分析：这个向前端提供服务的广告推荐系统一定是一个集群，这样可以更加快速高效的为前端进行响应。推荐系统对于广告 ID 的计算是一个相对复杂且消耗 CPU 等资源的过程。如果让集群中每一台主机都可以执行这个计算逻辑的话，那么势必会造成资源浪费，且降低了响应效率。此时，可以只让一台主机去处理计算逻辑，然后将计算结果写入到某中间存储系统中，并通知集群中的其他主机从该中间存储系统中共享该计算结果，那么，这个运行计算逻辑的主机就是 Master，而其他主机则为 Slave</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16007003331605-zookeeper.jpg" alt=""></p>
<p>Master 选举</p>
<p>zk 中多个客户端对同一节点创建时，只有一个客户端可以成功的特性实现。</p>
<ol>
<li>多个客户端同时发起对同一个临时节点进程创建的请求，最终只能有一个创建成功，这个创建成功的客户端就是 Master，其他客户端就是 Slave。</li>
<li>所有 Slave 都向这个临时节点的父节点注册一个子节点列表的 watcher 监听。</li>
<li>一旦该 Master 宕机，临时节点就会消失，zk 服务器就会向所有 Slave 发送事件，Slave在接收到事件后悔调用相应的回调，该回调会重新向这个父节点创建相应的临时子节点。谁创建成功，则谁就是新的 Master</li>
</ol>
<h1 id="MySQL-数据复制总线"><a href="#MySQL-数据复制总线" class="headerlink" title="MySQL 数据复制总线"></a>MySQL 数据复制总线</h1><p>分布式同步，分布式协调是分布式系统中不可缺少的环节，是将不同的分布式组件有机结合起来的关键。对于一个在多台机器上运行的应用而言，通常需要一个协调者来控制整个系统运行流程，例如执行的先后顺序或执行与不执行等。</p>
<p>MySQL 数据复制总线是一个实时数据复制框架，用于在不同的 MySQL 数据库实例间进行异步数据复制(表名、字段名不一样)。其核心部分由三部分组成：生产者、复制管道、消费者</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16007019980239-zookeeper.jpg" alt=""></p>
<p>从上述结构可以看出，replicator 存在单点问题，为了解决这个问题，需要为其设置多个热备主机。需要使用 zk 来做协调工作，即由 zk 来完成分布式同步工作。</p>
<p>MySQL 复制总线的工作步骤，总的来说分为三步：</p>
<h2 id="复制任务注册"><a href="#复制任务注册" class="headerlink" title="复制任务注册"></a>复制任务注册</h2><p>复制任务注册实际就是指不同的复制任务在 zk 中创建不同的 znode，即将复制任务注册到 zk 中。<br>在复制系统启动时，首先会在 zk 中创建相应的复制任务总节点 <code>/mysql/</code>。<br>当 replicator 线程启动时，会在 <code>/mysql/tasks/pay_record</code>，</p>
<h2 id="replicator-热备"><a href="#replicator-热备" class="headerlink" title="replicator 热备"></a>replicator 热备</h2><p>复制任务是由 replicator 主机完成的。为了防止 replicator 在复制过程中出现故障，replicator 采用热备容灾方案，将同一个复制任务部署到多个不同的 replicator 主机上，仅使一个处于 Running 状态，其他主机则处于 Standby 状态。当 Running 状态的主机出现故障，无法完成复制任务时，使某一个 Standby 状态主机转换为 Running 状态，继续完成复制任务。</p>
<ul>
<li>在相应任务节点下创建一个用于管理 replicator 主机的节点<code>/mysql/tasks/pay_record/instances</code></li>
<li>在<code>/mysql/tasks/pay_record/instances</code> 节点下为每一台 replicator 主机创建一个相应的临时顺序节点。</li>
<li>将序号最小的节点设置为 running，其他设置为 StandBy</li>
<li>在任务节点 <code>/mysql/tasks/pay_record</code> 下创建一个状态子节点，将当前 replicator 主机的状态写入到该节点的内容中。</li>
</ul>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16007567725637-zookeeper.jpg" alt=""></p>
<h2 id="主备切换"><a href="#主备切换" class="headerlink" title="主备切换"></a>主备切换</h2><p>当 Running 态的主机出现宕机，则该主机对应的子节点马上就被删除了，然后再当前处于 Standby 状态中的 replicator中找到序号最小的子节点，然后将其状态马上修改为 Running ，完成切换。</p>
<h1 id="集群管理"><a href="#集群管理" class="headerlink" title="集群管理"></a>集群管理</h1><hr>
<p>对于集群，总是希望能够随时获取以下信息</p>
<ul>
<li>当前集群中各个主机的运行时状态</li>
<li>当前集群中主机的存活状况</li>
</ul>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16007769159944-zookeeper.jpg" alt=""></p>
<h1 id="分布式日志收集系统"><a href="#分布式日志收集系统" class="headerlink" title="分布式日志收集系统"></a>分布式日志收集系统</h1><hr>
<p>分布式日志收集系统由四部分组成：日志源集群(产生大量日志)、日志收集器集群、Zookeeper集群、监控系统。</p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16007775626662-zookeeper.jpg" alt=""></p>
<ul>
<li>收集器的注册</li>
</ul>
<p>在 zk 上创建各个收集器对应的节点，如 <code>/logs/collector1</code><br>在系统启动时首先创建收集器根节点 <code>/logs</code>，收集器逐个启动就会逐个在 <code>logs</code> 下创建对应的<strong>永久节点</strong> <code>/logs/collector1</code></p>
<p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16007777896925-zookeeper.jpg" alt=""></p>
<ul>
<li>任务分配</li>
</ul>
<p>系统根据收集器的个数，将所有日志源集群主机分组，分别分配给各个收集器。<br>日志源主机会在为其分配的收集器节点下创建<strong>临时节点</strong>，一个日志源主机一个节点</p>
<ul>
<li>状态收集</li>
</ul>
<p>日志源主机状态，例如，日志源主机是否存活，已经产生多少日志等。<br>收集器运行状态，例如，收集器本身已经收集了多少字节的日志、当前 CPU、内存的使用状况等。</p>
<p>收集器/日志源主机会定时/实时将其自身状态写入到对应的节点内容</p>
<ul>
<li>任务再分配 Rebalance</li>
</ul>
<p>当出现收集器挂掉或扩容，就需要动态地进行日志收集任务再分配了，这个过程称为 Rebalance。<br>分配方案：</p>
<p>全局动态分配：<br>局部动态分配：首先定义好收集器的负载判别标准(热量、CPU消耗等等)。</p>
<h1 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h1><hr>
<p>分布式锁是控制分布式系统同步访问共享资源的一种方式。Zookeeper 可以实现分布式锁功能。根据用户操作类型的不同，可以分别为排它锁(写锁)和共享锁(读锁)。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16008336359254-zookeeper.jpg" alt=""></p>
<p>在 zk 上对于分布式锁的实现，使用的是类似于 <code>/xs_lock/[hostname]-请求类型-序号</code>的<strong>临时顺序节点</strong>。</p>
<p>具体过程：</p>
<ul>
<li>当一个客户端向某资源发出 R/W 操作请求时，该客户端首先会对 <code>/xs_lock</code> 节点注册子节点列表变更时间的 watcher 监听，随时监听子节点的变化情况。</li>
<li>watcher 注册完毕后，其会在 <code>/xs_lock</code> 节点下创建一个读写操作的<strong>临时顺序节点</strong>。读写操作的顺序性就是通过这些子节点的顺序性提现的。</li>
<li>节点创建完后，其就会触发客户端的 watcher 回调(创建子节点的时候，子节点列表变了，则会触发回调)，读取 <code>/xs_lock</code> 节点下的所有子节点列表，然后比较当前子节点对比其他子节点序号的大小关系，并根据读写操作的不同，执行不同的逻辑。<pre><code>读请求：若没有比自己小的节点，或比自己小的节点都是读请求节点，则当前请求可以直接读取，若比自己小的节点中存在写请求，则当前请求等待。
写请求：若没有比自己更小的节点，则直接进行写操作。若发现有比自己小的节点，无论是读还是写节点，当前写操作都需要等待。</code></pre></li>
<li>客户端操作完毕后，与 zk 的连接断开，则 zk 中该会话对应的节点消失。</li>
</ul>
<blockquote>
<p>注意：由于每次都注册监听子节点列表变化的 watcher 会导致大量的低效无用的操作，比如当001节点消失，host2345 都会收到回调，但host45 收到的回调显然什么事也做不了。<br>为了优化，在 zk 中创建相应的临时顺序节点后马上获取当前 <code>/xs_lock</code> 的所有子节点列表，但任何客户端都不向<code>xs_lock</code>注册用于监听子节点列表变化的 watcher。而是改为根据请求类型的不同向<strong>对其有影响的</strong>子节点注册 watcher<br>读请求：只需要 watcher 比其序号小的最后一个写节点<br>写请求：只需要 watcher 其序号-1的那个节点，无论读写节点。</p>
</blockquote>
<h1 id="分布式队列"><a href="#分布式队列" class="headerlink" title="分布式队列"></a>分布式队列</h1><hr>
<p>提起分布式队列，马上可以想到 RabbitMQ、Kafka 等分布式消息队列中间件产品，zk 也可以实现简单的消息队列。</p>
<h2 id="FIFO-队列"><a href="#FIFO-队列" class="headerlink" title="FIFO 队列"></a>FIFO 队列</h2><p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16008384761784-zookeeper.jpg" alt=""></p>
<p>zk 实现 FIFO 队列的思路是：利用顺序节点的有序性，为每个数据在 zk 中创建一个相应的永久节点，然后每个节点都注册 watcher 监听。一个节点被消费，则会引发消费者消费下一个节点，直到消费完毕。</p>
<h2 id="分布式屏障-Barrier-队列"><a href="#分布式屏障-Barrier-队列" class="headerlink" title="分布式屏障 Barrier 队列"></a>分布式屏障 Barrier 队列</h2><p><img src="https://www.lizhaoloveit.cn/blogimages/java/frames/zookeeper/16008398444601-zookeeper.jpg" alt=""></p>
<p>Barrier队列是分布式系统中的一种同步协调器，规定了一个队列中的元素必须全部聚齐后才能执行后面的任务，否则一直等待。其常见于大规模分布式并行计算的应用场景中，最终合并计算需要基于很多并行计算的子结果来进行。</p>
<p>zk 对于 Barrier 的实现原理是，在 zk 中创建一个 <code>/barrier</code> 节点，其数据内容设置为屏障打开的阈值，即当其下的子节点数量达到该阈值后，app 才可进行最终的计算，否则一直等待。每一个并行计算完成，都会在 <code>/barrier</code> 下创建一个子节点，直到所有并行运算完成。</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Ammar</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://lizhaoloveit.cn/2020/09/07/Zookeeper%E7%9A%84%E5%BA%94%E7%94%A8/">http://lizhaoloveit.cn/2020/09/07/Zookeeper%E7%9A%84%E5%BA%94%E7%94%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://lizhaoloveit.cn">Ammar's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Zookeeper/">Zookeeper    </a></div><div class="post_share"><div class="social-share" data-image="https://lizhaoloveit.cn/blogimages/blog/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js@1.0.16/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-buttom"><i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/wechat.jpg"><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="lozad post-qr-code__img" data-src="/img/alipay.jpg"><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull-left"><a href="/2020/09/07/Zookeeper/"><img class="prev_cover lozad" data-src="https://www.lizhaoloveit.cn/blogimages/blog/cover/1.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/2.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/3.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/4.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/5.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/6.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/7.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/8.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/9.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/10.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/11.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/12.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/13.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/14.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/15.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/16.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/17.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/18.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/19.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/20.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/21.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/22.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/23.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/24.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/25.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/26.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/27.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/28.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/29.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/31.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/32.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/33.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/34.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/35.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/36.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/37.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/38.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/39.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/40.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/41.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/42.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/43.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/44.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/45.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/46.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/47.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/48.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/49.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/50.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/51.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/52.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/53.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/54.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/55.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/56.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/57.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/58.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/59.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/60.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/62.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/63.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/64.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/65.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/66.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/67.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/68.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/69.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/70.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/71.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/72.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/73.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/74.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/75.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/76.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/77.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/78.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/79.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">上一篇</div><div class="prev_info"><span>Zookeeper</span></div></a></div><div class="next-post pull-right"><a href="/2020/07/28/MyBatis-Generator/"><img class="next_cover lozad" data-src="https://www.lizhaoloveit.cn/blogimages/blog/cover/1.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/2.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/3.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/4.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/5.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/6.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/7.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/8.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/9.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/10.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/11.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/12.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/13.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/14.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/15.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/16.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/17.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/18.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/19.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/20.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/21.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/22.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/23.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/24.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/25.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/26.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/27.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/28.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/29.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/31.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/32.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/33.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/34.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/35.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/36.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/37.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/38.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/39.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/40.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/41.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/42.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/43.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/44.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/45.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/46.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/47.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/48.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/49.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/50.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/51.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/52.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/53.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/54.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/55.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/56.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/57.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/58.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/59.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/60.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/62.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/63.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/64.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/65.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/66.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/67.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/68.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/69.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/70.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/71.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/72.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/73.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/74.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/75.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/76.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/77.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/78.jpg,https://www.lizhaoloveit.cn/blogimages/blog/cover/79.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">下一篇</div><div class="next_info"><span>MyBatis Generator</span></div></a></div></nav><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'http://lizhaoloveit.cn/2020/09/07/Zookeeper%E7%9A%84%E5%BA%94%E7%94%A8/';
  this.page.identifier = '2020/09/07/Zookeeper的应用/';
  this.page.title = 'Zookeeper的应用';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'lizhao' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script></div></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2014 - 2022 By Ammar</div><div class="icp"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener"><span>浙ICP备19013619号-1</span></a></div><div class="bag"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=33010502006128" target="_blank" rel="noopener"><img src="/img/beian.png"><span>浙公网安备 33010502006128号</span></a></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><section class="rightside" id="rightside"><i class="fa fa-book" id="readmode" title="阅读模式"> </i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换">繁</a><i class="far fa-moon nightshift" id="nightshift" title="夜间模式"></i></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/js-cookie@2/src/js.cookie.min.js"></script><script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script async src="/js/search/algolia.js"></script><script src="/js/nightshift.js"></script><script src="/js/tw_cn.js"></script><script>translateInitilization()

</script><script src="https://cdn.jsdelivr.net/npm/instant.page@1.2.2/instantpage.min.js" type="module"></script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>